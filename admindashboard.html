<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | IB STUDIOZ</title>
    
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%23FFD700' d='M50,2 A48,48 0 1,0 50,98 A48,48 0 1,0 50,2 Z' /%3E%3Cg fill='%230A0A0A'%3E%3Cpath d='M28,25 h10 v50 h-10 Z' /%3E%3Cpath d='M45,25 H60 A12.5,12.5 0 0,1 60,50 H45 Z M45,50 H63 A12.5,12.5 0 0,1 63,75 H45 Z' /%3E%3C/g%3E%3C/svg%3E">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-glow: #FFD700; --secondary-glow: #00A2FF; --accent-glow: #FF6B6B; --dark-bg: #0A0A0A;
            --text-primary: #F0F0F0; --text-secondary: #A0A0A0; --text-muted: #666; --card-bg: rgba(22, 22, 22, 0.8);
            --border-color: rgba(255, 215, 0, 0.2); --shadow-color: rgba(0, 0, 0, 0.5);
            --danger: #e74c3c; --success: #2ecc71; --info: #3498db; --details: #9b59b6; --warning: #f39c12;
            --glass-bg: rgba(255, 255, 255, 0.05); --glass-border: rgba(255, 255, 255, 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif; background-color: var(--dark-bg);
            color: var(--text-primary); line-height: 1.6; min-height: 100vh;
            opacity: 0; animation: page-fade-in 0.8s ease-out forwards;
        }
        @keyframes page-fade-in { to { opacity: 1; } }
        
        /* Enhanced Background */
        .background-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; overflow: hidden; }
        .aurora-layer { position: absolute; top: 0; left: 0; width: 120%; height: 120%; 
            background: 
                radial-gradient(circle at 10% 20%, var(--primary-glow) 0%, transparent 25%), 
                radial-gradient(circle at 80% 30%, var(--secondary-glow) 0%, transparent 30%), 
                radial-gradient(circle at 50% 80%, var(--accent-glow) 0%, transparent 25%),
                radial-gradient(circle at 20% 70%, var(--details) 0%, transparent 35%); 
            animation: aurora-morph 60s linear infinite alternate; 
            filter: blur(140px); opacity: 0.15; 
        }
        @keyframes aurora-morph { 
            0% { transform: rotate(0deg) scale(1.2); } 
            50% { transform: rotate(180deg) scale(1.5); } 
            100% { transform: rotate(360deg) scale(1.8); } 
        }
        .noise-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; 
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 800"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23noise)"/></svg>'); 
            opacity: 0.02; 
        }
        
        /* Enhanced Header */
        .page-header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 20px 40px; margin: 20px; 
            background: var(--glass-bg); backdrop-filter: blur(25px); 
            border-radius: 20px; border: 1px solid var(--glass-border); 
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            position: relative; overflow: hidden;
        }
        .page-header::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary-glow), transparent);
            opacity: 0.5;
        }
        .brand-logo { display: flex; align-items: center; gap: 15px; text-decoration: none; }
        .header-logo-svg { width: 50px; height: auto; filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.3)); }
        .brand-title { 
            position: relative; font-size: 1.6rem; font-weight: 800; 
            background: linear-gradient(135deg, #ff00ff, #00ffea, #ffdd00, #ff6b6b, #ff00ff); 
            background-size: 400% 100%; -webkit-background-clip: text; background-clip: text; 
            color: transparent; animation: rgb-text-flow 8s linear infinite; 
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        @keyframes rgb-text-flow { to { background-position: 400% 0; } }
        
        /* Enhanced Buttons */
        .btn-secondary { 
            background: var(--glass-bg); border: 1px solid var(--glass-border); 
            color: var(--text-secondary); padding: 12px 24px; border-radius: 12px; 
            font-size: 0.9rem; font-weight: 600; cursor: pointer; 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            backdrop-filter: blur(10px); position: relative; overflow: hidden;
        }
        .btn-secondary::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,215,0,0.1), transparent);
            transition: left 0.5s ease;
        }
        .btn-secondary:hover::before { left: 100%; }
        .btn-secondary:hover { 
            background: var(--primary-glow); color: var(--dark-bg); 
            border-color: var(--primary-glow); 
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.4); 
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: var(--primary-glow); color: var(--dark-bg);
            border: none; padding: 12px 24px; border-radius: 8px;
            font-weight: 600; cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background: #ffcc00; transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,215,0,0.3);
        }
        
        .btn-danger {
            background: var(--danger); color: white;
            border: none; padding: 8px 16px; border-radius: 6px;
            font-weight: 600; cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-danger:hover {
            background: #c0392b; transform: translateY(-2px);
        }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .hidden { display: none !important; }
        
        /* Admin Navigation */
        .admin-nav {
            display: flex; flex-wrap: wrap; gap: 15px; margin: 20px 0;
            background: var(--glass-bg); backdrop-filter: blur(20px);
            border-radius: 16px; border: 1px solid var(--glass-border);
            padding: 15px;
        }
        .admin-nav-item {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 30px; padding: 10px 20px; font-size: 0.9rem;
            font-weight: 600; cursor: pointer; transition: all 0.3s ease;
            color: var(--text-secondary);
        }
        .admin-nav-item.active {
            background: var(--primary-glow); color: var(--dark-bg);
            border-color: var(--primary-glow);
        }
        .admin-nav-item:hover:not(.active) {
            background: rgba(255,255,255,0.1); border-color: var(--primary-glow);
            color: var(--text-primary);
        }
        
        /* Admin Content */
        .admin-content {
            background: var(--glass-bg); backdrop-filter: blur(25px);
            border-radius: 20px; border: 1px solid var(--glass-border);
            padding: 30px; margin-bottom: 40px;
            min-height: 500px;
        }
        .admin-panel {
            display: none;
        }
        .admin-panel.active {
            display: block;
            animation: fade-in 0.5s ease;
        }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Section Header */
        .section-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--glass-border);
        }
        .section-title {
            font-size: 1.8rem; font-weight: 700;
            background: linear-gradient(45deg, var(--primary-glow), var(--secondary-glow));
            -webkit-background-clip: text; background-clip: text; color: transparent;
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block; margin-bottom: 8px;
            font-weight: 600; color: var(--text-primary);
        }
        .form-input, .form-textarea, .form-select {
            width: 100%; padding: 12px 15px;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px; color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none; border-color: var(--primary-glow);
            background: rgba(255,255,255,0.08);
        }
        .form-textarea {
            min-height: 120px; resize: vertical;
        }
        .form-row {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
        }
        
        /* Tables */
        .data-table {
            width: 100%; border-collapse: collapse;
            margin-top: 20px;
        }
        .data-table th {
            text-align: left; padding: 15px; font-weight: 600;
            color: var(--text-secondary); border-bottom: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.03);
        }
        .data-table td {
            padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .data-table tr:last-child td {
            border-bottom: none;
        }
        .data-table tr:hover {
            background: rgba(255,255,255,0.03);
        }
        
        /* Modals */
        .modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(10,10,10,0.8); backdrop-filter: blur(15px); 
            display: flex; justify-content: center; align-items: center; z-index: 2000; 
            opacity: 0; visibility: hidden; 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal { 
            background: var(--glass-bg); backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border); border-radius: 20px; 
            width: 90%; max-width: 900px; padding: 40px; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.5); 
            transform: scale(0.9) translateY(20px); 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative; overflow: hidden;
            max-height: 90vh; overflow-y: auto;
        }
        .modal::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary-glow), transparent);
            opacity: 0.6;
        }
        .modal-overlay.active .modal { transform: scale(1) translateY(0); }
        .modal-header { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 25px; border-bottom: 1px solid var(--border-color); 
            padding-bottom: 20px; 
        }
        .modal-header h2 { 
            font-size: 1.6rem; font-weight: 700; 
            background: linear-gradient(45deg, var(--primary-glow), var(--secondary-glow));
            -webkit-background-clip: text; background-clip: text; color: transparent;
        }
        .modal-close { 
            background: none; border: none; color: var(--text-primary); 
            font-size: 2rem; cursor: pointer; width: 40px; height: 40px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            transition: all 0.3s ease; 
        }
        .modal-close:hover { 
            background: rgba(255,255,255,0.1); transform: rotate(90deg); 
            color: var(--accent-glow);
        }
        
        /* Toast */
        .toast { 
            position: fixed; bottom: 30px; right: 30px; 
            background: var(--glass-bg); backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); border-radius: 12px; 
            padding: 18px 24px; box-shadow: 0 12px 40px rgba(0,0,0,0.4); 
            z-index: 3000; display: flex; align-items: center; gap: 12px;
            transform: translateX(400px); opacity: 0; 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            min-width: 300px;
        }
        .toast.show { transform: translateX(0); opacity: 1; }
        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.info { border-left: 4px solid var(--info); }
        .toast i { font-size: 1.3rem; }
        .toast.success i { color: var(--success); }
        .toast.error i { color: var(--danger); }
        .toast.info i { color: var(--info); }
        
        /* Loading Spinner */
        .spinner-container { display: flex; justify-content: center; align-items: center; height: 120px; }
        .spinner { 
            width: 50px; height: 50px; 
            border: 4px solid rgba(255, 255, 255, 0.1); border-radius: 50%; 
            border-top-color: var(--primary-glow); 
            animation: spin 1s cubic-bezier(0.4, 0, 0.2, 1) infinite; 
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Empty State */
        .empty-state {
            text-align: center; padding: 40px 20px;
            color: var(--text-muted);
        }
        .empty-icon {
            font-size: 3rem; margin-bottom: 15px; opacity: 0.5;
        }
        
        /* Dashboard Stats */
        .dashboard-stats {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; margin: 20px 0 40px 0;
        }
        .stat-card {
            background: var(--glass-bg); backdrop-filter: blur(20px);
            border-radius: 16px; border: 1px solid var(--glass-border);
            padding: 20px; text-align: center; position: relative; overflow: hidden;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
        }
        .stat-number {
            font-size: 2.5rem; font-weight: 800; margin-bottom: 5px;
            background: linear-gradient(45deg, var(--primary-glow), var(--secondary-glow));
            -webkit-background-clip: text; background-clip: text; color: transparent;
        }
        .stat-label { font-size: 0.9rem; color: var(--text-secondary); font-weight: 500; }
        
        /* Analytics Charts */
        .chart-container {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05);
            border-radius: 12px; padding: 20px; margin-bottom: 20px;
            height: 300px;
        }
        
        /* Settings */
        .settings-section {
            margin-bottom: 30px;
        }
        .settings-section h3 {
            margin-bottom: 15px; color: var(--text-primary);
        }
        .settings-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .setting-item {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05);
            border-radius: 12px; padding: 20px;
        }
        .setting-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px;
        }
        .setting-title {
            font-weight: 600; color: var(--text-primary);
        }
        .toggle-switch {
            position: relative; width: 50px; height: 26px;
            background: rgba(255,255,255,0.1); border-radius: 13px;
            cursor: pointer; transition: background 0.3s ease;
        }
        .toggle-switch.active {
            background: var(--primary-glow);
        }
        .toggle-slider {
            position: absolute; top: 3px; left: 3px;
            width: 20px; height: 20px; background: white;
            border-radius: 50%; transition: transform 0.3s ease;
        }
        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .page-header { flex-direction: column; gap: 20px; margin: 15px; padding: 25px 20px; }
            .form-row { grid-template-columns: 1fr; }
            .modal { padding: 30px 20px; }
            .dashboard-stats { grid-template-columns: repeat(2, 1fr); }
        }
        
        @media (max-width: 480px) {
            .dashboard-stats { grid-template-columns: 1fr; }
            .stat-number { font-size: 2rem; }
        }
    </style>
</head>
<body>
    <div class="background-container">
        <div class="aurora-layer"></div>
        <div class="noise-layer"></div>
    </div>
    
    <main>
        <header class="page-header">
            <a href="/admindashboard.html" class="brand-logo">
                <svg class="header-logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <path fill="var(--primary-glow)" d="M50,2 A48,48 0 1,0 50,98 A48,48 0 1,0 50,2 Z" />
                    <g fill="var(--dark-bg)">
                        <path d="M28,25 h10 v50 h-10 Z" />
                        <path d="M45,25 H60 A12.5,12.5 0 0,1 60,50 H45 Z M45,50 H63 A12.5,12.5 0 0,1 63,75 H45 Z" />
                    </g>
                </svg>
                <h1 class="brand-title">IB STUDIOZ</h1>
            </a>
            <div style="display: flex; gap: 15px; align-items: center;">
                <button id="profile-btn" class="btn-secondary">
                    <i class="fas fa-user-shield"></i> Admin
                </button>
                <button id="logout-btn" class="btn-secondary">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </header>
        
        <div class="container">
            <div class="welcome-header-pro">
                <h1>Admin Dashboard</h1>
                <p>Manage your platform with powerful administrative tools and analytics.</p>
            </div>
            
            <!-- Admin Navigation -->
            <div class="admin-nav">
                <div class="admin-nav-item active" data-panel="dashboard">Dashboard</div>
                <div class="admin-nav-item" data-panel="notices">Notices</div>
                <div class="admin-nav-item" data-panel="users">Users</div>
                <div class="admin-nav-item" data-panel="payments">Payments</div>
                <div class="admin-nav-item" data-panel="analytics">Analytics</div>
                <div class="admin-nav-item" data-panel="settings">Settings</div>
            </div>
            
            <!-- Admin Content -->
            <div class="admin-content">
                <!-- Dashboard Panel -->
                <div class="admin-panel active" id="dashboard-panel">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h2>
                    </div>
                    
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <div class="stat-number" id="total-users">0</div>
                            <div class="stat-label">Total Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-materials">0</div>
                            <div class="stat-label">Materials</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-pyqs">0</div>
                            <div class="stat-label">PYQs</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-seminars">0</div>
                            <div class="stat-label">Seminars</div>
                        </div>
                    </div>
                    
                    <div class="settings-grid">
                        <div class="chart-container">
                            <canvas id="user-growth-chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <canvas id="activity-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Notices Panel -->
                <div class="admin-panel" id="notices-panel">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-bullhorn"></i> Notices Management</h2>
                        <button class="btn-primary" id="add-notice-btn">
                            <i class="fas fa-plus"></i> Add Notice
                        </button>
                    </div>
                    
                    <div class="notices-list" id="notices-list">
                        <div class="spinner-container">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Users Panel -->
                <div class="admin-panel" id="users-panel">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-users"></i> User Management</h2>
                        <button class="btn-primary" id="add-user-btn">
                            <i class="fas fa-user-plus"></i> Add User
                        </button>
                    </div>
                    
                    <div class="users-list" id="users-list">
                        <div class="spinner-container">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Payments Panel -->
                <div class="admin-panel" id="payments-panel">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-credit-card"></i> Payment History</h2>
                        <button class="btn-secondary" id="export-payments-btn">
                            <i class="fas fa-download"></i> Export
                        </button>
                    </div>
                    
                    <div class="payments-list" id="payments-list">
                        <div class="spinner-container">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Analytics Panel -->
                <div class="admin-panel" id="analytics-panel">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-chart-line"></i> Platform Analytics</h2>
                    </div>
                    
                    <div class="settings-grid">
                        <div class="chart-container">
                            <canvas id="material-usage-chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <canvas id="user-engagement-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container" style="height: 400px; margin-top: 20px;">
                        <canvas id="revenue-chart"></canvas>
                    </div>
                </div>
                
                <!-- Settings Panel -->
                <div class="admin-panel" id="settings-panel">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-cog"></i> System Settings</h2>
                    </div>
                    
                    <div class="settings-section">
                        <h3>General Settings</h3>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <div class="setting-header">
                                    <div class="setting-title">User Registration</div>
                                    <div class="toggle-switch active" id="registration-toggle">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">Allow new users to register on the platform</p>
                            </div>
                            <div class="setting-item">
                                <div class="setting-header">
                                    <div class="setting-title">Email Notifications</div>
                                    <div class="toggle-switch active" id="email-toggle">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">Send email notifications to users</p>
                            </div>
                            <div class="setting-item">
                                <div class="setting-header">
                                    <div class="setting-title">Maintenance Mode</div>
                                    <div class="toggle-switch" id="maintenance-toggle">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">Put the platform in maintenance mode</p>
                            </div>
                            <div class="setting-item">
                                <div class="setting-header">
                                    <div class="setting-title">Analytics Tracking</div>
                                    <div class="toggle-switch active" id="analytics-toggle">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">Track user analytics and platform usage</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>Platform Configuration</h3>
                        <div class="form-group">
                            <label class="form-label">Platform Name</label>
                            <input type="text" class="form-input" id="platform-name" value="IB STUDIOZ">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Admin Email</label>
                            <input type="email" class="form-input" id="admin-email" value="admin@ibstudioz.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Support Contact</label>
                            <input type="text" class="form-input" id="support-contact" value="+1 (555) 123-4567">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Default Credits</label>
                            <input type="number" class="form-input" id="default-credits" value="100">
                        </div>
                        <button class="btn-primary" id="save-settings-btn">Save Settings</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Notice Modal -->
        <div id="notice-modal" class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h2 id="notice-modal-title">Add Notice</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="notice-form">
                    <input type="hidden" id="notice-id">
                    <div class="form-group">
                        <label class="form-label">Title</label>
                        <input type="text" class="form-input" id="notice-title" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Message</label>
                        <textarea class="form-textarea" id="notice-message" required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Important</label>
                            <select class="form-select" id="notice-important">
                                <option value="false">No</option>
                                <option value="true">Yes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Target Audience</label>
                            <select class="form-select" id="notice-audience">
                                <option value="all">All Users</option>
                                <option value="students">Students Only</option>
                                <option value="faculty">Faculty Only</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">Save Notice</button>
                </form>
            </div>
        </div>
        
        <!-- User Modal -->
        <div id="user-modal" class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h2 id="user-modal-title">Add User</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="user-form">
                    <input type="hidden" id="user-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-input" id="user-name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="user-email" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Admission No</label>
                            <input type="text" class="form-input" id="user-admission">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Branch</label>
                            <input type="text" class="form-input" id="user-branch">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Semester</label>
                            <input type="text" class="form-input" id="user-semester">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Role</label>
                            <select class="form-select" id="user-role">
                                <option value="student">Student</option>
                                <option value="faculty">Faculty</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Credits</label>
                        <input type="number" class="form-input" id="user-credits" value="100">
                    </div>
                    <button type="submit" class="btn-primary">Save User</button>
                </form>
            </div>
        </div>
        
        <!-- Toast notification -->
        <div id="toast" class="toast">
            <i class="fas fa-check-circle"></i>
            <span id="toast-message">Notification message</span>
        </div>
    </main>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        // Initialize Firebase
        const firebaseConfig = { 
            apiKey: "AIzaSyDCmvA9sFCSc5r4ZuFUJuGdO1LDoW7rKao", 
            authDomain: "student-portal-free.firebaseapp.com", 
            projectId: "student-portal-free", 
            storageBucket: "student-portal-free.appspot.com", 
            messagingSenderId: "272865877510", 
            appId: "1:272865877510:web:0875a2502ae55bbf9ead87" 
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Global variables
        let currentUser = null;
        let userGrowthChart = null;
        let activityChart = null;
        let materialUsageChart = null;
        let userEngagementChart = null;
        let revenueChart = null;
        
        // DOM Elements
        const logoutBtn = document.getElementById('logout-btn');
        const adminNavItems = document.querySelectorAll('.admin-nav-item');
        const adminPanels = document.querySelectorAll('.admin-panel');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        
        // Modal elements
        const noticeModal = document.getElementById('notice-modal');
        const userModal = document.getElementById('user-modal');
        const noticeForm = document.getElementById('notice-form');
        const userForm = document.getElementById('user-form');
        
        // Initialize page
        function initializePage() {
            // Logout functionality
            logoutBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to logout?')) {
                    auth.signOut().then(() => {
                        window.location.replace('/index.html');
                    }).catch(error => {
                        showToast("Logout failed. Please try again.", "error");
                    });
                }
            });
            
            // Admin navigation
            adminNavItems.forEach(item => {
                item.addEventListener('click', () => {
                    const panelId = item.getAttribute('data-panel');
                    
                    // Update active nav item
                    adminNavItems.forEach(navItem => navItem.classList.remove('active'));
                    item.classList.add('active');
                    
                    // Update active panel
                    adminPanels.forEach(panel => {
                        panel.classList.remove('active');
                        if (panel.id === `${panelId}-panel`) {
                            panel.classList.add('active');
                        }
                    });
                    
                    // Load panel-specific data
                    loadPanelData(panelId);
                });
            });
            
            // Modal close buttons
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.modal-overlay').forEach(modal => {
                        modal.classList.remove('active');
                    });
                });
            });
            
            // Modal overlay clicks
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
            
            // Notice form
            noticeForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveNotice();
            });
            
            // User form
            userForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveUser();
            });
            
            // Add notice button
            document.getElementById('add-notice-btn').addEventListener('click', () => {
                document.getElementById('notice-modal-title').textContent = 'Add Notice';
                document.getElementById('notice-id').value = '';
                document.getElementById('notice-title').value = '';
                document.getElementById('notice-message').value = '';
                document.getElementById('notice-important').value = 'false';
                document.getElementById('notice-audience').value = 'all';
                noticeModal.classList.add('active');
            });
            
            // Add user button
            document.getElementById('add-user-btn').addEventListener('click', () => {
                document.getElementById('user-modal-title').textContent = 'Add User';
                document.getElementById('user-id').value = '';
                document.getElementById('user-name').value = '';
                document.getElementById('user-email').value = '';
                document.getElementById('user-admission').value = '';
                document.getElementById('user-branch').value = '';
                document.getElementById('user-semester').value = '';
                document.getElementById('user-role').value = 'student';
                document.getElementById('user-credits').value = '100';
                userModal.classList.add('active');
            });
            
            // Export payments button
            document.getElementById('export-payments-btn').addEventListener('click', exportPayments);
            
            // Settings toggles
            document.getElementById('registration-toggle').addEventListener('click', function() {
                this.classList.toggle('active');
            });
            
            document.getElementById('email-toggle').addEventListener('click', function() {
                this.classList.toggle('active');
            });
            
            document.getElementById('maintenance-toggle').addEventListener('click', function() {
                this.classList.toggle('active');
            });
            
            document.getElementById('analytics-toggle').addEventListener('click', function() {
                this.classList.toggle('active');
            });
            
            // Save settings button
            document.getElementById('save-settings-btn').addEventListener('click', saveSettings);
            
            // Load dashboard data
            loadDashboardData();
        }
        
        // Load panel-specific data
        function loadPanelData(panelId) {
            switch(panelId) {
                case 'dashboard':
                    // Already loaded in initializePage
                    break;
                case 'notices':
                    loadNotices();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'payments':
                    loadPayments();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
                case 'settings':
                    // Settings are static
                    break;
            }
        }
        
        // Enhanced toast function with auto-hide
        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            toast.className = `toast ${type} show`;
            
            const icon = toast.querySelector('i');
            if (type === 'success') {
                icon.className = 'fas fa-check-circle';
            } else if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle';
            } else if (type === 'info') {
                icon.className = 'fas fa-info-circle';
            }
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }
        
        // Format timestamp
        function formatTimestamp(timestamp) {
            if (!timestamp || !timestamp.toDate) return 'N/A';
            const date = timestamp.toDate();
            const now = new Date();
            const diffMs = now - date;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) {
                return 'Today ' + date.toLocaleTimeString('en-US', { 
                    hour: 'numeric', minute: '2-digit', hour12: true 
                });
            } else if (diffDays === 1) {
                return 'Yesterday';
            } else if (diffDays < 7) {
                return `${diffDays} days ago`;
            } else {
                return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
            }
        }
        
        // Load dashboard data
        function loadDashboardData() {
            // Load users count
            db.collection('users').onSnapshot(snapshot => {
                document.getElementById('total-users').textContent = snapshot.size;
            }, error => {
                console.error('Error loading users:', error);
                document.getElementById('total-users').textContent = 'Error';
            });
            
            // Load materials count
            db.collection('notes').onSnapshot(snapshot => {
                document.getElementById('total-materials').textContent = snapshot.size;
            }, error => {
                console.error('Error loading materials:', error);
                document.getElementById('total-materials').textContent = 'Error';
            });
            
            // Load PYQs count
            db.collection('pyqs').onSnapshot(snapshot => {
                document.getElementById('total-pyqs').textContent = snapshot.size;
            }, error => {
                console.error('Error loading PYQs:', error);
                document.getElementById('total-pyqs').textContent = 'Error';
            });
            
            // Load seminars count
            db.collection('seminars').onSnapshot(snapshot => {
                document.getElementById('total-seminars').textContent = snapshot.size;
            }, error => {
                console.error('Error loading seminars:', error);
                document.getElementById('total-seminars').textContent = 'Error';
            });
            
            // Load user growth chart
            loadUserGrowthChart();
            
            // Load activity chart
            loadActivityChart();
        }
        
        // Load user growth chart
        function loadUserGrowthChart() {
            const ctx = document.getElementById('user-growth-chart').getContext('2d');
            
            // Get user data for the last 7 days
            const labels = [];
            const data = [];
            const today = new Date();
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                labels.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
                
                // For demo purposes, generate random data
                data.push(Math.floor(Math.random() * 10) + 5);
            }
            
            if (userGrowthChart) {
                userGrowthChart.destroy();
            }
            
            userGrowthChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'New Users',
                        data: data,
                        backgroundColor: 'rgba(255, 215, 0, 0.2)',
                        borderColor: 'rgba(255, 215, 0, 1)',
                        borderWidth: 2,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'User Growth (Last 7 Days)',
                            color: '#F0F0F0',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            labels: {
                                color: '#F0F0F0'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#A0A0A0'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#A0A0A0'
                            }
                        }
                    }
                }
            });
        }
        
        // Load activity chart
        function loadActivityChart() {
            const ctx = document.getElementById('activity-chart').getContext('2d');
            
            if (activityChart) {
                activityChart.destroy();
            }
            
            activityChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Materials', 'PYQs', 'Seminars', 'Quizzes', 'Other'],
                    datasets: [{
                        data: [35, 25, 15, 20, 5],
                        backgroundColor: [
                            'rgba(255, 215, 0, 0.7)',
                            'rgba(0, 162, 255, 0.7)',
                            'rgba(255, 107, 107, 0.7)',
                            'rgba(155, 89, 182, 0.7)',
                            'rgba(46, 204, 113, 0.7)'
                        ],
                        borderColor: [
                            'rgba(255, 215, 0, 1)',
                            'rgba(0, 162, 255, 1)',
                            'rgba(255, 107, 107, 1)',
                            'rgba(155, 89, 182, 1)',
                            'rgba(46, 204, 113, 1)'
                        ],
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Platform Activity Distribution',
                            color: '#F0F0F0',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            position: 'right',
                            labels: {
                                color: '#F0F0F0'
                            }
                        }
                    }
                }
            });
        }
        
        // Load notices
        function loadNotices() {
            const noticesList = document.getElementById('notices-list');
            
            db.collection('notices')
                .orderBy('createdAt', 'desc')
                .onSnapshot(snapshot => {
                    const notices = [];
                    
                    snapshot.forEach(doc => {
                        const notice = doc.data();
                        notice.id = doc.id;
                        notices.push(notice);
                    });
                    
                    if (notices.length === 0) {
                        noticesList.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon"><i class="fas fa-bullhorn"></i></div>
                                <p>No notices found</p>
                            </div>
                        `;
                        return;
                    }
                    
                    const noticesHtml = notices.map(notice => {
                        const isImportant = notice.important === 'true' || notice.important === true;
                        
                        return `
                            <div class="notice-item" style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; margin-bottom: 15px; ${isImportant ? 'border-left: 4px solid var(--danger);' : ''}">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                    <div>
                                        <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 10px; color: var(--text-primary);">${notice.title || 'Untitled Notice'}</div>
                                        <div style="color: var(--text-secondary); margin-bottom: 15px;">${notice.message || ''}</div>
                                        <div style="font-size: 0.85rem; color: var(--text-muted);">
                                            <i class="fas fa-clock"></i> ${formatTimestamp(notice.createdAt)} • 
                                            Audience: ${notice.audience || 'all'} • 
                                            Important: ${isImportant ? 'Yes' : 'No'}
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 10px;">
                                        <button class="btn-secondary" style="padding: 8px 12px; font-size: 0.9rem;" onclick="editNotice('${notice.id}')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn-danger" style="padding: 8px 12px; font-size: 0.9rem;" onclick="deleteNotice('${notice.id}')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    noticesList.innerHTML = noticesHtml;
                }, error => {
                    console.error('Error loading notices:', error);
                    noticesList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon"><i class="fas fa-exclamation-circle"></i></div>
                            <p>Failed to load notices</p>
                        </div>
                    `;
                });
        }
        
        // Save notice
        function saveNotice() {
            const noticeId = document.getElementById('notice-id').value;
            const noticeData = {
                title: document.getElementById('notice-title').value,
                message: document.getElementById('notice-message').value,
                important: document.getElementById('notice-important').value,
                audience: document.getElementById('notice-audience').value,
                createdAt: noticeId ? firebase.firestore.FieldValue.serverTimestamp() : firebase.firestore.FieldValue.serverTimestamp()
            };
            
            if (noticeId) {
                // Update existing notice
                db.collection('notices').doc(noticeId).update(noticeData)
                    .then(() => {
                        showToast('Notice updated successfully', 'success');
                        noticeModal.classList.remove('active');
                    })
                    .catch(error => {
                        console.error('Error updating notice:', error);
                        showToast('Failed to update notice', 'error');
                    });
            } else {
                // Add new notice
                db.collection('notices').add(noticeData)
                    .then(() => {
                        showToast('Notice added successfully', 'success');
                        noticeModal.classList.remove('active');
                    })
                    .catch(error => {
                        console.error('Error adding notice:', error);
                        showToast('Failed to add notice', 'error');
                    });
            }
        }
        
        // Edit notice
        function editNotice(noticeId) {
            db.collection('notices').doc(noticeId).get()
                .then(doc => {
                    if (doc.exists) {
                        const notice = doc.data();
                        document.getElementById('notice-modal-title').textContent = 'Edit Notice';
                        document.getElementById('notice-id').value = noticeId;
                        document.getElementById('notice-title').value = notice.title || '';
                        document.getElementById('notice-message').value = notice.message || '';
                        document.getElementById('notice-important').value = notice.important ? 'true' : 'false';
                        document.getElementById('notice-audience').value = notice.audience || 'all';
                        noticeModal.classList.add('active');
                    }
                })
                .catch(error => {
                    console.error('Error getting notice:', error);
                    showToast('Failed to load notice', 'error');
                });
        }
        
        // Delete notice
        function deleteNotice(noticeId) {
            if (confirm('Are you sure you want to delete this notice?')) {
                db.collection('notices').doc(noticeId).delete()
                    .then(() => {
                        showToast('Notice deleted successfully', 'success');
                    })
                    .catch(error => {
                        console.error('Error deleting notice:', error);
                        showToast('Failed to delete notice', 'error');
                    });
            }
        }
        
        // Load users
        function loadUsers() {
            const usersList = document.getElementById('users-list');
            
            db.collection('users')
                .orderBy('createdAt', 'desc')
                .onSnapshot(snapshot => {
                    const users = [];
                    
                    snapshot.forEach(doc => {
                        const user = doc.data();
                        user.id = doc.id;
                        users.push(user);
                    });
                    
                    if (users.length === 0) {
                        usersList.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon"><i class="fas fa-users"></i></div>
                                <p>No users found</p>
                            </div>
                        `;
                        return;
                    }
                    
                    const usersHtml = users.map(user => {
                        return `
                            <div style="background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05); border-radius: 12px; padding: 20px; margin-bottom: 15px;">
                                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                                    <div>
                                        <div style="font-size: 1.2rem; font-weight: 600; margin-bottom: 10px; color: var(--text-primary);">${user.name || 'Unknown'}</div>
                                        <div style="color: var(--text-secondary); margin-bottom: 5px;">${user.email || 'No email'}</div>
                                        <div style="font-size: 0.85rem; color: var(--text-muted);">
                                            ${user.admissionNo ? `Admission No: ${user.admissionNo} • ` : ''}
                                            ${user.branch ? `Branch: ${user.branch} • ` : ''}
                                            ${user.semester ? `Semester: ${user.semester} • ` : ''}
                                            Role: ${user.role || 'student'} • 
                                            Credits: ${user.credits || 0} • 
                                            Joined: ${formatTimestamp(user.createdAt)}
                                        </div>
                                    </div>
                                    <div style="display: flex; gap: 10px;">
                                        <button class="btn-secondary" style="padding: 8px 12px; font-size: 0.9rem;" onclick="editUser('${user.id}')">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn-danger" style="padding: 8px 12px; font-size: 0.9rem;" onclick="deleteUser('${user.id}')">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        `;
                    }).join('');
                    
                    usersList.innerHTML = usersHtml;
                }, error => {
                    console.error('Error loading users:', error);
                    usersList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon"><i class="fas fa-exclamation-circle"></i></div>
                            <p>Failed to load users</p>
                        </div>
                    `;
                });
        }
        
        // Save user
        function saveUser() {
            const userId = document.getElementById('user-id').value;
            const userData = {
                name: document.getElementById('user-name').value,
                email: document.getElementById('user-email').value,
                admissionNo: document.getElementById('user-admission').value,
                branch: document.getElementById('user-branch').value,
                semester: document.getElementById('user-semester').value,
                role: document.getElementById('user-role').value,
                credits: parseInt(document.getElementById('user-credits').value) || 0,
                createdAt: userId ? firebase.firestore.FieldValue.serverTimestamp() : firebase.firestore.FieldValue.serverTimestamp()
            };
            
            if (userId) {
                // Update existing user
                db.collection('users').doc(userId).update(userData)
                    .then(() => {
                        showToast('User updated successfully', 'success');
                        userModal.classList.remove('active');
                    })
                    .catch(error => {
                        console.error('Error updating user:', error);
                        showToast('Failed to update user', 'error');
                    });
            } else {
                // Add new user
                db.collection('users').add(userData)
                    .then(() => {
                        showToast('User added successfully', 'success');
                        userModal.classList.remove('active');
                    })
                    .catch(error => {
                        console.error('Error adding user:', error);
                        showToast('Failed to add user', 'error');
                    });
            }
        }
        
        // Edit user
        function editUser(userId) {
            db.collection('users').doc(userId).get()
                .then(doc => {
                    if (doc.exists) {
                        const user = doc.data();
                        document.getElementById('user-modal-title').textContent = 'Edit User';
                        document.getElementById('user-id').value = userId;
                        document.getElementById('user-name').value = user.name || '';
                        document.getElementById('user-email').value = user.email || '';
                        document.getElementById('user-admission').value = user.admissionNo || '';
                        document.getElementById('user-branch').value = user.branch || '';
                        document.getElementById('user-semester').value = user.semester || '';
                        document.getElementById('user-role').value = user.role || 'student';
                        document.getElementById('user-credits').value = user.credits || 0;
                        userModal.classList.add('active');
                    }
                })
                .catch(error => {
                    console.error('Error getting user:', error);
                    showToast('Failed to load user', 'error');
                });
        }
        
        // Delete user
        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                db.collection('users').doc(userId).delete()
                    .then(() => {
                        showToast('User deleted successfully', 'success');
                    })
                    .catch(error => {
                        console.error('Error deleting user:', error);
                        showToast('Failed to delete user', 'error');
                    });
            }
        }
        
        // Load payments
        function loadPayments() {
            const paymentsList = document.getElementById('payments-list');
            
            db.collection('transactions')
                .orderBy('createdAt', 'desc')
                .limit(50)
                .onSnapshot(snapshot => {
                    const transactions = [];
                    
                    snapshot.forEach(doc => {
                        const transaction = doc.data();
                        transaction.id = doc.id;
                        transactions.push(transaction);
                    });
                    
                    if (transactions.length === 0) {
                        paymentsList.innerHTML = `
                            <div class="empty-state">
                                <div class="empty-icon"><i class="fas fa-credit-card"></i></div>
                                <p>No payment transactions found</p>
                            </div>
                        `;
                        return;
                    }
                    
                    const transactionsHtml = `
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>User</th>
                                    <th>Type</th>
                                    <th>Amount</th>
                                    <th>Description</th>
                                    <th>Date</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${transactions.map(transaction => {
                                    // Get user name
                                    let userName = 'Unknown';
                                    if (transaction.userId) {
                                        db.collection('users').doc(transaction.userId).get()
                                            .then(userDoc => {
                                                if (userDoc.exists) {
                                                    const userData = userDoc.data();
                                                    document.getElementById(`user-${transaction.id}`).textContent = userData.name || 'Unknown';
                                                }
                                            })
                                            .catch(error => {
                                                console.error('Error getting user:', error);
                                            });
                                    }
                                    
                                    return `
                                        <tr>
                                            <td>${transaction.id.substring(0, 8)}...</td>
                                            <td id="user-${transaction.id}">Loading...</td>
                                            <td style="color: ${transaction.type === 'earn' ? 'var(--success)' : 'var(--danger)'};">
                                                ${transaction.type === 'earn' ? 'Earn' : 'Spend'}
                                            </td>
                                            <td style="color: ${transaction.type === 'earn' ? 'var(--success)' : 'var(--danger)'};">
                                                ${transaction.type === 'earn' ? '+' : '-'}${transaction.amount}
                                            </td>
                                            <td>${transaction.description || 'No description'}</td>
                                            <td>${formatTimestamp(transaction.createdAt)}</td>
                                        </tr>
                                    `;
                                }).join('')}
                            </tbody>
                        </table>
                    `;
                    
                    paymentsList.innerHTML = transactionsHtml;
                }, error => {
                    console.error('Error loading payments:', error);
                    paymentsList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon"><i class="fas fa-exclamation-circle"></i></div>
                            <p>Failed to load payment history</p>
                        </div>
                    `;
                });
        }
        
        // Export payments
        function exportPayments() {
            showToast('Export feature coming soon!', 'info');
        }
        
        // Load analytics
        function loadAnalytics() {
            // Load material usage chart
            loadMaterialUsageChart();
            
            // Load user engagement chart
            loadUserEngagementChart();
            
            // Load revenue chart
            loadRevenueChart();
        }
        
        // Load material usage chart
        function loadMaterialUsageChart() {
            const ctx = document.getElementById('material-usage-chart').getContext('2d');
            
            if (materialUsageChart) {
                materialUsageChart.destroy();
            }
            
            materialUsageChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [{
                        label: 'Materials Viewed',
                        data: [65, 59, 80, 81, 56, 55, 40],
                        backgroundColor: 'rgba(255, 215, 0, 0.7)',
                        borderColor: 'rgba(255, 215, 0, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Material Usage (Last 7 Days)',
                            color: '#F0F0F0',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            labels: {
                                color: '#F0F0F0'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#A0A0A0'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#A0A0A0'
                            }
                        }
                    }
                }
            });
        }
        
        // Load user engagement chart
        function loadUserEngagementChart() {
            const ctx = document.getElementById('user-engagement-chart').getContext('2d');
            
            if (userEngagementChart) {
                userEngagementChart.destroy();
            }
            
            userEngagementChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul'],
                    datasets: [{
                        label: 'Active Users',
                        data: [30, 45, 60, 70, 85, 90, 95],
                        backgroundColor: 'rgba(0, 162, 255, 0.2)',
                        borderColor: 'rgba(0, 162, 255, 1)',
                        borderWidth: 2,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'User Engagement (Last 7 Months)',
                            color: '#F0F0F0',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            labels: {
                                color: '#F0F0F0'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#A0A0A0'
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#A0A0A0'
                            }
                        }
                    }
                }
            });
        }
        
        // Load revenue chart
        function loadRevenueChart() {
            const ctx = document.getElementById('revenue-chart').getContext('2d');
            
            if (revenueChart) {
                revenueChart.destroy();
            }
            
            revenueChart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
                    datasets: [{
                        label: 'Revenue',
                        data: [12000, 19000, 15000, 25000, 22000, 30000, 28000, 35000, 32000, 40000, 38000, 45000],
                        backgroundColor: 'rgba(46, 204, 113, 0.7)',
                        borderColor: 'rgba(46, 204, 113, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Revenue Overview (Current Year)',
                            color: '#F0F0F0',
                            font: {
                                size: 16
                            }
                        },
                        legend: {
                            labels: {
                                color: '#F0F0F0'
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#A0A0A0',
                                callback: function(value) {
                                    return '$' + value.toLocaleString();
                                }
                            }
                        },
                        x: {
                            grid: {
                                color: 'rgba(255, 255, 255, 0.1)'
                            },
                            ticks: {
                                color: '#A0A0A0'
                            }
                        }
                    }
                }
            });
        }
        
        // Save settings
        function saveSettings() {
            const settings = {
                platformName: document.getElementById('platform-name').value,
                adminEmail: document.getElementById('admin-email').value,
                supportContact: document.getElementById('support-contact').value,
                defaultCredits: parseInt(document.getElementById('default-credits').value) || 100,
                registrationEnabled: document.getElementById('registration-toggle').classList.contains('active'),
                emailNotificationsEnabled: document.getElementById('email-toggle').classList.contains('active'),
                maintenanceMode: document.getElementById('maintenance-toggle').classList.contains('active'),
                analyticsEnabled: document.getElementById('analytics-toggle').classList.contains('active'),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            db.collection('settings').doc('system').set(settings)
                .then(() => {
                    showToast('Settings saved successfully', 'success');
                })
                .catch(error => {
                    console.error('Error saving settings:', error);
                    showToast('Failed to save settings', 'error');
                });
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Escape key closes modals
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                    modal.classList.remove('active');
                });
            }
        });
        
        // Authentication check
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                
                // Check if user is admin
                db.collection('users').doc(user.uid).get().then(doc => {
                    if (doc.exists) {
                        const userData = doc.data();
                        if (userData.role !== 'admin') {
                            // Redirect to student dashboard if not admin
                            window.location.replace('/studentdashboard.html');
                            return;
                        }
                        
                        // Initialize page
                        initializePage();
                    } else {
                        // User data not found, redirect to login
                        window.location.replace('/index.html');
                    }
                }).catch(error => {
                    console.error('Error getting user data:', error);
                    window.location.replace('/index.html');
                });
            } else {
                // Redirect to login page
                window.location.replace('/index.html');
            }
        });
        
        // Console welcome message
        console.log('%cIB STUDIOZ Admin Dashboard', 'color: #FFD700; font-size: 24px; font-weight: bold;');
        console.log('%cWelcome to your powerful admin control panel', 'color: #00A2FF; font-size: 14px;');
        console.log('Real-time Firebase integration active ✓');
    </script>
</body>
</html>

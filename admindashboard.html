<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard | IB STUDIOZ</title>
    
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%23FFD700' d='M50,2 A48,48 0 1,0 50,98 A48,48 0 1,0 50,2 Z' /%3E%3Cg fill='%230A0A0A'%3E%3Cpath d='M28,25 h10 v50 h-10 Z' /%3E%3Cpath d='M45,25 H60 A12.5,12.5 0 0,1 60,50 H45 Z M45,50 H63 A12.5,12.5 0 0,1 63,75 H45 Z' /%3E%3C/g%3E%3C/svg%3E">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-glow: #FFD700; --secondary-glow: #00A2FF; --accent-glow: #FF6B6B; --dark-bg: #0A0A0A;
            --text-primary: #F0F0F0; --text-secondary: #A0A0A0; --text-muted: #666; --card-bg: rgba(22, 22, 22, 0.8);
            --border-color: rgba(255, 215, 0, 0.2); --shadow-color: rgba(0, 0, 0, 0.5);
            --danger: #e74c3c; --success: #2ecc71; --info: #3498db; --details: #9b59b6; --warning: #f39c12;
            --glass-bg: rgba(255, 255, 255, 0.05); --glass-border: rgba(255, 255, 255, 0.1);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif; background-color: var(--dark-bg);
            color: var(--text-primary); line-height: 1.6; min-height: 100vh;
            opacity: 0; animation: page-fade-in 0.8s ease-out forwards;
        }
        @keyframes page-fade-in { to { opacity: 1; } }
        
        /* Enhanced Background */
        .background-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; overflow: hidden; }
        .aurora-layer { position: absolute; top: 0; left: 0; width: 120%; height: 120%; 
            background: 
                radial-gradient(circle at 10% 20%, var(--primary-glow) 0%, transparent 25%), 
                radial-gradient(circle at 80% 30%, var(--secondary-glow) 0%, transparent 30%), 
                radial-gradient(circle at 50% 80%, var(--accent-glow) 0%, transparent 25%),
                radial-gradient(circle at 20% 70%, var(--details) 0%, transparent 35%); 
            animation: aurora-morph 60s linear infinite alternate; 
            filter: blur(140px); opacity: 0.15; 
        }
        @keyframes aurora-morph { 
            0% { transform: rotate(0deg) scale(1.2); } 
            50% { transform: rotate(180deg) scale(1.5); } 
            100% { transform: rotate(360deg) scale(1.8); } 
        }
        .noise-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; 
            background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 800"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23noise)"/></svg>'); 
            opacity: 0.02; 
        }
        
        /* Enhanced Header */
        .page-header { 
            display: flex; justify-content: space-between; align-items: center; 
            padding: 20px 40px; margin: 20px; 
            background: var(--glass-bg); backdrop-filter: blur(25px); 
            border-radius: 20px; border: 1px solid var(--glass-border); 
            box-shadow: 0 8px 32px rgba(0,0,0,0.3);
            position: relative; overflow: hidden;
        }
        .page-header::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary-glow), transparent);
            opacity: 0.5;
        }
        .brand-logo { display: flex; align-items: center; gap: 15px; text-decoration: none; }
        .header-logo-svg { width: 50px; height: auto; filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.3)); }
        .brand-title { 
            position: relative; font-size: 1.6rem; font-weight: 800; 
            background: linear-gradient(135deg, #ff00ff, #00ffea, #ffdd00, #ff6b6b, #ff00ff); 
            background-size: 400% 100%; -webkit-background-clip: text; background-clip: text; 
            color: transparent; animation: rgb-text-flow 8s linear infinite; 
            text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
        }
        @keyframes rgb-text-flow { to { background-position: 400% 0; } }
        
        /* Enhanced Buttons */
        .btn-secondary { 
            background: var(--glass-bg); border: 1px solid var(--glass-border); 
            color: var(--text-secondary); padding: 12px 24px; border-radius: 12px; 
            font-size: 0.9rem; font-weight: 600; cursor: pointer; 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            backdrop-filter: blur(10px); position: relative; overflow: hidden;
        }
        .btn-secondary::before {
            content: ''; position: absolute; top: 0; left: -100%; width: 100%; height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,215,0,0.1), transparent);
            transition: left 0.5s ease;
        }
        .btn-secondary:hover::before { left: 100%; }
        .btn-secondary:hover { 
            background: var(--primary-glow); color: var(--dark-bg); 
            border-color: var(--primary-glow); 
            box-shadow: 0 0 30px rgba(255, 215, 0, 0.4); 
            transform: translateY(-2px);
        }
        
        .btn-primary {
            background: var(--primary-glow); color: var(--dark-bg);
            border: none; padding: 12px 24px; border-radius: 8px;
            font-weight: 600; cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-primary:hover {
            background: #ffcc00; transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255,215,0,0.3);
        }
        
        .btn-danger {
            background: var(--danger); color: white;
            border: none; padding: 8px 16px; border-radius: 6px;
            font-weight: 600; cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-danger:hover {
            background: #c0392b; transform: translateY(-2px);
        }
        
        .btn-info {
            background: var(--info); color: white;
            border: none; padding: 8px 16px; border-radius: 6px;
            font-weight: 600; cursor: pointer;
            transition: all 0.3s ease;
        }
        .btn-info:hover {
            background: #2980b9; transform: translateY(-2px);
        }
        
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .hidden { display: none !important; }
        
        /* Admin Navigation */
        .admin-nav {
            display: flex; flex-wrap: wrap; gap: 15px; margin: 20px 0;
            background: var(--glass-bg); backdrop-filter: blur(20px);
            border-radius: 16px; border: 1px solid var(--glass-border);
            padding: 15px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        .admin-nav-item {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 30px; padding: 10px 20px; font-size: 0.9rem;
            font-weight: 600; cursor: pointer; transition: all 0.3s ease;
            color: var(--text-secondary);
            white-space: nowrap;
        }
        .admin-nav-item.active {
            background: var(--primary-glow); color: var(--dark-bg);
            border-color: var(--primary-glow);
        }
        .admin-nav-item:hover:not(.active) {
            background: rgba(255,255,255,0.1); border-color: var(--primary-glow);
            color: var(--text-primary);
        }
        
        /* Admin Content */
        .admin-content {
            background: var(--glass-bg); backdrop-filter: blur(25px);
            border-radius: 20px; border: 1px solid var(--glass-border);
            padding: 30px; margin-bottom: 40px;
            min-height: 500px;
            overflow: hidden;
        }
        .admin-panel {
            display: none;
        }
        .admin-panel.active {
            display: block;
            animation: fade-in 0.5s ease;
        }
        @keyframes fade-in {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Section Header */
        .section-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid var(--glass-border);
            flex-wrap: wrap;
            gap: 15px;
        }
        .section-title {
            font-size: 1.8rem; font-weight: 700;
            background: linear-gradient(45deg, var(--primary-glow), var(--secondary-glow));
            -webkit-background-clip: text; background-clip: text; color: transparent;
        }
        
        /* Search Bar */
        .search-container {
            position: relative;
            margin-bottom: 20px;
        }
        .search-input {
            width: 100%; padding: 12px 15px 12px 45px;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px; color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }
        .search-input:focus {
            outline: none; border-color: var(--primary-glow);
            background: rgba(255,255,255,0.08);
        }
        .search-icon {
            position: absolute; left: 15px; top: 50%;
            transform: translateY(-50%); color: var(--text-secondary);
        }
        
        /* Forms */
        .form-group {
            margin-bottom: 20px;
        }
        .form-label {
            display: block; margin-bottom: 8px;
            font-weight: 600; color: var(--text-primary);
        }
        .form-input, .form-textarea, .form-select {
            width: 100%; padding: 12px 15px;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px; color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            transition: all 0.3s ease;
        }
        .form-input:focus, .form-textarea:focus, .form-select:focus {
            outline: none; border-color: var(--primary-glow);
            background: rgba(255,255,255,0.08);
        }
        .form-textarea {
            min-height: 120px; resize: vertical;
        }
        .form-row {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px;
        }
        
        /* Tables */
        .data-table {
            width: 100%; border-collapse: collapse;
            margin-top: 20px;
        }
        .data-table th {
            text-align: left; padding: 15px; font-weight: 600;
            color: var(--text-secondary); border-bottom: 1px solid rgba(255,255,255,0.1);
            background: rgba(255,255,255,0.03);
        }
        .data-table td {
            padding: 15px; border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .data-table tr:last-child td {
            border-bottom: none;
        }
        .data-table tr:hover {
            background: rgba(255,255,255,0.03);
        }
        
        /* Modals */
        .modal-overlay { 
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; 
            background: rgba(10,10,10,0.8); backdrop-filter: blur(15px); 
            display: flex; justify-content: center; align-items: center; z-index: 2000; 
            opacity: 0; visibility: hidden; 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            overflow-y: auto;
            padding: 20px;
        }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal { 
            background: var(--glass-bg); backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border); border-radius: 20px; 
            width: 90%; max-width: 900px; padding: 40px; 
            box-shadow: 0 20px 60px rgba(0,0,0,0.5); 
            transform: scale(0.9) translateY(20px); 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative; overflow: hidden;
            max-height: 90vh; overflow-y: auto;
        }
        .modal::before {
            content: ''; position: absolute; top: 0; left: 0; right: 0; height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary-glow), transparent);
            opacity: 0.6;
        }
        .modal-overlay.active .modal { transform: scale(1) translateY(0); }
        .modal-header { 
            display: flex; justify-content: space-between; align-items: center; 
            margin-bottom: 25px; border-bottom: 1px solid var(--border-color); 
            padding-bottom: 20px; 
        }
        .modal-header h2 { 
            font-size: 1.6rem; font-weight: 700; 
            background: linear-gradient(45deg, var(--primary-glow), var(--secondary-glow));
            -webkit-background-clip: text; background-clip: text; color: transparent;
        }
        .modal-close { 
            background: none; border: none; color: var(--text-primary); 
            font-size: 2rem; cursor: pointer; width: 40px; height: 40px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            transition: all 0.3s ease; 
        }
        .modal-close:hover { 
            background: rgba(255,255,255,0.1); transform: rotate(90deg); 
            color: var(--accent-glow);
        }
        
        /* Toast */
        .toast { 
            position: fixed; bottom: 30px; right: 30px; 
            background: var(--glass-bg); backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border); border-radius: 12px; 
            padding: 18px 24px; box-shadow: 0 12px 40px rgba(0,0,0,0.4); 
            z-index: 3000; display: flex; align-items: center; gap: 12px;
            transform: translateX(400px); opacity: 0; 
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1); 
            min-width: 300px;
            max-width: calc(100% - 60px);
        }
        .toast.show { transform: translateX(0); opacity: 1; }
        .toast.success { border-left: 4px solid var(--success); }
        .toast.error { border-left: 4px solid var(--danger); }
        .toast.info { border-left: 4px solid var(--info); }
        .toast i { font-size: 1.3rem; }
        .toast.success i { color: var(--success); }
        .toast.error i { color: var(--danger); }
        .toast.info i { color: var(--info); }
        .toast-close {
            background: none; border: none; color: inherit;
            margin-left: auto; font-size: 1.2rem; cursor: pointer;
            opacity: 0.7; transition: opacity 0.3s ease;
        }
        .toast-close:hover { opacity: 1; }
        
        /* Loading Spinner */
        .spinner-container { display: flex; justify-content: center; align-items: center; height: 120px; }
        .spinner { 
            width: 50px; height: 50px; 
            border: 4px solid rgba(255, 255, 255, 0.1); border-radius: 50%; 
            border-top-color: var(--primary-glow); 
            animation: spin 1s cubic-bezier(0.4, 0, 0.2, 1) infinite; 
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        
        /* Empty State */
        .empty-state {
            text-align: center; padding: 40px 20px;
            color: var(--text-muted);
        }
        .empty-icon {
            font-size: 3rem; margin-bottom: 15px; opacity: 0.5;
        }
        
        /* Dashboard Stats */
        .dashboard-stats {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); 
            gap: 20px; margin: 20px 0 40px 0;
        }
        .stat-card {
            background: var(--glass-bg); backdrop-filter: blur(20px);
            border-radius: 16px; border: 1px solid var(--glass-border);
            padding: 20px; text-align: center; position: relative; overflow: hidden;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px) scale(1.02);
        }
        .stat-number {
            font-size: 2.5rem; font-weight: 800; margin-bottom: 5px;
            background: linear-gradient(45deg, var(--primary-glow), var(--secondary-glow));
            -webkit-background-clip: text; background-clip: text; color: transparent;
        }
        .stat-label { font-size: 0.9rem; color: var(--text-secondary); font-weight: 500; }
        
        /* Analytics Charts */
        .chart-container {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05);
            border-radius: 12px; padding: 20px; margin-bottom: 20px;
            height: 300px;
        }
        
        /* Settings */
        .settings-section {
            margin-bottom: 30px;
        }
        .settings-section h3 {
            margin-bottom: 15px; color: var(--text-primary);
        }
        .settings-grid {
            display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        .setting-item {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05);
            border-radius: 12px; padding: 20px;
        }
        .setting-header {
            display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px;
        }
        .setting-title {
            font-weight: 600; color: var(--text-primary);
        }
        .toggle-switch {
            position: relative; width: 50px; height: 26px;
            background: rgba(255,255,255,0.1); border-radius: 13px;
            cursor: pointer; transition: background 0.3s ease;
        }
        .toggle-switch.active {
            background: var(--primary-glow);
        }
        .toggle-slider {
            position: absolute; top: 3px; left: 3px;
            width: 20px; height: 20px; background: white;
            border-radius: 50%; transition: transform 0.3s ease;
        }
        .toggle-switch.active .toggle-slider {
            transform: translateX(24px);
        }
        
        /* Content Cards */
        .content-card {
            background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.05);
            border-radius: 12px; padding: 20px; margin-bottom: 15px;
            transition: all 0.3s ease;
            overflow: hidden;
        }
        .content-card:hover {
            background: rgba(255,255,255,0.06);
            transform: translateY(-3px);
        }
        .content-header {
            display: flex; justify-content: space-between; align-items: flex-start;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .content-title {
            font-size: 1.2rem; font-weight: 600; color: var(--text-primary);
            word-break: break-word;
        }
        .content-meta {
            display: flex; gap: 15px; margin-top: 10px;
            font-size: 0.85rem; color: var(--text-muted);
            flex-wrap: wrap;
        }
        .content-actions {
            display: flex; gap: 10px;
            flex-wrap: wrap;
        }
        
        /* File Upload */
        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            width: 100%;
        }
        .file-upload input[type=file] {
            position: absolute;
            left: 0;
            top: 0;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }
        .file-upload-label {
            display: block;
            padding: 12px 15px;
            background: rgba(255,255,255,0.05);
            border: 1px dashed var(--border-color);
            border-radius: 8px;
            text-align: center;
            color: var(--text-secondary);
            transition: all 0.3s ease;
        }
        .file-upload:hover .file-upload-label {
            background: rgba(255,255,255,0.1);
            border-color: var(--primary-glow);
            color: var(--text-primary);
        }
        
        /* Thumbnail Preview */
        .thumbnail-preview {
            width: 100%;
            max-width: 200px;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        /* Filter Dropdown */
        .filter-container {
            display: flex; gap: 15px; margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .filter-select {
            padding: 10px 15px; background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1); border-radius: 8px;
            color: var(--text-primary); min-width: 150px;
        }
        
        /* User Status Badge */
        .status-badge {
            display: inline-block; padding: 4px 8px; border-radius: 4px;
            font-size: 0.75rem; font-weight: 600;
        }
        .status-active {
            background: rgba(46, 204, 113, 0.2); color: var(--success);
        }
        .status-inactive {
            background: rgba(231, 76, 60, 0.2); color: var(--danger);
        }
        
        /* Real-time Indicator */
        .realtime-indicator {
            display: inline-flex; align-items: center; gap: 5px;
            font-size: 0.8rem; color: var(--success);
        }
        .realtime-dot {
            width: 8px; height: 8px; background: var(--success);
            border-radius: 50%; animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.2); }
            100% { opacity: 1; transform: scale(1); }
        }
        
        /* Welcome Header */
        .welcome-header-pro {
            text-align: center; margin: 30px 0;
        }
        .welcome-header-pro h1 {
            font-size: 2.5rem; font-weight: 800; margin-bottom: 10px;
            background: linear-gradient(45deg, var(--primary-glow), var(--secondary-glow));
            -webkit-background-clip: text; background-clip: text; color: transparent;
        }
        .welcome-header-pro p {
            font-size: 1.1rem; color: var(--text-secondary);
        }
        
        /* Custom dropdown styles */
        .custom-select {
            position: relative;
            width: 100%;
        }
        
        .custom-select-trigger {
            position: relative;
            display: block;
            width: 100%;
            padding: 12px 15px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        
        .custom-select-trigger:hover {
            background: rgba(255,255,255,0.08);
            border-color: var(--primary-glow);
        }
        
        .custom-select-trigger i {
            margin-right: 10px;
            color: var(--primary-glow);
        }
        
        .custom-select-trigger .arrow {
            transition: transform 0.3s ease;
            color: var(--text-secondary);
        }
        
        .custom-select.open .custom-select-trigger .arrow {
            transform: rotate(180deg);
        }
        
        .custom-select-dropdown {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            margin-top: 5px;
            background: var(--dark-bg);
            border: 1px solid var(--glass-border);
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            max-height: 250px;
            overflow-y: auto;
        }
        
        .custom-select.open .custom-select-dropdown {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }
        
        .custom-select-option {
            padding: 12px 15px;
            cursor: pointer;
            display: flex;
            align-items: center;
            transition: all 0.2s ease;
        }
        
        .custom-select-option:hover {
            background: rgba(255,215,0,0.1);
        }
        
        .custom-select-option i {
            margin-right: 12px;
            width: 20px;
            text-align: center;
            color: var(--primary-glow);
        }
        
        .custom-select-option.selected {
            background: rgba(255,215,0,0.2);
            color: var(--primary-glow);
            font-weight: 600;
        }
        
        /* Hide original select */
        .custom-select-original {
            display: none;
        }
        
        /* Branch-Semester-Course Selection Modal */
        .branch-semester-course-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(15px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            padding: 20px;
        }
        
        .branch-semester-course-modal.active {
            opacity: 1;
            visibility: visible;
        }
        
        .branch-semester-course-modal .modal {
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            width: 90%;
            max-width: 900px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            transform: scale(0.9) translateY(20px);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .branch-semester-course-modal.active .modal {
            transform: scale(1) translateY(0);
        }
        
        .selection-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .selection-header h2 {
            font-size: 1.6rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary-glow), var(--secondary-glow));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        .selection-steps {
            display: flex;
            margin-bottom: 30px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }
        
        .step {
            flex: 1;
            text-align: center;
            position: relative;
            min-width: 100px;
        }
        
        .step:not(:last-child):after {
            content: '';
            position: absolute;
            top: 15px;
            right: 0;
            width: 100%;
            height: 2px;
            background: rgba(255, 255, 255, 0.1);
        }
        
        .step.active:not(:last-child):after {
            background: var(--primary-glow);
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 10px;
            font-weight: 600;
        }
        
        .step.active .step-number {
            background: var(--primary-glow);
            color: var(--dark-bg);
        }
        
        .step-title {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }
        
        .step.active .step-title {
            color: var(--text-primary);
        }
        
        .selection-content {
            min-height: 300px;
        }
        
        .selection-step {
            display: none;
        }
        
        .selection-step.active {
            display: block;
            animation: fade-in 0.5s ease;
        }
        
        .selection-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .selection-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .selection-card:hover {
            background: rgba(255, 215, 0, 0.1);
            border-color: var(--primary-glow);
            transform: translateY(-3px);
        }
        
        .selection-card.selected {
            background: rgba(255, 215, 0, 0.2);
            border-color: var(--primary-glow);
        }
        
        .selection-icon {
            font-size: 2rem;
            margin-bottom: 10px;
            color: var(--primary-glow);
        }
        
        .selection-name {
            font-weight: 600;
            margin-bottom: 5px;
            word-break: break-word;
        }
        
        .selection-code {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }
        
        .selection-actions {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .btn-step {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            flex: 1;
            min-width: 120px;
        }
        
        .btn-prev {
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-primary);
        }
        
        .btn-prev:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        
        .btn-next, .btn-finish {
            background: var(--primary-glow);
            color: var(--dark-bg);
        }
        
        .btn-next:hover, .btn-finish:hover {
            background: #ffcc00;
        }
        
        .btn-finish {
            display: none;
        }
        
        .selection-step.active:last-child .btn-next {
            display: none;
        }
        
        .selection-step.active:last-child .btn-finish {
            display: block;
        }
        
        .selected-display {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .selected-item {
            flex: 1;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            text-align: center;
            min-width: 120px;
        }
        
        .selected-label {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }
        
        .selected-value {
            font-weight: 600;
            word-break: break-word;
        }
        
        .change-selection-btn {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            color: var(--text-secondary);
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .change-selection-btn:hover {
            background: var(--primary-glow);
            color: var(--dark-bg);
            border-color: var(--primary-glow);
        }
        
        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 10, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
        }
        
        .loading-overlay.active {
            opacity: 1;
            visibility: visible;
        }
        
        .loading-content {
            text-align: center;
        }
        
        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-glow);
            animation: spin 1s cubic-bezier(0.4, 0, 0.2, 1) infinite;
            margin: 0 auto 20px;
        }
        
        .loading-text {
            font-size: 1.2rem;
            color: var(--text-primary);
            font-weight: 500;
        }
        
        /* Logout Animation */
        .logout-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-glow), var(--secondary-glow));
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.5s ease;
        }
        
        .logout-animation.active {
            opacity: 1;
            visibility: visible;
        }
        
        .logout-content {
            text-align: center;
            color: var(--dark-bg);
        }
        
        .logout-icon {
            font-size: 4rem;
            margin-bottom: 20px;
            animation: fade-in 1s ease;
        }
        
        .logout-message {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            animation: fade-in 1s ease 0.3s both;
        }
        
        .logout-submessage {
            font-size: 1.2rem;
            opacity: 0.9;
            animation: fade-in 1s ease 0.6s both;
        }
        
        /* User View Modal */
        #user-view-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background: rgba(10, 10, 10, 0.8);
            backdrop-filter: blur(15px);
            align-items: center;
            justify-content: center;
            z-index: 1002;
            padding: 20px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        #user-view-modal.active {
            display: flex;
            opacity: 1;
            visibility: visible;
        }
        
        #user-view-modal .modal {
            background: var(--glass-bg);
            backdrop-filter: blur(30px);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            max-width: 600px;
            width: 100%;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
            padding: 30px;
            position: relative;
            overflow: hidden;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        #user-view-modal .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--glass-border);
        }
        
        #user-view-modal .modal-header h2 {
            font-size: 1.6rem;
            font-weight: 700;
            background: linear-gradient(45deg, var(--primary-glow), var(--secondary-glow));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        #user-view-modal .modal-close {
            background: none;
            border: none;
            font-size: 2rem;
            cursor: pointer;
            color: var(--text-primary);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        #user-view-modal .modal-close:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: rotate(90deg);
            color: var(--accent-glow);
        }
        
        #user-view-modal .modal-body {
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        #user-view-modal .modal-body b {
            color: var(--text-secondary);
            display: inline-block;
            margin-right: 8px;
        }
        
        #user-view-modal .modal-body .content-title {
            margin-bottom: 5px;
        }
        
        #user-view-modal .modal-body .status-badge {
            margin-top: 8px;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .page-header { 
                flex-direction: column; 
                gap: 20px; 
                margin: 15px; 
                padding: 25px 20px; 
            }
            
            .form-row { 
                grid-template-columns: 1fr; 
            }
            
            .modal { 
                padding: 30px 20px; 
            }
            
            .dashboard-stats { 
                grid-template-columns: repeat(2, 1fr); 
            }
            
            .admin-nav {
                justify-content: center;
            }
            
            .filter-container {
                flex-direction: column;
            }
            
            .selection-grid {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
            
            .selected-display {
                flex-direction: column;
            }
            
            .content-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .content-actions {
                align-self: flex-start;
            }
            
            .content-actions .btn-secondary,
            .content-actions .btn-info,
            .content-actions .btn-danger {
                padding: 6px 10px;
                font-size: 0.8rem;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .selection-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            #user-view-modal .modal {
                padding: 20px;
            }
            
            #user-view-modal .modal-header h2 {
                font-size: 1.4rem;
            }
            
            #user-view-modal .modal-body {
                font-size: 0.9rem;
            }
            
            #user-view-modal .modal-body img {
                width: 60px;
                height: 60px;
            }
        }
        
        @media (max-width: 480px) {
            .dashboard-stats { 
                grid-template-columns: 1fr; 
            }
            
            .stat-number { 
                font-size: 2rem; 
            }
            
            .content-meta {
                gap: 8px;
                font-size: 0.75rem;
            }
            
            .content-card {
                padding: 15px;
            }
            
            .modal {
                padding: 20px 15px;
            }
            
            .branch-semester-course-modal .modal {
                padding: 20px 15px;
            }
            
            .selection-grid {
                grid-template-columns: 1fr;
            }
            
            .btn-step {
                padding: 10px 20px;
                font-size: 0.9rem;
            }
            
            .toast {
                right: 15px;
                bottom: 15px;
                left: 15px;
                min-width: auto;
            }
            
            #user-view-modal .modal {
                padding: 15px;
                border-radius: 15px;
            }
            
            #user-view-modal .modal-header h2 {
                font-size: 1.2rem;
            }
            
            #user-view-modal .modal-body {
                font-size: 0.85rem;
            }
            
            #user-view-modal .modal-body img {
                width: 50px;
                height: 50px;
            }
            
            #user-view-modal .modal-body button {
                padding: 8px 12px;
                font-size: 0.8rem;
            }
        }
    </style>
</head>
<body>
    <div class="background-container">
        <div class="aurora-layer"></div>
        <div class="noise-layer"></div>
    </div>
    
    <!-- Loading Overlay -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <div class="loading-text">Loading...</div>
        </div>
    </div>
    
    <!-- Logout Animation -->
    <div id="logout-animation" class="logout-animation">
        <div class="logout-content">
            <div class="logout-icon">
                <i class="fas fa-sign-out-alt"></i>
            </div>
            <div class="logout-message">Logging Out</div>
            <div class="logout-submessage">Thank you for using IB STUDIOZ</div>
        </div>
    </div>
    
    <main>
        <header class="page-header">
            <a href="/admindashboard.html" class="brand-logo">
                <svg class="header-logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <path fill="var(--primary-glow)" d="M50,2 A48,48 0 1,0 50,98 A48,48 0 1,0 50,2 Z" />
                    <g fill="var(--dark-bg)">
                        <path d="M28,25 h10 v50 h-10 Z" />
                        <path d="M45,25 H60 A12.5,12.5 0 0,1 60,50 H45 Z M45,50 H63 A12.5,12.5 0 0,1 63,75 H45 Z" />
                    </g>
                </svg>
                <h1 class="brand-title">IB STUDIOZ</h1>
            </a>
            <div style="display: flex; gap: 15px; align-items: center; flex-wrap: wrap;">
                <div class="realtime-indicator">
                    <span class="realtime-dot"></span>
                    <span>Live</span>
                </div>
                <button id="profile-btn" class="btn-secondary">
                    <i class="fas fa-user-shield"></i> Admin
                </button>
                <button id="logout-btn" class="btn-secondary">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </header>
        
        <div class="container">
            <div class="welcome-header-pro">
                <h1>Admin Dashboard</h1>
                <p>Manage your platform with powerful administrative tools and real-time analytics.</p>
            </div>
            
            <!-- Admin Navigation -->
            <div class="admin-nav">
                <div class="admin-nav-item active" data-panel="dashboard">Dashboard</div>
                <div class="admin-nav-item" data-panel="notices">Notices</div>
                <div class="admin-nav-item" data-panel="users">Users</div>
                <div class="admin-nav-item" data-panel="materials">Materials</div>
                <div class="admin-nav-item" data-panel="pyqs">PYQs</div>
                <div class="admin-nav-item" data-panel="quizzes">Quizzes</div>
                <div class="admin-nav-item" data-panel="seminars">Seminars</div>
                <div class="admin-nav-item" data-panel="payments">Payments</div>
                <div class="admin-nav-item" data-panel="analytics">Analytics</div>
                <div class="admin-nav-item" data-panel="settings">Settings</div>
            </div>
            
            <!-- Admin Content -->
            <div class="admin-content">
                <!-- Dashboard Panel -->
                <div class="admin-panel active" id="dashboard-panel">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-tachometer-alt"></i> Dashboard Overview</h2>
                        <div class="realtime-indicator">
                            <span class="realtime-dot"></span>
                            <span>Real-time Data</span>
                        </div>
                    </div>
                    
                    <div class="dashboard-stats">
                        <div class="stat-card">
                            <div class="stat-number" id="total-users">0</div>
                            <div class="stat-label">Total Users</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-materials">0</div>
                            <div class="stat-label">Materials</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-pyqs">0</div>
                            <div class="stat-label">PYQs</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-seminars">0</div>
                            <div class="stat-label">Seminars</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-quizzes">0</div>
                            <div class="stat-label">Quizzes</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number" id="total-payments">0</div>
                            <div class="stat-label">Transactions</div>
                        </div>
                    </div>
                    
                    <div class="settings-grid">
                        <div class="chart-container">
                            <canvas id="user-growth-chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <canvas id="activity-chart"></canvas>
                        </div>
                    </div>
                </div>
                
                <!-- Notices Panel -->
                <div class="admin-panel" id="notices-panel">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-bullhorn"></i> Notices Management</h2>
                        <button class="btn-primary" id="add-notice-btn">
                            <i class="fas fa-plus"></i> Add Notice
                        </button>
                    </div>
                    
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" id="notice-search" placeholder="Search notices...">
                    </div>
                    
                    <div class="notices-list" id="notices-list">
                        <div class="spinner-container">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Users Panel -->
                <div class="admin-panel" id="users-panel">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-users"></i> User Management</h2>
                        <button class="btn-primary" id="add-user-btn">
                            <i class="fas fa-user-plus"></i> Add User
                        </button>
                    </div>
                    
                    <div class="filter-container">
                        <div class="search-container" style="flex: 1;">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="user-search" placeholder="Search users...">
                        </div>
                        <select class="filter-select" id="user-role-filter">
                            <option value="">All Roles</option>
                            <option value="student">Students</option>
                            <option value="faculty">Faculty</option>
                            <option value="admin">Admins</option>
                        </select>
                        <select class="filter-select" id="user-status-filter">
                            <option value="">All Status</option>
                            <option value="active">Active</option>
                            <option value="inactive">Inactive</option>
                        </select>
                    </div>
                    
                    <div class="users-list" id="users-list">
                        <div class="spinner-container">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Materials Panel -->
                <div class="admin-panel" id="materials-panel">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-book"></i> Materials Management</h2>
                        <button class="btn-primary" id="add-material-btn">
                            <i class="fas fa-plus"></i> Add Material
                        </button>
                    </div>
                    
                    <div class="filter-container">
                        <div class="search-container" style="flex: 1;">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="material-search" placeholder="Search materials...">
                        </div>
                        <select class="filter-select" id="material-branch-filter">
                            <option value="">All Branches</option>
                        </select>
                        <select class="filter-select" id="material-semester-filter">
                            <option value="">All Semesters</option>
                            <option value="1">Semester 1</option>
                            <option value="2">Semester 2</option>
                            <option value="3">Semester 3</option>
                            <option value="4">Semester 4</option>
                            <option value="5">Semester 5</option>
                            <option value="6">Semester 6</option>
                            <option value="7">Semester 7</option>
                            <option value="8">Semester 8</option>
                        </select>
                    </div>
                    
                    <div class="materials-list" id="materials-list">
                        <div class="spinner-container">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                
                <!-- PYQs Panel -->
                <div class="admin-panel" id="pyqs-panel">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-file-alt"></i> PYQs Management</h2>
                        <button class="btn-primary" id="add-pyq-btn">
                            <i class="fas fa-plus"></i> Add PYQ
                        </button>
                    </div>
                    
                    <div class="filter-container">
                        <div class="search-container" style="flex: 1;">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="pyq-search" placeholder="Search PYQs...">
                        </div>
                        <select class="filter-select" id="pyq-branch-filter">
                            <option value="">All Branches</option>
                        </select>
                        <select class="filter-select" id="pyq-semester-filter">
                            <option value="">All Semesters</option>
                            <option value="1">Semester 1</option>
                            <option value="2">Semester 2</option>
                            <option value="3">Semester 3</option>
                            <option value="4">Semester 4</option>
                            <option value="5">Semester 5</option>
                            <option value="6">Semester 6</option>
                            <option value="7">Semester 7</option>
                            <option value="8">Semester 8</option>
                        </select>
                    </div>
                    
                    <div class="pyqs-list" id="pyqs-list">
                        <div class="spinner-container">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Quizzes Panel -->
                <div class="admin-panel" id="quizzes-panel">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-question-circle"></i> Quizzes Management</h2>
                        <button class="btn-primary" id="add-quiz-btn">
                            <i class="fas fa-plus"></i> Add Quiz
                        </button>
                    </div>
                    
                    <div class="filter-container">
                        <div class="search-container" style="flex: 1;">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="quiz-search" placeholder="Search quizzes...">
                        </div>
                        <select class="filter-select" id="quiz-branch-filter">
                            <option value="">All Branches</option>
                        </select>
                        <select class="filter-select" id="quiz-semester-filter">
                            <option value="">All Semesters</option>
                            <option value="1">Semester 1</option>
                            <option value="2">Semester 2</option>
                            <option value="3">Semester 3</option>
                            <option value="4">Semester 4</option>
                            <option value="5">Semester 5</option>
                            <option value="6">Semester 6</option>
                            <option value="7">Semester 7</option>
                            <option value="8">Semester 8</option>
                        </select>
                    </div>
                    
                    <div class="quizzes-list" id="quizzes-list">
                        <div class="spinner-container">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Seminars Panel -->
                <div class="admin-panel" id="seminars-panel">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-chalkboard-teacher"></i> Seminars Management</h2>
                        <button class="btn-primary" id="add-seminar-btn">
                            <i class="fas fa-plus"></i> Add Seminar
                        </button>
                    </div>
                    
                    <div class="search-container">
                        <i class="fas fa-search search-icon"></i>
                        <input type="text" class="search-input" id="seminar-search" placeholder="Search seminars...">
                    </div>
                    
                    <div class="seminars-list" id="seminars-list">
                        <div class="spinner-container">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Payments Panel -->
                <div class="admin-panel" id="payments-panel">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-credit-card"></i> Payment History</h2>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            <button class="btn-secondary" id="export-payments-btn">
                                <i class="fas fa-download"></i> Export
                            </button>
                            <button class="btn-secondary" id="refresh-payments-btn">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                    </div>
                    
                    <div class="filter-container">
                        <div class="search-container" style="flex: 1;">
                            <i class="fas fa-search search-icon"></i>
                            <input type="text" class="search-input" id="payment-search" placeholder="Search transactions...">
                        </div>
                        <select class="filter-select" id="payment-type-filter">
                            <option value="">All Types</option>
                            <option value="earn">Credits Earned</option>
                            <option value="spend">Credits Spent</option>
                        </select>
                        <input type="date" class="filter-select" id="payment-date-filter">
                    </div>
                    
                    <div class="payments-list" id="payments-list">
                        <div class="spinner-container">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Analytics Panel -->
                <div class="admin-panel" id="analytics-panel">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-chart-line"></i> Platform Analytics</h2>
                        <div class="realtime-indicator">
                            <span class="realtime-dot"></span>
                            <span>Live Data</span>
                        </div>
                    </div>
                    
                    <div class="settings-grid">
                        <div class="chart-container">
                            <canvas id="material-usage-chart"></canvas>
                        </div>
                        <div class="chart-container">
                            <canvas id="user-engagement-chart"></canvas>
                        </div>
                    </div>
                    
                    <div class="chart-container" style="height: 400px; margin-top: 20px;">
                        <canvas id="revenue-chart"></canvas>
                    </div>
                </div>
                
                <!-- Settings Panel -->
                <div class="admin-panel" id="settings-panel">
                    <div class="section-header">
                        <h2 class="section-title"><i class="fas fa-cog"></i> System Settings</h2>
                    </div>
                    
                    <div class="settings-section">
                        <h3>General Settings</h3>
                        <div class="settings-grid">
                            <div class="setting-item">
                                <div class="setting-header">
                                    <div class="setting-title">User Registration</div>
                                    <div class="toggle-switch active" id="registration-toggle">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">Allow new users to register on the platform</p>
                            </div>
                            <div class="setting-item">
                                <div class="setting-header">
                                    <div class="setting-title">Email Notifications</div>
                                    <div class="toggle-switch active" id="email-toggle">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">Send email notifications to users</p>
                            </div>
                            <div class="setting-item">
                                <div class="setting-header">
                                    <div class="setting-title">Maintenance Mode</div>
                                    <div class="toggle-switch" id="maintenance-toggle">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">Put the platform in maintenance mode</p>
                            </div>
                            <div class="setting-item">
                                <div class="setting-header">
                                    <div class="setting-title">Analytics Tracking</div>
                                    <div class="toggle-switch active" id="analytics-toggle">
                                        <div class="toggle-slider"></div>
                                    </div>
                                </div>
                                <p style="color: var(--text-secondary); font-size: 0.9rem;">Track user analytics and platform usage</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>Platform Configuration</h3>
                        <div class="form-group">
                            <label class="form-label">Platform Name</label>
                            <input type="text" class="form-input" id="platform-name" value="IB STUDIOZ">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Admin Email</label>
                            <input type="email" class="form-input" id="admin-email" value="admin@ibstudioz.com">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Support Contact</label>
                            <input type="text" class="form-input" id="support-contact" value="+1 (555) 123-4567">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Default Credits</label>
                            <input type="number" class="form-input" id="default-credits" value="100">
                        </div>
                        <button class="btn-primary" id="save-settings-btn">Save Settings</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Notice Modal -->
        <div id="notice-modal" class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h2 id="notice-modal-title">Add Notice</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="notice-form">
                    <input type="hidden" id="notice-id">
                    <div class="form-group">
                        <label class="form-label">Title</label>
                        <input type="text" class="form-input" id="notice-title" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Message</label>
                        <textarea class="form-textarea" id="notice-message" required></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Important</label>
                            <select class="form-select" id="notice-important">
                                <option value="false">No</option>
                                <option value="true">Yes</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Target Audience</label>
                            <select class="form-select" id="notice-audience">
                                <option value="all">All Users</option>
                                <option value="students">Students Only</option>
                                <option value="faculty">Faculty Only</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">Save Notice</button>
                </form>
            </div>
        </div>
        
        <!-- User Modal -->
        <div id="user-modal" class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h2 id="user-modal-title">Add User</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="user-form">
                    <input type="hidden" id="user-id">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Full Name</label>
                            <input type="text" class="form-input" id="user-name" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-input" id="user-email" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Phone Number</label>
                            <input type="tel" class="form-input" id="user-phone" placeholder="Enter phone number">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Date of Birth</label>
                            <input type="date" class="form-input" id="user-dob">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Gender</label>
                            <select class="form-select" id="user-gender">
                                <option value="">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                                <option value="other">Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Admission No</label>
                            <input type="text" class="form-input" id="user-admission">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Branch</label>
                            <input type="text" class="form-input" id="user-branch">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Semester</label>
                            <input type="text" class="form-input" id="user-semester">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">College</label>
                            <input type="text" class="form-input" id="user-college">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Role</label>
                            <select class="form-select" id="user-role">
                                <option value="student">Student</option>
                                <option value="faculty">Faculty</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Bio</label>
                        <textarea class="form-textarea" id="user-bio" placeholder="Tell us about the user"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Photo URL</label>
                        <input type="url" class="form-input" id="user-photoURL" placeholder="https://example.com/photo.jpg">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Credits</label>
                        <input type="number" class="form-input" id="user-credits" value="100">
                    </div>
                    <button type="submit" class="btn-primary">Save User</button>
                </form>
            </div>
        </div>
        
        <!-- Material Modal -->
        <div id="material-modal" class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h2 id="material-modal-title">Add Material</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="material-form">
                    <input type="hidden" id="material-id">
                    <div class="form-group">
                        <label class="form-label">Title</label>
                        <input type="text" class="form-input" id="material-title" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-textarea" id="material-description"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Subject</label>
                        <input type="text" class="form-input" id="material-subject" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Google Drive Link</label>
                        <input type="url" class="form-input" id="material-link" placeholder="https://drive.google.com/file/d/..." required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Thumbnail Image URL</label>
                        <input type="url" class="form-input" id="material-thumbnail" placeholder="https://example.com/image.jpg">
                        <img id="thumbnail-preview" class="thumbnail-preview" style="display: none;">
                    </div>
                    
                    <!-- Branch-Semester-Course Selection Display -->
                    <div class="form-group" id="material-selection-display" style="display: none;">
                        <label class="form-label">Selected Branch, Semester & Course</label>
                        <div class="selected-display">
                            <div class="selected-item">
                                <div class="selected-label">Branch</div>
                                <div class="selected-value" id="material-selected-branch">-</div>
                            </div>
                            <div class="selected-item">
                                <div class="selected-label">Semester</div>
                                <div class="selected-value" id="material-selected-semester">-</div>
                            </div>
                            <div class="selected-item">
                                <div class="selected-label">Course</div>
                                <div class="selected-value" id="material-selected-course">-</div>
                            </div>
                            <button type="button" class="change-selection-btn" id="change-material-selection">Change</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Branch</label>
                            <select class="form-select" id="material-branch">
                                <option value="">All Branches</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Semester</label>
                            <select class="form-select" id="material-semester">
                                <option value="">All Semesters</option>
                                <option value="1">Semester 1</option>
                                <option value="2">Semester 2</option>
                                <option value="3">Semester 3</option>
                                <option value="4">Semester 4</option>
                                <option value="5">Semester 5</option>
                                <option value="6">Semester 6</option>
                                <option value="7">Semester 7</option>
                                <option value="8">Semester 8</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">Save Material</button>
                </form>
            </div>
        </div>
        
        <!-- PYQ Modal -->
        <div id="pyq-modal" class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h2 id="pyq-modal-title">Add PYQ</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="pyq-form">
                    <input type="hidden" id="pyq-id">
                    <div class="form-group">
                        <label class="form-label">Title</label>
                        <input type="text" class="form-input" id="pyq-title" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Subject</label>
                        <input type="text" class="form-input" id="pyq-subject" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Year</label>
                        <input type="text" class="form-input" id="pyq-year" placeholder="e.g., 2023" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Google Drive Link</label>
                        <input type="url" class="form-input" id="pyq-link" placeholder="https://drive.google.com/file/d/..." required>
                    </div>
                    
                    <!-- Branch-Semester-Course Selection Display -->
                    <div class="form-group" id="pyq-selection-display" style="display: none;">
                        <label class="form-label">Selected Branch, Semester & Course</label>
                        <div class="selected-display">
                            <div class="selected-item">
                                <div class="selected-label">Branch</div>
                                <div class="selected-value" id="pyq-selected-branch">-</div>
                            </div>
                            <div class="selected-item">
                                <div class="selected-label">Semester</div>
                                <div class="selected-value" id="pyq-selected-semester">-</div>
                            </div>
                            <div class="selected-item">
                                <div class="selected-label">Course</div>
                                <div class="selected-value" id="pyq-selected-course">-</div>
                            </div>
                            <button type="button" class="change-selection-btn" id="change-pyq-selection">Change</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Branch</label>
                            <select class="form-select" id="pyq-branch">
                                <option value="">All Branches</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Semester</label>
                            <select class="form-select" id="pyq-semester">
                                <option value="">All Semesters</option>
                                <option value="1">Semester 1</option>
                                <option value="2">Semester 2</option>
                                <option value="3">Semester 3</option>
                                <option value="4">Semester 4</option>
                                <option value="5">Semester 5</option>
                                <option value="6">Semester 6</option>
                                <option value="7">Semester 7</option>
                                <option value="8">Semester 8</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">Save PYQ</button>
                </form>
            </div>
        </div>
        
        <!-- Quiz Modal -->
        <div id="quiz-modal" class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h2 id="quiz-modal-title">Add Quiz</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="quiz-form">
                    <input type="hidden" id="quiz-id">
                    <div class="form-group">
                        <label class="form-label">Title</label>
                        <input type="text" class="form-input" id="quiz-title" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-textarea" id="quiz-description"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Subject</label>
                        <input type="text" class="form-input" id="quiz-subject" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Time Limit (minutes)</label>
                        <input type="number" class="form-input" id="quiz-time" min="1" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Difficulty</label>
                        <select class="form-select" id="quiz-difficulty">
                            <option value="easy">Easy</option>
                            <option value="medium">Medium</option>
                            <option value="hard">Hard</option>
                        </select>
                    </div>
                    
                    <!-- Branch-Semester-Course Selection Display -->
                    <div class="form-group" id="quiz-selection-display" style="display: none;">
                        <label class="form-label">Selected Branch, Semester & Course</label>
                        <div class="selected-display">
                            <div class="selected-item">
                                <div class="selected-label">Branch</div>
                                <div class="selected-value" id="quiz-selected-branch">-</div>
                            </div>
                            <div class="selected-item">
                                <div class="selected-label">Semester</div>
                                <div class="selected-value" id="quiz-selected-semester">-</div>
                            </div>
                            <div class="selected-item">
                                <div class="selected-label">Course</div>
                                <div class="selected-value" id="quiz-selected-course">-</div>
                            </div>
                            <button type="button" class="change-selection-btn" id="change-quiz-selection">Change</button>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Branch</label>
                            <select class="form-select" id="quiz-branch">
                                <option value="">All Branches</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Semester</label>
                            <select class="form-select" id="quiz-semester">
                                <option value="">All Semesters</option>
                                <option value="1">Semester 1</option>
                                <option value="2">Semester 2</option>
                                <option value="3">Semester 3</option>
                                <option value="4">Semester 4</option>
                                <option value="5">Semester 5</option>
                                <option value="6">Semester 6</option>
                                <option value="7">Semester 7</option>
                                <option value="8">Semester 8</option>
                            </select>
                        </div>
                    </div>
                    <button type="submit" class="btn-primary">Save Quiz</button>
                </form>
            </div>
        </div>
        
        <!-- Seminar Modal -->
        <div id="seminar-modal" class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h2 id="seminar-modal-title">Add Seminar</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <form id="seminar-form">
                    <input type="hidden" id="seminar-id">
                    <div class="form-group">
                        <label class="form-label">Title</label>
                        <input type="text" class="form-input" id="seminar-title" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Description</label>
                        <textarea class="form-textarea" id="seminar-description"></textarea>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Speaker</label>
                        <input type="text" class="form-input" id="seminar-speaker" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Date & Time</label>
                        <input type="datetime-local" class="form-input" id="seminar-datetime" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Video Link</label>
                        <input type="url" class="form-input" id="seminar-link" placeholder="https://youtube.com/watch?v=..." required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Thumbnail Image URL</label>
                        <input type="url" class="form-input" id="seminar-thumbnail" placeholder="https://example.com/image.jpg">
                        <img id="seminar-thumbnail-preview" class="thumbnail-preview" style="display: none;">
                    </div>
                    <button type="submit" class="btn-primary">Save Seminar</button>
                </form>
            </div>
        </div>
        
        <!-- Branch-Semester-Course Selection Modal -->
        <div id="branch-semester-course-modal" class="branch-semester-course-modal">
            <div class="modal">
                <div class="selection-header">
                    <h2>Select Branch, Semester, and Course</h2>
                    <button class="modal-close">&times;</button>
                </div>
                
                <div class="selection-steps">
                    <div class="step active" data-step="branch">
                        <div class="step-number">1</div>
                        <div class="step-title">Branch</div>
                    </div>
                    <div class="step" data-step="semester">
                        <div class="step-number">2</div>
                        <div class="step-title">Semester</div>
                    </div>
                    <div class="step" data-step="course">
                        <div class="step-number">3</div>
                        <div class="step-title">Course</div>
                    </div>
                </div>
                
                <div class="selection-content">
                    <!-- Branch Selection Step -->
                    <div class="selection-step active" id="branch-step">
                        <h3 style="margin-bottom: 20px;">Select Branch</h3>
                        <div class="selection-grid" id="branch-options">
                            <!-- Branch options will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Semester Selection Step -->
                    <div class="selection-step" id="semester-step">
                        <h3 style="margin-bottom: 20px;">Select Semester</h3>
                        <div class="selection-grid" id="semester-options">
                            <!-- Semester options will be populated here -->
                        </div>
                    </div>
                    
                    <!-- Course Selection Step -->
                    <div class="selection-step" id="course-step">
                        <h3 style="margin-bottom: 20px;">Select Course</h3>
                        <div class="selection-grid" id="course-options">
                            <!-- Course options will be populated here -->
                        </div>
                    </div>
                </div>
                
                <div class="selection-actions">
                    <button class="btn-step btn-prev" id="prev-step-btn" style="display: none;">Previous</button>
                    <button class="btn-step btn-next" id="next-step-btn">Next</button>
                    <button class="btn-step btn-finish" id="finish-selection-btn">Finish</button>
                </div>
            </div>
        </div>
        
        <!-- User View Modal -->
        <div id="user-view-modal" class="modal-overlay">
            <div class="modal">
                <div class="modal-header">
                    <h2 id="user-view-modal-title">User Profile</h2>
                    <button class="modal-close" onclick="closeUserViewModal()">&times;</button>
                </div>
                <div class="modal-body" id="user-view-modal-body">
                    <!-- User details will be injected here -->
                </div>
            </div>
        </div>
        
        <!-- Toast notification -->
        <div id="toast" class="toast">
            <i class="fas fa-check-circle"></i>
            <span id="toast-message">Notification message</span>
            <button class="toast-close">&times;</button>
        </div>
    </main>
    
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        // Initialize Firebase
        const firebaseConfig = { 
            apiKey: "AIzaSyDCmvA9sFCSc5r4ZuFUJuGdO1LDoW7rKao", 
            authDomain: "student-portal-free.firebaseapp.com", 
            projectId: "student-portal-free", 
            storageBucket: "student-portal-free.appspot.com", 
            messagingSenderId: "272865877510", 
            appId: "1:272865877510:web:0875a2502ae55bbf9ead87" 
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        
        // Global variables
        let currentUser = null;
        let userGrowthChart = null;
        let activityChart = null;
        let materialUsageChart = null;
        let userEngagementChart = null;
        let revenueChart = null;
        
        // Branches data with icons and courses
        const branches = {
            "CSE": {
                "name": "Computer Science Engineering", 
                "icon": "fas fa-laptop-code",
                "semesters": {
                    "1": [
                        {"code":"U23ENG101A","name":"Communication Skills in English","credits":3},
                        {"code":"U23MAT102A","name":"Linear Algebra and Calculus With MATLAB","credits":4},
                        {"code":"U23PHY103B","name":"Engineering Physics","credits":3},
                        {"code":"U23PPR105","name":"Problem Solving using Python Programming","credits":3},
                        {"code":"U23BEE106A","name":"Basic Electrical and Electronics Engineering","credits":3},
                        {"code":"U23TAM101","name":"Heritage of Tamils","credits":1},
                        {"code":"U23PHL110","name":"Engineering Physics Lab","credits":1},
                        {"code":"U23BEEL113","name":"Basic Electrical and Electronics Engineering Lab","credits":1},
                        {"code":"U23PPL112","name":"Python Programming Lab","credits":1}
                    ],
                    "2": [
                        {"code":"U23ENG201A","name":"Technical English","credits":2},
                        {"code":"U23MAT202B","name":"Discrete Mathematics","credits":4},
                        {"code":"U23CHE204B","name":"Chemistry For Computer Science","credits":3},
                        {"code":"U23CPR205B","name":"Programming In C","credits":3},
                        {"code":"U23EGR207","name":"Engineering Graphics","credits":3},
                        {"code":"U23EC203","name":"Digital Principles And System Design","credits":3},
                        {"code":"U23CHL211","name":"Chemistry Lab","credits":1},
                        {"code":"U23CPL212","name":"C programming Lab","credits":1},
                        {"code":"U23TAM201","name":"Tamils And Technology","credits":1}
                    ],
                    "3": [
                        {"code":"U23MAT301D","name":"Probability and Statistics","credits":4},
                        {"code":"U23CS301","name":"Data Structures","credits":3},
                        {"code":"U23CS302","name":"Computer Architecture","credits":3},
                        {"code":"U23CS303","name":"Object Oriented Programming","credits":3},
                        {"code":"U23CS304","name":"Operating Systems","credits":3},
                        {"code":"U23CS305","name":"Computer Information and Ethics","credits":3},
                        {"code":"U23CS306","name":"Data Structures Lab","credits":1},
                        {"code":"U23CS307","name":"Object Oriented Programming Lab","credits":1},
                        {"code":"U23GE301","name":"Soft Skills and Aptitude-I","credits":1},
                        {"code":"Noc24-mg72","name":"NPTEL:design Thinking-A Primer","credits":1}
                    ],
                    "4": [
                        {"code":"U23MAT401B","name":"Numerical Methods","credits":4},
                        {"code":"U23CS401","name":"Design And Analysis of Algorithms","credits":3},
                        {"code":"U23CS402","name":"Software Engineering","credits":3},
                        {"code":"U23CS403","name":"DataBase Management Systems","credits":3},
                        {"code":"U23CS404","name":"Embedded System Design ","credits":3},
                        {"code":"U23CS405","name":"Software Development Lab","credits":1},
                        {"code":"U23CS403","name":"Database Management Systems Lab","credits":1}
                    ],
                    "5": [
                        {"code":"U23CS504","name":"Machine Learning","credits":3},
                        {"code":"U23CS501","name":"Computer Networks","credits":3},
                        {"code":"U23CS502","name":"Artificial Intelligence","credits":3},
                        {"code":"U23CS503","name":"Theory of Computation","credits":3},
                        {"code":"noc25-cs135","name":"Elective NPTEL","credits":3},
                        {"code":" U23CS947 / U23CS903","name":"Professional Elective ","credits":3},
                        {"code":"U23CS505","name":"Computer Networks Laboratory","credits":2},
                        {"code":"U23CS506","name":"Artificial Intelligence and Machine Learning Laboratory","credits":1},
                        {"code":"U23GE501","name":"Soft Skills and Aptitude-III","credits":1}
                    ]
                }
            },
            "IT": {
                "name": "Information Technology", 
                "icon": "fas fa-network-wired",
                "semesters": {
                    "1": [
                        {"code":"U23IT101","name":"Programming Fundamentals","credits":4},
                        {"code":"U23IT102","name":"Discrete Mathematics","credits":4},
                        {"code":"U23IT103","name":"Digital Systems","credits":3},
                        {"code":"U23IT104","name":"Computer Organization","credits":3},
                        {"code":"U23IT105","name":"Communication Skills","credits":2},
                        {"code":"U23IT106","name":"Programming Lab","credits":1},
                        {"code":"U23IT107","name":"Digital Systems Lab","credits":1}
                    ],
                    "2": [
                        {"code":"U23IT201","name":"Data Structures","credits":4},
                        {"code":"U23IT202","name":"Database Systems","credits":4},
                        {"code":"U23IT203","name":"Operating Systems","credits":3},
                        {"code":"U23IT204","name":"Computer Networks","credits":3},
                        {"code":"U23IT205","name":"Web Technologies","credits":3},
                        {"code":"U23IT206","name":"Data Structures Lab","credits":1},
                        {"code":"U23IT207","name":"Web Technologies Lab","credits":1}
                    ]
                }
            },
            "ECE": {
                "name": "Electronics & Communication Engineering", 
                "icon": "fas fa-satellite-dish",
                "semesters": {
                    "1": [
                        {"code":"U23EC101","name":"Basic Electronics","credits":4},
                        {"code":"U23EC102","name":"Circuit Theory","credits":4},
                        {"code":"U23EC103","name":"Engineering Mathematics","credits":4},
                        {"code":"U23EC104","name":"Programming in C","credits":3},
                        {"code":"U23EC105","name":"Communication Skills","credits":2},
                        {"code":"U23EC106","name":"Electronics Lab","credits":1},
                        {"code":"U23EC107","name":"Programming Lab","credits":1}
                    ],
                    "2": [
                        {"code":"U23EC201","name":"Analog Electronics","credits":4},
                        {"code":"U23EC202","name":"Digital Electronics","credits":4},
                        {"code":"U23EC203","name":"Signals and Systems","credits":4},
                        {"code":"U23EC204","name":"Electromagnetic Theory","credits":3},
                        {"code":"U23EC205","name":"Data Structures","credits":3},
                        {"code":"U23EC206","name":"Analog Electronics Lab","credits":1},
                        {"code":"U23EC207","name":"Digital Electronics Lab","credits":1}
                    ]
                }
            },
            "EEE": {
                "name": "Electrical & Electronics Engineering", 
                "icon": "fas fa-bolt",
                "semesters": {
                    "1": [
                        {"code":"U23EE101","name":"Basic Electrical Engineering","credits":4},
                        {"code":"U23EE102","name":"Engineering Mathematics","credits":4},
                        {"code":"U23EE103","name":"Electronics Engineering","credits":3},
                        {"code":"U23EE104","name":"Programming in C","credits":3},
                        {"code":"U23EE105","name":"Communication Skills","credits":2},
                        {"code":"U23EE106","name":"Electrical Lab","credits":1},
                        {"code":"U23EE107","name":"Programming Lab","credits":1}
                    ],
                    "2": [
                        {"code":"U23EE201","name":"Circuit Theory","credits":4},
                        {"code":"U23EE202","name":"Electromagnetic Theory","credits":4},
                        {"code":"U23EE203","name":"Digital Electronics","credits":4},
                        {"code":"U23EE204","name":"Electrical Machines","credits":3},
                        {"code":"U23EE205","name":"Data Structures","credits":3},
                        {"code":"U23EE206","name":"Circuit Theory Lab","credits":1},
                        {"code":"U23EE207","name":"Digital Electronics Lab","credits":1}
                    ]
                }
            },
            "MECH": {
                "name": "Mechanical Engineering", 
                "icon": "fas fa-cogs",
                "semesters": {
                    "1": [
                        {"code":"U23ME101","name":"Engineering Mechanics","credits":4},
                        {"code":"U23ME102","name":"Engineering Graphics","credits":4},
                        {"code":"U23ME103","name":"Engineering Mathematics","credits":4},
                        {"code":"U23ME104","name":"Basic Electrical Engineering","credits":3},
                        {"code":"U23ME105","name":"Communication Skills","credits":2},
                        {"code":"U23ME106","name":"Workshop Practice","credits":1},
                        {"code":"U23ME107","name":"Engineering Graphics Lab","credits":1}
                    ],
                    "2": [
                        {"code":"U23ME201","name":"Thermodynamics","credits":4},
                        {"code":"U23ME202","name":"Mechanics of Materials","credits":4},
                        {"code":"U23ME203","name":"Manufacturing Technology","credits":4},
                        {"code":"U23ME204","name":"Fluid Mechanics","credits":3},
                        {"code":"U23ME205","name":"Computer Programming","credits":3},
                        {"code":"U23ME206","name":"Thermodynamics Lab","credits":1},
                        {"code":"U23ME207","name":"Manufacturing Technology Lab","credits":1}
                    ]
                }
            },
            "AIML": {
                "name": "AI & Machine Learning Engineering", 
                "icon": "fas fa-brain",
                "semesters": {
                    "1": [
                        {"code":"U23EG107","name":"Engineering Graphics","credits":3},
                        {"code":"U23ENG101A","name":"Communication Skills in English","credits":3},
                        {"code":"U23MAT102A","name":"Linear Algebra and Calculus with MATLAB","credits":4},
                        {"code":"U23PPR105","name":"Problem Solving using Python Programming","credits":3},
                        {"code":"U23PHY103E","name":"Engineering Physics","credits":3},
                        {"code":"U23PHL110","name":"Engineering Physics Laboratory","credits":1},
                        {"code":"U23PPL112","name":"Python Programming Laboratory","credits":1},
                        {"code":"U23TAM101","name":"Heritage of Tamils","credits":1}
                    ],
                    "2": [
                        {"code":"U23ENG201A","name":"Technical English","credits":2},
                        {"code":"U23MAT202D","name":"Discrete Mathematics","credits":4},
                        {"code":"U23BEEE206B","name":"Basics of Electrical and Electronics Engineering","credits":3},
                        {"code":"U23CPR205","name":"Programming in C","credits":3},
                        {"code":"U23CHE204C","name":"Applied Chemistry","credits":2},
                        {"code":"U23EC203","name":"Digital Principles and System Design","credits":3},
                        {"code":"U23CPL212","name":"C Programming Laboratory","credits":1},
                        {"code":"U23CHL211","name":"Chemistry Laboratory","credits":1},
                        {"code":"U23BEEL213B","name":"BEEE Laboratory","credits":1},
                        {"code":"U23TAM201","name":"Tamils and Technology","credits":1}
                    ],
                    "3": [
                        {"code":"U23MAT301E","name":"Applied Probability and Statistics-I","credits":4},
                        {"code":"U23CS301","name":"Data Structures","credits":3},
                        {"code":"U23CS302","name":"Computer Architecture","credits":3},
                        {"code":"U23CS303","name":"Object Oriented Programming Using Java","credits":3},
                        {"code":"U23AML301","name":"Data Visualization","credits":3},
                        {"code":"noc25-mg106","name":"NPTEL: Design Thinking - A Primer","credits":1},
                        {"code":"U23CS306","name":"Data Structures Laboratory","credits":1},
                        {"code":"U23CS307","name":"Object Oriented Programming Using Java Laboratory","credits":1},
                        {"code":"U23AML302","name":"Data Visualization Laboratory","credits":1},
                        {"code":"U23GE301","name":"Soft Skills and Aptitude-I","credits":1}
                    ],
                    "4": [
                        {"code":"U23MAT401A","name":"Applied Probability and Statistics-II","credits":4},
                        {"code":"U23CS403","name":"Database Management Systems","credits":3},
                        {"code":"U23CS401","name":"Design and Analysis of Algorithms","credits":3},
                        {"code":"U23AML401","name":"Artificial Intelligence","credits":3},
                        {"code":"U23CSD402","name":"Operating Systems","credits":3},
                        {"code":"U23AML402","name":"Artificial Intelligence Lab","credits":1},
                        {"code":"U23CS405","name":"Database Management Systems Lab","credits":1},
                        {"code":"U23GE401","name":"Soft Skills and Aptitude-II","credits":1}
                    ],
                    "5": [
                        {"code":"U23CS504","name":"Machine Learning","credits":3},
                        {"code":"U23CS501","name":"Computer Networks","credits":3},
                        {"code":"U23CSD502","name":"Software Engineering","credits":3},
                        {"code":"U23CS503","name":"Theory of Computation","credits":3},
                        {"code":"noc25-cs135","name":"Elective NPTEL","credits":3},
                        {"code":"U19CS903","name":"Professional Elective - Agile Methodologies","credits":3},
                        {"code":"U23AML501","name":"Machine Learning Laboratory","credits":2},
                        {"code":"U23CSD504","name":"Software Development Laboratory","credits":1},
                        {"code":"U23GE501","name":"Soft Skills and Aptitude -III","credits":1}
                    ],
                    "6": [
                        {"code":"U23CS601","name":"Computer Vision","credits":3},
                        {"code":"U23CS602","name":"Reinforcement Learning","credits":3},
                        {"code":"U23CS603","name":"Robotics","credits":3},
                        {"code":"U23CS604","name":"Cyber Security","credits":3},
                        {"code":"U23CS605","name":"Blockchain Technology","credits":3},
                        {"code":"U23CS606","name":"Elective III","credits":3},
                        {"code":"U23CS607","name":"Project Work II","credits":3}
                    ],
                    "7": [
                        {"code":"U23CS701","name":"Advanced Machine Learning","credits":3},
                        {"code":"U23CS702","name":"AI Ethics and Governance","credits":3},
                        {"code":"U23CS703","name":"Elective IV","credits":3},
                        {"code":"U23CS704","name":"Project Work III","credits":3}
                    ],
                    "8": [
                        {"code":"U23CS801","name":"Industry Internship","credits":6},
                        {"code":"U23CS802","name":"Project Work IV","credits":6}
                    ]
                }
            },
            "CIVIL": {
                "name": "Civil Engineering", 
                "icon": "fas fa-building",
                "semesters": {
                    "1": [
                        {"code":"U23CE101","name":"Engineering Mechanics","credits":4},
                        {"code":"U23CE102","name":"Engineering Graphics","credits":4},
                        {"code":"U23CE103","name":"Engineering Mathematics","credits":4},
                        {"code":"U23CE104","name":"Basic Civil Engineering","credits":3},
                        {"code":"U23CE105","name":"Communication Skills","credits":2},
                        {"code":"U23CE106","name":"Surveying","credits":1},
                        {"code":"U23CE107","name":"Engineering Graphics Lab","credits":1}
                    ],
                    "2": [
                        {"code":"U23CE201","name":"Building Materials","credits":4},
                        {"code":"U23CE202","name":"Structural Analysis","credits":4},
                        {"code":"U23CE203","name":"Fluid Mechanics","credits":4},
                        {"code":"U23CE204","name":"Surveying","credits":3},
                        {"code":"U23CE205","name":"Computer Programming","credits":3},
                        {"code":"U23CE206","name":"Building Materials Lab","credits":1},
                        {"code":"U23CE207","name":"Surveying Lab","credits":1}
                    ]
                }
            },
            "BME": {
                "name": "Bio Medical Engineering", 
                "icon": "fas fa-heartbeat",
                "semesters": {
                    "1": [
                        {"code":"U23BM101","name":"Human Anatomy","credits":4},
                        {"code":"U23BM102","name":"Engineering Mathematics","credits":4},
                        {"code":"U23BM103","name":"Basic Electronics","credits":3},
                        {"code":"U23BM104","name":"Programming in C","credits":3},
                        {"code":"U23BM105","name":"Communication Skills","credits":2},
                        {"code":"U23BM106","name":"Human Anatomy Lab","credits":1},
                        {"code":"U23BM107","name":"Programming Lab","credits":1}
                    ],
                    "2": [
                        {"code":"U23BM201","name":"Human Physiology","credits":4},
                        {"code":"U23BM202","name":"Biochemistry","credits":4},
                        {"code":"U23BM203","name":"Medical Electronics","credits":4},
                        {"code":"U23BM204","name":"Biomechanics","credits":3},
                        {"code":"U23BM205","name":"Data Structures","credits":3},
                        {"code":"U23BM206","name":"Human Physiology Lab","credits":1},
                        {"code":"U23BM207","name":"Medical Electronics Lab","credits":1}
                    ]
                }
            },
            "FT": {
                "name": "Fashion Technology", 
                "icon": "fas fa-tshirt",
                "semesters": {
                    "1": [
                        {"code":"U23FT101","name":"Fiber Science","credits":4},
                        {"code":"U23FT102","name":"Textile Chemistry","credits":4},
                        {"code":"U23FT103","name":"Fashion Illustration","credits":3},
                        {"code":"U23FT104","name":"Pattern Making","credits":3},
                        {"code":"U23FT105","name":"Communication Skills","credits":2},
                        {"code":"U23FT106","name":"Textile Chemistry Lab","credits":1},
                        {"code":"U23FT107","name":"Pattern Making Lab","credits":1}
                    ],
                    "2": [
                        {"code":"U23FT201","name":"Textile Processing","credits":4},
                        {"code":"U23FT202","name":"Apparel Manufacturing","credits":4},
                        {"code":"U23FT203","name":"Fashion Design","credits":4},
                        {"code":"U23FT204","name":"Garment Construction","credits":3},
                        {"code":"U23FT205","name":"Computer Applications","credits":3},
                        {"code":"U23FT206","name":"Apparel Manufacturing Lab","credits":1},
                        {"code":"U23FT207","name":"Garment Construction Lab","credits":1}
                    ]
                }
            },
            "MCT": {
                "name": "Mechatronics Engineering", 
                "icon": "fas fa-robot",
                "semesters": {
                    "1": [
                        {"code":"U23MT101","name":"Engineering Mechanics","credits":4},
                        {"code":"U23MT102","name":"Engineering Graphics","credits":4},
                        {"code":"U23MT103","name":"Engineering Mathematics","credits":4},
                        {"code":"U23MT104","name":"Basic Electronics","credits":3},
                        {"code":"U23MT105","name":"Communication Skills","credits":2},
                        {"code":"U23MT106","name":"Workshop Practice","credits":1},
                        {"code":"U23MT107","name":"Engineering Graphics Lab","credits":1}
                    ],
                    "2": [
                        {"code":"U23MT201","name":"Thermodynamics","credits":4},
                        {"code":"U23MT202","name":"Mechanics of Materials","credits":4},
                        {"code":"U23MT203","name":"Digital Electronics","credits":4},
                        {"code":"U23MT204","name":"Fluid Mechanics","credits":3},
                        {"code":"U23MT205","name":"Computer Programming","credits":3},
                        {"code":"U23MT206","name":"Thermodynamics Lab","credits":1},
                        {"code":"U23MT207","name":"Digital Electronics Lab","credits":1}
                    ]
                }
            },
            "CSD": {
                "name": "Computer Science & Design", 
                "icon": "fas fa-paint-brush",
                "semesters": {
                    "1": [
                        {"code":"U23CD101","name":"Design Fundamentals","credits":4},
                        {"code":"U23CD102","name":"Programming Basics","credits":4},
                        {"code":"U23CD103","name":"Visual Communication","credits":3},
                        {"code":"U23CD104","name":"Mathematics for Design","credits":3},
                        {"code":"U23CD105","name":"Communication Skills","credits":2},
                        {"code":"U23CD106","name":"Design Studio","credits":1},
                        {"code":"U23CD107","name":"Programming Lab","credits":1}
                    ],
                    "2": [
                        {"code":"U23CD201","name":"User Interface Design","credits":4},
                        {"code":"U23CD202","name":"Data Structures","credits":4},
                        {"code":"U23CD203","name":"Web Design","credits":4},
                        {"code":"U23CD204","name":"Digital Illustration","credits":3},
                        {"code":"U23CD205","name":"Human-Computer Interaction","credits":3},
                        {"code":"U23CD206","name":"UI Design Lab","credits":1},
                        {"code":"U23CD207","name":"Web Design Lab","credits":1}
                    ]
                }
            },
            "ADS": {
                "name": "AI & Data Science Engineering", 
                "icon": "fas fa-database",
                "semesters": {
                    "1": [
                        {"code":"U23DS101","name":"Programming Fundamentals","credits":4},
                        {"code":"U23DS102","name":"Linear Algebra","credits":4},
                        {"code":"U23DS103","name":"Statistics Basics","credits":3},
                        {"code":"U23DS104","name":"Computational Thinking","credits":3},
                        {"code":"U23DS105","name":"Communication Skills","credits":2},
                        {"code":"U23DS106","name":"Programming Lab","credits":1},
                        {"code":"U23DS107","name":"Statistics Lab","credits":1}
                    ],
                    "2": [
                        {"code":"U23DS201","name":"Data Structures","credits":4},
                        {"code":"U23DS202","name":"Probability and Statistics","credits":4},
                        {"code":"U23DS203","name":"Database Systems","credits":4},
                        {"code":"U23DS204","name":"Data Visualization","credits":3},
                        {"code":"U23DS205","name":"Python Programming","credits":3},
                        {"code":"U23DS206","name":"Data Structures Lab","credits":1},
                        {"code":"U23DS207","name":"Database Lab","credits":1}
                    ]
                }
            },
            "EFE": {
                "name": "Electrical & Computer Engineering", 
                "icon": "fas fa-microchip",
                "semesters": {
                    "1": [
                        {"code":"U23EF101","name":"Circuit Theory","credits":4},
                        {"code":"U23EF102","name":"Programming Fundamentals","credits":4},
                        {"code":"U23EF103","name":"Digital Electronics","credits":3},
                        {"code":"U23EF104","name":"Engineering Mathematics","credits":3},
                        {"code":"U23EF105","name":"Communication Skills","credits":2},
                        {"code":"U23EF106","name":"Circuit Theory Lab","credits":1},
                        {"code":"U23EF107","name":"Programming Lab","credits":1}
                    ],
                    "2": [
                        {"code":"U23EF201","name":"Signals and Systems","credits":4},
                        {"code":"U23EF202","name":"Data Structures","credits":4},
                        {"code":"U23EF203","name":"Analog Electronics","credits":4},
                        {"code":"U23EF204","name":"Electromagnetic Theory","credits":3},
                        {"code":"U23EF205","name":"Computer Organization","credits":3},
                        {"code":"U23EF206","name":"Analog Electronics Lab","credits":1},
                        {"code":"U23EF207","name":"Data Structures Lab","credits":1}
                    ]
                }
            },
            "EXE": {
                "name": "Electronics & Computer Engineering", 
                "icon": "fas fa-desktop",
                "semesters": {
                    "1": [
                        {"code":"U23EX101","name":"Basic Electronics","credits":4},
                        {"code":"U23EX102","name":"Programming Fundamentals","credits":4},
                        {"code":"U23EX103","name":"Digital Logic Design","credits":3},
                        {"code":"U23EX104","name":"Engineering Mathematics","credits":3},
                        {"code":"U23EX105","name":"Communication Skills","credits":2},
                        {"code":"U23EX106","name":"Electronics Lab","credits":1},
                        {"code":"U23EX107","name":"Programming Lab","credits":1}
                    ],
                    "2": [
                        {"code":"U23EX201","name":"Data Structures","credits":4},
                        {"code":"U23EX202","name":"Analog Electronics","credits":4},
                        {"code":"U23EX203","name":"Computer Organization","credits":4},
                        {"code":"U23EX204","name":"Signals and Systems","credits":3},
                        {"code":"U23EX205","name":"Database Systems","credits":3},
                        {"code":"U23EX206","name":"Analog Electronics Lab","credits":1},
                        {"code":"U23EX207","name":"Data Structures Lab","credits":1}
                    ]
                }
            }
        };
        
        // Function to validate Google Drive link
        function isValidGoogleDriveLink(link) {
            if (!link) return false;
            
            // Convert to lowercase for case-insensitive matching
            const lowerLink = link.toLowerCase();
            
            // Check for various valid Google Drive link patterns
            const patterns = [
                'drive.google.com',
                'docs.google.com',
                'sheets.google.com',
                'slides.google.com',
                'forms.google.com',
                'sites.google.com',
                'google.com/drive',
                'google.com/file/d/',
                'google.com/open?id=',
                'google.com/uc?id='
            ];
            
            // Check if the link contains any of the valid patterns
            for (const pattern of patterns) {
                if (lowerLink.includes(pattern)) {
                    return true;
                }
            }
            
            return false;
        }
        
        // Function to create custom dropdown
        function createCustomDropdown(selectElement) {
            if (!selectElement) return;
            
            const wrapper = document.createElement('div');
            wrapper.className = 'custom-select';
            
            const trigger = document.createElement('div');
            trigger.className = 'custom-select-trigger';
            
            const dropdown = document.createElement('div');
            dropdown.className = 'custom-select-dropdown';
            
            // Hide original select
            selectElement.classList.add('custom-select-original');
            selectElement.parentNode.insertBefore(wrapper, selectElement);
            wrapper.appendChild(selectElement);
            
            // Create trigger content
            const triggerContent = document.createElement('div');
            triggerContent.style.display = 'flex';
            triggerContent.style.alignItems = 'center';
            
            const arrow = document.createElement('i');
            arrow.className = 'fas fa-chevron-down arrow';
            
            trigger.appendChild(triggerContent);
            trigger.appendChild(arrow);
            wrapper.appendChild(trigger);
            wrapper.appendChild(dropdown);
            
            // Populate dropdown options
            for (let i = 0; i < selectElement.options.length; i++) {
                const option = selectElement.options[i];
                const optionElement = document.createElement('div');
                optionElement.className = 'custom-select-option';
                optionElement.dataset.value = option.value;
                
                if (option.value && branches[option.value]) {
                    const icon = document.createElement('i');
                    icon.className = branches[option.value].icon;
                    optionElement.appendChild(icon);
                    optionElement.appendChild(document.createTextNode(option.textContent));
                } else {
                    optionElement.textContent = option.textContent;
                }
                
                if (option.selected) {
                    optionElement.classList.add('selected');
                    triggerContent.innerHTML = optionElement.innerHTML;
                }
                
                optionElement.addEventListener('click', function() {
                    // Update selected option
                    document.querySelectorAll('.custom-select-option').forEach(opt => {
                        opt.classList.remove('selected');
                    });
                    this.classList.add('selected');
                    
                    // Update trigger content
                    triggerContent.innerHTML = this.innerHTML;
                    
                    // Update original select
                    selectElement.value = this.dataset.value;
                    selectElement.dispatchEvent(new Event('change'));
                    
                    // Close dropdown
                    wrapper.classList.remove('open');
                });
                
                dropdown.appendChild(optionElement);
            }
            
            // Toggle dropdown on trigger click
            trigger.addEventListener('click', function(e) {
                e.stopPropagation();
                wrapper.classList.toggle('open');
                
                // Close other dropdowns
                document.querySelectorAll('.custom-select.open').forEach(dropdown => {
                    if (dropdown !== wrapper) {
                        dropdown.classList.remove('open');
                    }
                });
            });
            
            // Close dropdown when clicking outside
            document.addEventListener('click', function() {
                wrapper.classList.remove('open');
            });
            
            // Prevent dropdown from closing when clicking inside
            dropdown.addEventListener('click', function(e) {
                e.stopPropagation();
            });
        }
        
        // Initialize custom dropdowns for branch selects
        function initializeBranchDropdowns() {
            const branchSelectIds = [
                'material-branch-filter', 'pyq-branch-filter', 'quiz-branch-filter',
                'material-branch', 'pyq-branch', 'quiz-branch'
            ];
            
            branchSelectIds.forEach(id => {
                const select = document.getElementById(id);
                if (!select) return;
                
                // Clear existing options except the first one
                while (select.options.length > 1) {
                    select.remove(1);
                }
                
                // Add branch options
                for (const code in branches) {
                    const option = document.createElement('option');
                    option.value = code;
                    option.textContent = branches[code].name;
                    select.appendChild(option);
                }
                
                // Create custom dropdown
                createCustomDropdown(select);
            });
        }
        
        // DOM Elements
        const logoutBtn = document.getElementById('logout-btn');
        const profileBtn = document.getElementById('profile-btn');
        const adminNavItems = document.querySelectorAll('.admin-nav-item');
        const adminPanels = document.querySelectorAll('.admin-panel');
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toast-message');
        const loadingOverlay = document.getElementById('loading-overlay');
        const logoutAnimation = document.getElementById('logout-animation');
        
        // Modal elements
        const noticeModal = document.getElementById('notice-modal');
        const userModal = document.getElementById('user-modal');
        const materialModal = document.getElementById('material-modal');
        const pyqModal = document.getElementById('pyq-modal');
        const quizModal = document.getElementById('quiz-modal');
        const seminarModal = document.getElementById('seminar-modal');
        const branchSemesterCourseModal = document.getElementById('branch-semester-course-modal');
        const userViewModal = document.getElementById('user-view-modal');
        
        // Form elements
        const noticeForm = document.getElementById('notice-form');
        const userForm = document.getElementById('user-form');
        const materialForm = document.getElementById('material-form');
        const pyqForm = document.getElementById('pyq-form');
        const quizForm = document.getElementById('quiz-form');
        const seminarForm = document.getElementById('seminar-form');
        
        // Search elements
        const noticeSearch = document.getElementById('notice-search');
        const userSearch = document.getElementById('user-search');
        const materialSearch = document.getElementById('material-search');
        const pyqSearch = document.getElementById('pyq-search');
        const quizSearch = document.getElementById('quiz-search');
        const seminarSearch = document.getElementById('seminar-search');
        const paymentSearch = document.getElementById('payment-search');
        
        // Filter elements
        const userRoleFilter = document.getElementById('user-role-filter');
        const userStatusFilter = document.getElementById('user-status-filter');
        const materialBranchFilter = document.getElementById('material-branch-filter');
        const materialSemesterFilter = document.getElementById('material-semester-filter');
        const pyqBranchFilter = document.getElementById('pyq-branch-filter');
        const pyqSemesterFilter = document.getElementById('pyq-semester-filter');
        const quizBranchFilter = document.getElementById('quiz-branch-filter');
        const quizSemesterFilter = document.getElementById('quiz-semester-filter');
        const paymentTypeFilter = document.getElementById('payment-type-filter');
        const paymentDateFilter = document.getElementById('payment-date-filter');
        
        // Branch-Semester-Course Selection Modal Elements
        const modalCloseBtn = branchSemesterCourseModal.querySelector('.modal-close');
        const prevStepBtn = document.getElementById('prev-step-btn');
        const nextStepBtn = document.getElementById('next-step-btn');
        const finishSelectionBtn = document.getElementById('finish-selection-btn');
        const branchStep = document.getElementById('branch-step');
        const semesterStep = document.getElementById('semester-step');
        const courseStep = document.getElementById('course-step');
        const branchOptions = document.getElementById('branch-options');
        const semesterOptions = document.getElementById('semester-options');
        const courseOptions = document.getElementById('course-options');
        const stepIndicators = document.querySelectorAll('.step');
        
        // Current selections for branch-semester-course modal
        let currentSelection = {
            form: null,
            branch: null,
            semester: null,
            course: null
        };
        
        // Show loading overlay
        function showLoading() {
            loadingOverlay.classList.add('active');
        }
        
        // Hide loading overlay
        function hideLoading() {
            loadingOverlay.classList.remove('active');
        }
        
        // Show logout animation
        function showLogoutAnimation() {
            logoutAnimation.classList.add('active');
        }
        
        // Initialize page
        function initializePage() {
            // Show loading
            showLoading();
            
            // Initialize branch dropdowns
            initializeBranchDropdowns();
            
            // User profile button functionality
            profileBtn.addEventListener('click', () => {
                if (currentUser) {
                    // Fetch current user's details
                    db.collection('users').doc(currentUser.uid).get()
                        .then(doc => {
                            if (doc.exists) {
                                const user = doc.data();
                                displayUserModal(user);
                            } else {
                                showToast('User data not found', 'error');
                            }
                        })
                        .catch(error => {
                            console.error('Error getting user data:', error);
                            showToast('Failed to load user profile', 'error');
                        });
                } else {
                    showToast('No user logged in', 'error');
                }
            });
            
            // Function to display user modal
            function displayUserModal(user) {
                let photo = user.photoURL;
                if (!photo) {
                    photo = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(user.name || 'User');
                }
                
                const html = `
                    <div style="display:flex; align-items:center; gap:18px; margin-bottom:18px; flex-wrap: wrap;">
                        <img src="${photo}" alt="User Photo" style="width:72px; height:72px; border-radius:50%; object-fit:cover; border:2px solid var(--primary-glow);">
                        <div>
                            <div class="content-title" style="font-size:1.3em;">${user.name || 'Unknown'}</div>
                            <div style="color: var(--text-secondary);">${user.email || 'No email'}</div>
                            <div style="margin-top: 5px;">
                                <span class="status-badge ${user.role === 'admin' ? 'status-active' : ''}">${user.role || 'student'}</span>
                            </div>
                        </div>
                    </div>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                        <div><b>Phone:</b> ${user.phone || '-'}</div>
                        <div><b>Date of Birth:</b> ${user.dob || '-'}</div>
                        <div><b>Gender:</b> ${user.gender || '-'}</div>
                        <div><b>Admission No:</b> ${user.admissionNo || '-'}</div>
                        <div><b>Branch:</b> ${user.branch || '-'}</div>
                        <div><b>Semester:</b> ${user.semester || '-'}</div>
                        <div><b>College:</b> ${user.college || '-'}</div>
                        <div><b>Credits:</b> ${user.credits || 0}</div>
                    </div>
                    ${user.bio ? `<div style="margin-top: 15px;"><b>Bio:</b> ${user.bio}</div>` : ''}
                    <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn-secondary" onclick="editUser('${currentUser.uid}')">
                            <i class="fas fa-edit"></i> Edit Profile
                        </button>
                        <button class="btn-info" onclick="resetUserPassword('${currentUser.uid}', '${user.email}')">
                            <i class="fas fa-key"></i> Reset Password
                        </button>
                    </div>
                `;
                
                document.getElementById('user-view-modal-body').innerHTML = html;
                userViewModal.classList.add('active');
            }
            
            // Make sure the closeUserViewModal function is defined
            function closeUserViewModal() {
                userViewModal.classList.remove('active');
            }
            
            // Logout functionality with confirmation and animation
            logoutBtn.addEventListener('click', () => {
                if (confirm('Are you sure you want to logout?')) {
                    showLogoutAnimation();
                    
                    // Wait for animation to complete
                    setTimeout(() => {
                        auth.signOut().then(() => {
                            window.location.replace('/index.html');
                        }).catch(error => {
                            console.error('Logout error:', error);
                            showToast("Logout failed. Please try again.", "error");
                            logoutAnimation.classList.remove('active');
                        });
                    }, 2000);
                }
            });
            
            // Admin navigation
            adminNavItems.forEach(item => {
                item.addEventListener('click', () => {
                    const panelId = item.getAttribute('data-panel');
                    
                    // Update active nav item
                    adminNavItems.forEach(navItem => navItem.classList.remove('active'));
                    item.classList.add('active');
                    
                    // Update active panel
                    adminPanels.forEach(panel => {
                        panel.classList.remove('active');
                        if (panel.id === `${panelId}-panel`) {
                            panel.classList.add('active');
                        }
                    });
                    
                    // Load panel-specific data
                    loadPanelData(panelId);
                });
            });
            
            // Modal close buttons
            document.querySelectorAll('.modal-close').forEach(btn => {
                btn.addEventListener('click', () => {
                    document.querySelectorAll('.modal-overlay').forEach(modal => {
                        modal.classList.remove('active');
                    });
                });
            });
            
            // Modal overlay clicks
            document.querySelectorAll('.modal-overlay').forEach(modal => {
                modal.addEventListener('click', (e) => {
                    if (e.target === modal) {
                        modal.classList.remove('active');
                    }
                });
            });
            
            // Form submissions
            noticeForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveNotice();
            });
            
            userForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveUser();
            });
            
            materialForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveMaterial();
            });
            
            pyqForm.addEventListener('submit', (e) => {
                e.preventDefault();
                savePYQ();
            });
            
            quizForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveQuiz();
            });
            
            seminarForm.addEventListener('submit', (e) => {
                e.preventDefault();
                saveSeminar();
            });
            
            // Add buttons
            document.getElementById('add-notice-btn').addEventListener('click', () => {
                document.getElementById('notice-modal-title').textContent = 'Add Notice';
                document.getElementById('notice-id').value = '';
                document.getElementById('notice-title').value = '';
                document.getElementById('notice-message').value = '';
                document.getElementById('notice-important').value = 'false';
                document.getElementById('notice-audience').value = 'all';
                noticeModal.classList.add('active');
            });
            
            document.getElementById('add-user-btn').addEventListener('click', () => {
                document.getElementById('user-modal-title').textContent = 'Add User';
                document.getElementById('user-id').value = '';
                document.getElementById('user-name').value = '';
                document.getElementById('user-email').value = '';
                document.getElementById('user-admission').value = '';
                document.getElementById('user-branch').value = '';
                document.getElementById('user-semester').value = '';
                document.getElementById('user-role').value = 'student';
                document.getElementById('user-credits').value = '100';
                userModal.classList.add('active');
            });
            
            document.getElementById('add-material-btn').addEventListener('click', () => {
                document.getElementById('material-modal-title').textContent = 'Add Material';
                document.getElementById('material-id').value = '';
                document.getElementById('material-title').value = '';
                document.getElementById('material-description').value = '';
                document.getElementById('material-subject').value = '';
                document.getElementById('material-link').value = '';
                document.getElementById('material-thumbnail').value = '';
                document.getElementById('thumbnail-preview').style.display = 'none';
                document.getElementById('material-branch').value = '';
                document.getElementById('material-semester').value = '';
                document.getElementById('material-selection-display').style.display = 'none';
                document.getElementById('material-branch').parentElement.style.display = 'block';
                document.getElementById('material-semester').parentElement.style.display = 'block';
                materialModal.classList.add('active');
            });
            
            document.getElementById('add-pyq-btn').addEventListener('click', () => {
                document.getElementById('pyq-modal-title').textContent = 'Add PYQ';
                document.getElementById('pyq-id').value = '';
                document.getElementById('pyq-title').value = '';
                document.getElementById('pyq-subject').value = '';
                document.getElementById('pyq-year').value = '';
                document.getElementById('pyq-link').value = '';
                document.getElementById('pyq-branch').value = '';
                document.getElementById('pyq-semester').value = '';
                document.getElementById('pyq-selection-display').style.display = 'none';
                document.getElementById('pyq-branch').parentElement.style.display = 'block';
                document.getElementById('pyq-semester').parentElement.style.display = 'block';
                pyqModal.classList.add('active');
            });
            
            document.getElementById('add-quiz-btn').addEventListener('click', () => {
                document.getElementById('quiz-modal-title').textContent = 'Add Quiz';
                document.getElementById('quiz-id').value = '';
                document.getElementById('quiz-title').value = '';
                document.getElementById('quiz-description').value = '';
                document.getElementById('quiz-subject').value = '';
                document.getElementById('quiz-time').value = '';
                document.getElementById('quiz-difficulty').value = 'medium';
                document.getElementById('quiz-branch').value = '';
                document.getElementById('quiz-semester').value = '';
                document.getElementById('quiz-selection-display').style.display = 'none';
                document.getElementById('quiz-branch').parentElement.style.display = 'block';
                document.getElementById('quiz-semester').parentElement.style.display = 'block';
                quizModal.classList.add('active');
            });
            
            document.getElementById('add-seminar-btn').addEventListener('click', () => {
                document.getElementById('seminar-modal-title').textContent = 'Add Seminar';
                document.getElementById('seminar-id').value = '';
                document.getElementById('seminar-title').value = '';
                document.getElementById('seminar-description').value = '';
                document.getElementById('seminar-speaker').value = '';
                document.getElementById('seminar-datetime').value = '';
                document.getElementById('seminar-link').value = '';
                document.getElementById('seminar-thumbnail').value = '';
                document.getElementById('seminar-thumbnail-preview').style.display = 'none';
                seminarModal.classList.add('active');
            });
            
            // Export payments button
            document.getElementById('export-payments-btn').addEventListener('click', exportPayments);
            
            // Refresh payments button
            document.getElementById('refresh-payments-btn').addEventListener('click', () => {
                showToast('Refreshing payment data...', 'info');
                loadPayments();
            });
            
            // Settings toggles
            document.getElementById('registration-toggle').addEventListener('click', function() {
                this.classList.toggle('active');
            });
            
            document.getElementById('email-toggle').addEventListener('click', function() {
                this.classList.toggle('active');
            });
            
            document.getElementById('maintenance-toggle').addEventListener('click', function() {
                this.classList.toggle('active');
            });
            
            document.getElementById('analytics-toggle').addEventListener('click', function() {
                this.classList.toggle('active');
            });
            
            // Save settings button
            document.getElementById('save-settings-btn').addEventListener('click', saveSettings);
            
            // Thumbnail preview
            document.getElementById('material-thumbnail').addEventListener('input', function() {
                const thumbnailPreview = document.getElementById('thumbnail-preview');
                if (this.value) {
                    thumbnailPreview.src = this.value;
                    thumbnailPreview.style.display = 'block';
                } else {
                    thumbnailPreview.style.display = 'none';
                }
            });
            
            document.getElementById('seminar-thumbnail').addEventListener('input', function() {
                const thumbnailPreview = document.getElementById('seminar-thumbnail-preview');
                if (this.value) {
                    thumbnailPreview.src = this.value;
                    thumbnailPreview.style.display = 'block';
                } else {
                    thumbnailPreview.style.display = 'none';
                }
            });
            
            // Search functionality
            if (noticeSearch) {
                noticeSearch.addEventListener('input', () => {
                    filterNotices();
                });
            }
            
            if (userSearch) {
                userSearch.addEventListener('input', () => {
                    filterUsers();
                });
            }
            
            if (userRoleFilter) {
                userRoleFilter.addEventListener('change', () => {
                    filterUsers();
                });
            }
            
            if (userStatusFilter) {
                userStatusFilter.addEventListener('change', () => {
                    filterUsers();
                });
            }
            
            if (materialSearch) {
                materialSearch.addEventListener('input', () => {
                    filterMaterials();
                });
            }
            
            if (materialBranchFilter) {
                materialBranchFilter.addEventListener('change', () => {
                    filterMaterials();
                });
            }
            
            if (materialSemesterFilter) {
                materialSemesterFilter.addEventListener('change', () => {
                    filterMaterials();
                });
            }
            
            if (pyqSearch) {
                pyqSearch.addEventListener('input', () => {
                    filterPYQs();
                });
            }
            
            if (pyqBranchFilter) {
                pyqBranchFilter.addEventListener('change', () => {
                    filterPYQs();
                });
            }
            
            if (pyqSemesterFilter) {
                pyqSemesterFilter.addEventListener('change', () => {
                    filterPYQs();
                });
            }
            
            if (quizSearch) {
                quizSearch.addEventListener('input', () => {
                    filterQuizzes();
                });
            }
            
            if (quizBranchFilter) {
                quizBranchFilter.addEventListener('change', () => {
                    filterQuizzes();
                });
            }
            
            if (quizSemesterFilter) {
                quizSemesterFilter.addEventListener('change', () => {
                    filterQuizzes();
                });
            }
            
            if (seminarSearch) {
                seminarSearch.addEventListener('input', () => {
                    filterSeminars();
                });
            }
            
            if (paymentSearch) {
                paymentSearch.addEventListener('input', () => {
                    filterPayments();
                });
            }
            
            if (paymentTypeFilter) {
                paymentTypeFilter.addEventListener('change', () => {
                    filterPayments();
                });
            }
            
            if (paymentDateFilter) {
                paymentDateFilter.addEventListener('change', () => {
                    filterPayments();
                });
            }
            
            // Toast close button
            document.querySelector('.toast-close').addEventListener('click', () => {
                toast.classList.remove('show');
            });
            
            // Branch-Semester-Course Selection Modal Event Listeners
            modalCloseBtn.addEventListener('click', () => {
                branchSemesterCourseModal.classList.remove('active');
            });
            
            nextStepBtn.addEventListener('click', goToNextStep);
            prevStepBtn.addEventListener('click', goToPrevStep);
            finishSelectionBtn.addEventListener('click', finishSelection);
            
            // Material form selection buttons
            document.getElementById('change-material-selection').addEventListener('click', () => {
                openBranchSemesterCourseModal('material');
            });
            
            // PYQ form selection buttons
            document.getElementById('change-pyq-selection').addEventListener('click', () => {
                openBranchSemesterCourseModal('pyq');
            });
            
            // Quiz form selection buttons
            document.getElementById('change-quiz-selection').addEventListener('click', () => {
                openBranchSemesterCourseModal('quiz');
            });
            
            // Initialize branch options
            initializeBranchOptions();
            
            // Hide loading
            setTimeout(() => {
                hideLoading();
            }, 1000);
        }
        
        // Load panel-specific data
        function loadPanelData(panelId) {
            switch(panelId) {
                case 'dashboard':
                    // Already loaded in initializePage
                    break;
                case 'notices':
                    loadNotices();
                    break;
                case 'users':
                    loadUsers();
                    break;
                case 'materials':
                    loadMaterials();
                    break;
                case 'pyqs':
                    loadPYQs();
                    break;
                case 'quizzes':
                    loadQuizzes();
                    break;
                case 'seminars':
                    loadSeminars();
                    break;
                case 'payments':
                    loadPayments();
                    break;
                case 'analytics':
                    loadAnalytics();
                    break;
                case 'settings':
                    loadSettings();
                    break;
            }
        }
        
        // Enhanced toast function with auto-hide
        function showToast(message, type = 'success') {
            toastMessage.textContent = message;
            toast.className = `toast ${type} show`;
            
            const icon = toast.querySelector('i');
            if (type === 'success') {
                icon.className = 'fas fa-check-circle';
            } else if (type === 'error') {
                icon.className = 'fas fa-exclamation-circle';
            } else if (type === 'info') {
                icon.className = 'fas fa-info-circle';
            }
            
            setTimeout(() => {
                toast.classList.remove('show');
            }, 4000);
        }
        
        // Format timestamp
        function formatTimestamp(timestamp) {
            if (!timestamp || !timestamp.toDate) return 'N/A';
            const date = timestamp.toDate();
            const now = new Date();
            const diffMs = now - date;
            const diffDays = Math.floor(diffMs / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) {
                return 'Today ' + date.toLocaleTimeString('en-US', { 
                    hour: 'numeric', minute: '2-digit', hour12: true 
                });
            } else if (diffDays === 1) {
                return 'Yesterday';
            } else if (diffDays < 7) {
                return `${diffDays} days ago`;
            } else {
                return date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' });
            }
        }
        
        // Load dashboard data
        function loadDashboardData() {
            // Load users count
            db.collection('users').onSnapshot(snapshot => {
                document.getElementById('total-users').textContent = snapshot.size;
            }, error => {
                console.error('Error loading users:', error);
                document.getElementById('total-users').textContent = 'Error';
            });
            
            // Load materials count
            db.collection('notes').onSnapshot(snapshot => {
                document.getElementById('total-materials').textContent = snapshot.size;
            }, error => {
                console.error('Error loading materials:', error);
                document.getElementById('total-materials').textContent = 'Error';
            });
            
            // Load PYQs count
            db.collection('pyqs').onSnapshot(snapshot => {
                document.getElementById('total-pyqs').textContent = snapshot.size;
            }, error => {
                console.error('Error loading PYQs:', error);
                document.getElementById('total-pyqs').textContent = 'Error';
            });
            
            // Load seminars count
            db.collection('seminars').onSnapshot(snapshot => {
                document.getElementById('total-seminars').textContent = snapshot.size;
            }, error => {
                console.error('Error loading seminars:', error);
                document.getElementById('total-seminars').textContent = 'Error';
            });
            
            // Load quizzes count
            db.collection('quizzes').onSnapshot(snapshot => {
                document.getElementById('total-quizzes').textContent = snapshot.size;
            }, error => {
                console.error('Error loading quizzes:', error);
                document.getElementById('total-quizzes').textContent = 'Error';
            });
            
            // Load payments count
            db.collection('transactions').onSnapshot(snapshot => {
                document.getElementById('total-payments').textContent = snapshot.size;
            }, error => {
                console.error('Error loading payments:', error);
                document.getElementById('total-payments').textContent = 'Error';
            });
            
            // Load user growth chart
            loadUserGrowthChart();
            
            // Load activity chart
            loadActivityChart();
        }
        
        // Load user growth chart with real data
        function loadUserGrowthChart() {
            const ctx = document.getElementById('user-growth-chart').getContext('2d');
            
            // Get the last 7 days
            const labels = [];
            const data = [];
            const today = new Date();
            
            // Initialize an object to hold counts for each day
            const counts = {};
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateString = date.toISOString().split('T')[0];
                labels.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
                counts[dateString] = 0;
            }
            
            // Query users created in the last 7 days
            const sevenDaysAgo = new Date(today);
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            
            db.collection('users')
                .where('createdAt', '>=', sevenDaysAgo)
                .get()
                .then(snapshot => {
                    snapshot.forEach(doc => {
                        const user = doc.data();
                        if (user.createdAt && user.createdAt.toDate) {
                            const date = user.createdAt.toDate();
                            const dateString = date.toISOString().split('T')[0];
                            if (counts.hasOwnProperty(dateString)) {
                                counts[dateString]++;
                            }
                        }
                    });
                    
                    // Convert counts object to array in the order of labels
                    labels.forEach(label => {
                        const date = new Date(label);
                        const dateString = date.toISOString().split('T')[0];
                        data.push(counts[dateString] || 0);
                    });
                    
                    // Create or update the chart
                    if (userGrowthChart) {
                        userGrowthChart.destroy();
                    }
                    
                    userGrowthChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'New Users',
                                data: data,
                                backgroundColor: 'rgba(255, 215, 0, 0.2)',
                                borderColor: 'rgba(255, 215, 0, 1)',
                                borderWidth: 2,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'User Growth (Last 7 Days)',
                                    color: '#F0F0F0',
                                    font: {
                                        size: 16
                                    }
                                },
                                legend: {
                                    labels: {
                                        color: '#F0F0F0'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#A0A0A0',
                                        stepSize: 1
                                    }
                                },
                                x: {
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#A0A0A0'
                                    }
                                }
                            }
                        }
                    });
                })
                .catch(error => {
                    console.error('Error loading user growth data:', error);
                });
        }
        
        // Load activity chart with real data
        function loadActivityChart() {
            const ctx = document.getElementById('activity-chart').getContext('2d');
            
            // We'll get the counts for each collection
            const collections = ['notes', 'pyqs', 'seminars', 'quizzes'];
            const labels = ['Materials', 'PYQs', 'Seminars', 'Quizzes'];
            const data = [];
            let completed = 0;
            
            collections.forEach((collection, index) => {
                db.collection(collection).get().then(snapshot => {
                    data[index] = snapshot.size;
                    completed++;
                    
                    if (completed === collections.length) {
                        // Add "Other" as 0 for now
                        labels.push('Other');
                        data.push(0);
                        
                        if (activityChart) {
                            activityChart.destroy();
                        }
                        
                        activityChart = new Chart(ctx, {
                            type: 'doughnut',
                            data: {
                                labels: labels,
                                datasets: [{
                                    data: data,
                                    backgroundColor: [
                                        'rgba(255, 215, 0, 0.7)',
                                        'rgba(0, 162, 255, 0.7)',
                                        'rgba(255, 107, 107, 0.7)',
                                        'rgba(155, 89, 182, 0.7)',
                                        'rgba(46, 204, 113, 0.7)'
                                    ],
                                    borderColor: [
                                        'rgba(255, 215, 0, 1)',
                                        'rgba(0, 162, 255, 1)',
                                        'rgba(255, 107, 107, 1)',
                                        'rgba(155, 89, 182, 1)',
                                        'rgba(46, 204, 113, 1)'
                                    ],
                                    borderWidth: 1
                                }]
                            },
                            options: {
                                responsive: true,
                                maintainAspectRatio: false,
                                plugins: {
                                    title: {
                                        display: true,
                                        text: 'Platform Activity Distribution',
                                        color: '#F0F0F0',
                                        font: {
                                            size: 16
                                        }
                                    },
                                    legend: {
                                        position: 'right',
                                        labels: {
                                            color: '#F0F0F0'
                                        }
                                    }
                                }
                            }
                        });
                    }
                }).catch(error => {
                    console.error(`Error loading ${collection} count:`, error);
                    data[index] = 0;
                    completed++;
                    
                    if (completed === collections.length) {
                        // ... (same as above to create chart)
                    }
                });
            });
        }
        
        // Load notices with real-time updates
        function loadNotices() {
            const noticesList = document.getElementById('notices-list');
            let notices = [];
            
            db.collection('notices')
                .orderBy('createdAt', 'desc')
                .onSnapshot(snapshot => {
                    notices = [];
                    
                    snapshot.forEach(doc => {
                        const notice = doc.data();
                        notice.id = doc.id;
                        notices.push(notice);
                    });
                    
                    renderNotices(notices);
                }, error => {
                    console.error('Error loading notices:', error);
                    noticesList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon"><i class="fas fa-exclamation-circle"></i></div>
                            <p>Failed to load notices</p>
                        </div>
                    `;
                });
        }
        
        // Render notices with search/filter
        function renderNotices(notices) {
            const noticesList = document.getElementById('notices-list');
            
            if (notices.length === 0) {
                noticesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon"><i class="fas fa-bullhorn"></i></div>
                        <p>No notices found</p>
                    </div>
                `;
                return;
            }
            
            const noticesHtml = notices.map(notice => {
                const isImportant = notice.important === 'true' || notice.important === true;
                
                return `
                    <div class="content-card">
                        <div class="content-header">
                            <div>
                                <div class="content-title">${notice.title || 'Untitled Notice'}</div>
                                <div style="color: var(--text-secondary); margin-bottom: 15px;">${notice.message || ''}</div>
                                <div class="content-meta">
                                    <span><i class="fas fa-clock"></i> ${formatTimestamp(notice.createdAt)}</span>
                                    <span><i class="fas fa-users"></i> ${notice.audience || 'all'}</span>
                                    ${isImportant ? '<span style="color: var(--danger);"><i class="fas fa-exclamation-circle"></i> Important</span>' : ''}
                                </div>
                            </div>
                            <div class="content-actions">
                                <button class="btn-secondary" style="padding: 8px 12px; font-size: 0.9rem;" onclick="editNotice('${notice.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-danger" style="padding: 8px 12px; font-size: 0.9rem;" onclick="deleteNotice('${notice.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            noticesList.innerHTML = noticesHtml;
        }
        
        // Filter notices based on search
        function filterNotices() {
            const searchTerm = noticeSearch.value.toLowerCase();
            
            db.collection('notices')
                .orderBy('createdAt', 'desc')
                .get()
                .then(snapshot => {
                    const notices = [];
                    
                    snapshot.forEach(doc => {
                        const notice = doc.data();
                        notice.id = doc.id;
                        
                        if (searchTerm === '' || 
                            (notice.title && notice.title.toLowerCase().includes(searchTerm)) ||
                            (notice.message && notice.message.toLowerCase().includes(searchTerm))) {
                            notices.push(notice);
                        }
                    });
                    
                    renderNotices(notices);
                })
                .catch(error => {
                    console.error('Error filtering notices:', error);
                });
        }
        
        // Save notice
        function saveNotice() {
            const noticeId = document.getElementById('notice-id').value;
            const noticeData = {
                title: document.getElementById('notice-title').value,
                message: document.getElementById('notice-message').value,
                important: document.getElementById('notice-important').value === 'true',
                audience: document.getElementById('notice-audience').value,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            if (noticeId) {
                // Update existing notice
                db.collection('notices').doc(noticeId).update(noticeData)
                    .then(() => {
                        showToast('Notice updated successfully', 'success');
                        noticeModal.classList.remove('active');
                    })
                    .catch(error => {
                        console.error('Error updating notice:', error);
                        showToast('Failed to update notice', 'error');
                    });
            } else {
                // Add new notice
                db.collection('notices').add(noticeData)
                    .then(() => {
                        showToast('Notice added successfully', 'success');
                        noticeModal.classList.remove('active');
                    })
                    .catch(error => {
                        console.error('Error adding notice:', error);
                        showToast('Failed to add notice', 'error');
                    });
            }
        }
        
        // Edit notice
        function editNotice(noticeId) {
            db.collection('notices').doc(noticeId).get()
                .then(doc => {
                    if (doc.exists) {
                        const notice = doc.data();
                        document.getElementById('notice-modal-title').textContent = 'Edit Notice';
                        document.getElementById('notice-id').value = noticeId;
                        document.getElementById('notice-title').value = notice.title || '';
                        document.getElementById('notice-message').value = notice.message || '';
                        document.getElementById('notice-important').value = notice.important ? 'true' : 'false';
                        document.getElementById('notice-audience').value = notice.audience || 'all';
                        noticeModal.classList.add('active');
                    }
                })
                .catch(error => {
                    console.error('Error getting notice:', error);
                    showToast('Failed to load notice', 'error');
                });
        }
        
        // Delete notice
        function deleteNotice(noticeId) {
            if (confirm('Are you sure you want to delete this notice?')) {
                db.collection('notices').doc(noticeId).delete()
                    .then(() => {
                        showToast('Notice deleted successfully', 'success');
                    })
                    .catch(error => {
                        console.error('Error deleting notice:', error);
                        showToast('Failed to delete notice', 'error');
                    });
            }
        }
        
        // Load users with real-time updates
        function loadUsers() {
            const usersList = document.getElementById('users-list');
            let users = [];
            
            db.collection('users')
                .orderBy('createdAt', 'desc')
                .onSnapshot(snapshot => {
                    users = [];
                    
                    snapshot.forEach(doc => {
                        const user = doc.data();
                        user.id = doc.id;
                        users.push(user);
                    });
                    
                    renderUsers(users);
                }, error => {
                    console.error('Error loading users:', error);
                    usersList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon"><i class="fas fa-exclamation-circle"></i></div>
                            <p>Failed to load users</p>
                        </div>
                    `;
                });
        }
        
        // Render users with search/filter
        function renderUsers(users) {
            const usersList = document.getElementById('users-list');
            
            if (users.length === 0) {
                usersList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon"><i class="fas fa-users"></i></div>
                        <p>No users found</p>
                    </div>
                `;
                return;
            }
            
            const usersHtml = users.map(user => {
                // Try to use Gmail photo if available, fallback to avatar
                let photo = user.photoURL;
                if (!photo && user.email) {
                    // Try to get Google profile photo from Firebase Auth if available
                    const authUser = firebase.auth().currentUser;
                    if (authUser && authUser.email === user.email && authUser.photoURL) {
                        photo = authUser.photoURL;
                    }
                }
                if (!photo) {
                    photo = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(user.name || 'User');
                }
                return `
                    <div class="content-card">
                        <div class="content-header">
                            <div style="display: flex; align-items: center; gap: 18px;">
                                <img src="${photo}" alt="User Photo" style="width:56px;height:56px;border-radius:50%;object-fit:cover;border:2px solid var(--primary-glow);">
                                <div>
                                    <div class="content-title">${user.name || 'Unknown'}</div>
                                    <div style="color: var(--text-secondary); margin-bottom: 5px;">${user.email || 'No email'}</div>
                                </div>
                            </div>
                            <div class="content-actions">
                                <button class="btn-info" style="padding: 8px 12px; font-size: 0.9rem;" data-userid="${user.id}" onclick="viewUserDetails('${user.id}')">
                                    <i class="fas fa-eye"></i>
                                </button>
                                <button class="btn-secondary" style="padding: 8px 12px; font-size: 0.9rem;" onclick="editUser('${user.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-danger" style="padding: 8px 12px; font-size: 0.9rem;" onclick="deleteUser('${user.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            usersList.innerHTML = usersHtml;
        }
        
        // View user details in modal (view-only mode)
        function viewUserDetails(userId) {
            db.collection('users').doc(userId).get()
                .then(doc => {
                    if (doc.exists) {
                        const user = doc.data();
                        let photo = user.photoURL;
                        if (!photo) {
                            photo = 'https://ui-avatars.com/api/?name=' + encodeURIComponent(user.name || 'User');
                        }
                        const html = `
                          <div style="display:flex;align-items:center;gap:18px;margin-bottom:18px;">
                            <img src="${photo}" alt="User Photo" style="width:72px;height:72px;border-radius:50%;object-fit:cover;border:2px solid var(--primary-glow);">
                            <div>
                              <div class="content-title" style="font-size:1.3em;">${user.name || 'Unknown'}</div>
                              <div style="color: var(--text-secondary);">${user.email || 'No email'}</div>
                            </div>
                          </div>
                          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                            <div><b>Phone:</b> ${user.phone || '-'}</div>
                            <div><b>Date of Birth:</b> ${user.dob || '-'}</div>
                            <div><b>Gender:</b> ${user.gender || '-'}</div>
                            <div><b>Admission No:</b> ${user.admissionNo || '-'}</div>
                            <div><b>Branch:</b> ${user.branch || '-'}</div>
                            <div><b>Semester:</b> ${user.semester || '-'}</div>
                            <div><b>College:</b> ${user.college || '-'}</div>
                            <div><b>Role:</b> ${user.role || 'student'}</div>
                            <div><b>Bio:</b> ${user.bio || '-'}</div>
                            <div><b>Credits:</b> ${user.credits || 0}</div>
                          </div>
                        `;
                        document.getElementById('user-view-modal-body').innerHTML = html;
                        const modal = document.getElementById('user-view-modal');
                        modal.classList.add('active');
                    }
                })
                .catch(error => {
                    console.error('Error getting user:', error);
                    showToast('Failed to load user', 'error');
                });
        }
        
        function closeUserViewModal() {
            const modal = document.getElementById('user-view-modal');
            modal.classList.remove('active');
        }
        
        // Filter users based on search and filters
        function filterUsers() {
            const searchTerm = userSearch.value.toLowerCase();
            const roleFilter = userRoleFilter.value;
            const statusFilter = userStatusFilter.value;
            
            db.collection('users')
                .orderBy('createdAt', 'desc')
                .get()
                .then(snapshot => {
                    const users = [];
                    
                    snapshot.forEach(doc => {
                        const user = doc.data();
                        user.id = doc.id;
                        
                        // Check if user matches search term
                        const matchesSearch = searchTerm === '' || 
                            (user.name && user.name.toLowerCase().includes(searchTerm)) ||
                            (user.email && user.email.toLowerCase().includes(searchTerm)) ||
                            (user.admissionNo && user.admissionNo.toLowerCase().includes(searchTerm));
                        
                        // Check if user matches role filter
                        const matchesRole = roleFilter === '' || user.role === roleFilter;
                        
                        // Check if user matches status filter
                        let matchesStatus = true;
                        if (statusFilter !== '') {
                            const isActive = user.lastActive && 
                                (new Date().getTime() - user.lastActive.toDate().getTime()) < 7 * 24 * 60 * 60 * 1000;
                            matchesStatus = (statusFilter === 'active' && isActive) || 
                                          (statusFilter === 'inactive' && !isActive);
                        }
                        
                        if (matchesSearch && matchesRole && matchesStatus) {
                            users.push(user);
                        }
                    });
                    
                    renderUsers(users);
                })
                .catch(error => {
                    console.error('Error filtering users:', error);
                });
        }
        
        // Save user
        function saveUser() {
            const userId = document.getElementById('user-id').value;
            const userData = {
                name: document.getElementById('user-name').value,
                email: document.getElementById('user-email').value,
                phone: document.getElementById('user-phone').value,
                dob: document.getElementById('user-dob').value,
                gender: document.getElementById('user-gender').value,
                admissionNo: document.getElementById('user-admission').value,
                branch: document.getElementById('user-branch').value,
                semester: document.getElementById('user-semester').value,
                college: document.getElementById('user-college').value,
                role: document.getElementById('user-role').value,
                bio: document.getElementById('user-bio').value,
                photoURL: document.getElementById('user-photoURL').value,
                credits: parseInt(document.getElementById('user-credits').value) || 0,
                createdAt: userId ? firebase.firestore.FieldValue.serverTimestamp() : firebase.firestore.FieldValue.serverTimestamp()
            };
            if (userId) {
                db.collection('users').doc(userId).update(userData)
                    .then(() => {
                        showToast('User updated successfully', 'success');
                        userModal.classList.remove('active');
                    })
                    .catch(error => {
                        console.error('Error updating user:', error);
                        showToast('Failed to update user', 'error');
                    });
            } else {
                db.collection('users').add(userData)
                    .then(() => {
                        showToast('User added successfully', 'success');
                        userModal.classList.remove('active');
                    })
                    .catch(error => {
                        console.error('Error adding user:', error);
                        showToast('Failed to add user', 'error');
                    });
            }
        }
        
        // Edit user
        function editUser(userId) {
            db.collection('users').doc(userId).get()
                .then(doc => {
                    if (doc.exists) {
                        const user = doc.data();
                        document.getElementById('user-modal-title').textContent = 'Edit User';
                        document.getElementById('user-id').value = userId;
                        document.getElementById('user-name').value = user.name || '';
                        document.getElementById('user-email').value = user.email || '';
                        document.getElementById('user-phone').value = user.phone || '';
                        document.getElementById('user-dob').value = user.dob || '';
                        document.getElementById('user-gender').value = user.gender || '';
                        document.getElementById('user-admission').value = user.admissionNo || '';
                        document.getElementById('user-branch').value = user.branch || '';
                        document.getElementById('user-semester').value = user.semester || '';
                        document.getElementById('user-college').value = user.college || '';
                        document.getElementById('user-role').value = user.role || 'student';
                        document.getElementById('user-bio').value = user.bio || '';
                        document.getElementById('user-photoURL').value = user.photoURL || '';
                        document.getElementById('user-credits').value = user.credits || 0;
                        userModal.classList.add('active');
                    }
                })
                .catch(error => {
                    console.error('Error getting user:', error);
                    showToast('Failed to load user', 'error');
                });
        }
        
        // Delete user
        function deleteUser(userId) {
            if (confirm('Are you sure you want to delete this user?')) {
                db.collection('users').doc(userId).delete()
                    .then(() => {
                        showToast('User deleted successfully', 'success');
                    })
                    .catch(error => {
                        console.error('Error deleting user:', error);
                        showToast('Failed to delete user', 'error');
                    });
            }
        }
        
        // Reset user password
        function resetUserPassword(userId, email) {
            if (confirm(`Send password reset email to ${email}?`)) {
                auth.sendPasswordResetEmail(email)
                    .then(() => {
                        showToast('Password reset email sent', 'success');
                    })
                    .catch(error => {
                        console.error('Error sending password reset email:', error);
                        showToast('Failed to send password reset email', 'error');
                    });
            }
        }
        
        // Load materials with real-time updates
        function loadMaterials() {
            const materialsList = document.getElementById('materials-list');
            let materials = [];
            
            db.collection('notes')
                .orderBy('createdAt', 'desc')
                .onSnapshot(snapshot => {
                    materials = [];
                    
                    snapshot.forEach(doc => {
                        const material = doc.data();
                        material.id = doc.id;
                        materials.push(material);
                    });
                    
                    renderMaterials(materials);
                }, error => {
                    console.error('Error loading materials:', error);
                    materialsList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon"><i class="fas fa-exclamation-circle"></i></div>
                            <p>Failed to load materials</p>
                        </div>
                    `;
                });
        }
        
        // Render materials with search/filter
        function renderMaterials(materials) {
            const materialsList = document.getElementById('materials-list');
            
            if (materials.length === 0) {
                materialsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon"><i class="fas fa-book"></i></div>
                        <p>No materials found</p>
                    </div>
                `;
                return;
            }
            
            const materialsHtml = materials.map(material => {
                return `
                    <div class="content-card">
                        <div class="content-header">
                            <div>
                                <div class="content-title">${material.title || 'Untitled Material'}</div>
                                <div style="color: var(--text-secondary); margin-bottom: 5px;">${material.description || material.subject || ''}</div>
                                <div class="content-meta">
                                    ${material.subject ? `<span><i class="fas fa-book"></i> ${material.subject}</span>` : ''}
                                    ${material.branch ? `<span><i class="fas fa-graduation-cap"></i> ${material.branch}</span>` : ''}
                                    ${material.semester ? `<span><i class="fas fa-calendar-alt"></i> Sem ${material.semester}</span>` : ''}
                                    <span><i class="fas fa-clock"></i> ${formatTimestamp(material.createdAt)}</span>
                                </div>
                            </div>
                            <div class="content-actions">
                                <a href="${material.link}" target="_blank" class="btn-info" style="padding: 8px 12px; font-size: 0.9rem; text-decoration: none;">
                                    <i class="fas fa-external-link-alt"></i> View
                                </a>
                                <button class="btn-secondary" style="padding: 8px 12px; font-size: 0.9rem;" onclick="editMaterial('${material.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-danger" style="padding: 8px 12px; font-size: 0.9rem;" onclick="deleteMaterial('${material.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            materialsList.innerHTML = materialsHtml;
        }
        
        // Filter materials based on search and filters
        function filterMaterials() {
            const searchTerm = materialSearch.value.toLowerCase();
            const branchFilter = materialBranchFilter.value;
            const semesterFilter = materialSemesterFilter.value;
            
            db.collection('notes')
                .orderBy('createdAt', 'desc')
                .get()
                .then(snapshot => {
                    const materials = [];
                    
                    snapshot.forEach(doc => {
                        const material = doc.data();
                        material.id = doc.id;
                        
                        // Check if material matches search term
                        const matchesSearch = searchTerm === '' || 
                            (material.title && material.title.toLowerCase().includes(searchTerm)) ||
                            (material.description && material.description.toLowerCase().includes(searchTerm)) ||
                            (material.subject && material.subject.toLowerCase().includes(searchTerm));
                        
                        // Check if material matches branch filter
                        const matchesBranch = branchFilter === '' || material.branch === branchFilter;
                        
                        // Check if material matches semester filter
                        const matchesSemester = semesterFilter === '' || material.semester === semesterFilter;
                        
                        if (matchesSearch && matchesBranch && matchesSemester) {
                            materials.push(material);
                        }
                    });
                    
                    renderMaterials(materials);
                })
                .catch(error => {
                    console.error('Error filtering materials:', error);
                });
        }
        
        // Save material
        function saveMaterial() {
            const materialId = document.getElementById('material-id').value;
            const materialData = {
                title: document.getElementById('material-title').value,
                description: document.getElementById('material-description').value,
                subject: document.getElementById('material-subject').value,
                link: document.getElementById('material-link').value,
                thumbnail: document.getElementById('material-thumbnail').value,
                branch: document.getElementById('material-branch').value,
                semester: document.getElementById('material-semester').value,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            // Validate required fields
            if (!materialData.title || !materialData.subject || !materialData.link) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // Validate Google Drive link
            if (!isValidGoogleDriveLink(materialData.link)) {
                showToast('Please enter a valid Google Drive link', 'error');
                return;
            }
            
            if (materialId) {
                // Update existing material
                db.collection('notes').doc(materialId).update(materialData)
                    .then(() => {
                        showToast('Material updated successfully', 'success');
                        materialModal.classList.remove('active');
                    })
                    .catch(error => {
                        console.error('Error updating material:', error);
                        showToast('Failed to update material: ' + error.message, 'error');
                    });
            } else {
                // Add new material
                db.collection('notes').add(materialData)
                    .then(() => {
                        showToast('Material added successfully', 'success');
                        materialModal.classList.remove('active');
                    })
                    .catch(error => {
                        console.error('Error adding material:', error);
                        showToast('Failed to add material: ' + error.message, 'error');
                    });
            }
        }
        
        // Edit material
        function editMaterial(materialId) {
            db.collection('notes').doc(materialId).get()
                .then(doc => {
                    if (doc.exists) {
                        const material = doc.data();
                        document.getElementById('material-modal-title').textContent = 'Edit Material';
                        document.getElementById('material-id').value = materialId;
                        document.getElementById('material-title').value = material.title || '';
                        document.getElementById('material-description').value = material.description || '';
                        document.getElementById('material-subject').value = material.subject || '';
                        document.getElementById('material-link').value = material.link || '';
                        document.getElementById('material-thumbnail').value = material.thumbnail || '';
                        
                        // Show thumbnail preview if exists
                        const thumbnailPreview = document.getElementById('thumbnail-preview');
                        if (material.thumbnail) {
                            thumbnailPreview.src = material.thumbnail;
                            thumbnailPreview.style.display = 'block';
                        } else {
                            thumbnailPreview.style.display = 'none';
                        }
                        
                        // Set branch and semester
                        document.getElementById('material-branch').value = material.branch || '';
                        document.getElementById('material-semester').value = material.semester || '';
                        
                        // Update selection display
                        if (material.branch && material.semester) {
                            document.getElementById('material-selected-branch').textContent = branches[material.branch]?.name || material.branch;
                            document.getElementById('material-selected-semester').textContent = `Semester ${material.semester}`;
                            document.getElementById('material-selected-course').textContent = material.subject || '-';
                            document.getElementById('material-selection-display').style.display = 'block';
                            
                            // Hide original dropdowns
                            document.getElementById('material-branch').parentElement.style.display = 'none';
                            document.getElementById('material-semester').parentElement.style.display = 'none';
                        } else {
                            document.getElementById('material-selection-display').style.display = 'none';
                            document.getElementById('material-branch').parentElement.style.display = 'block';
                            document.getElementById('material-semester').parentElement.style.display = 'block';
                        }
                        
                        materialModal.classList.add('active');
                    }
                })
                .catch(error => {
                    console.error('Error getting material:', error);
                    showToast('Failed to load material', 'error');
                });
        }
        
        // Delete material
        function deleteMaterial(materialId) {
            if (confirm('Are you sure you want to delete this material?')) {
                db.collection('notes').doc(materialId).delete()
                    .then(() => {
                        showToast('Material deleted successfully', 'success');
                    })
                    .catch(error => {
                        console.error('Error deleting material:', error);
                        showToast('Failed to delete material', 'error');
                    });
            }
        }
        
        // Load PYQs with real-time updates
        function loadPYQs() {
            const pyqsList = document.getElementById('pyqs-list');
            let pyqs = [];
            
            db.collection('pyqs')
                .orderBy('createdAt', 'desc')
                .onSnapshot(snapshot => {
                    pyqs = [];
                    
                    snapshot.forEach(doc => {
                        const pyq = doc.data();
                        pyq.id = doc.id;
                        pyqs.push(pyq);
                    });
                    
                    renderPYQs(pyqs);
                }, error => {
                    console.error('Error loading PYQs:', error);
                    pyqsList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon"><i class="fas fa-exclamation-circle"></i></div>
                            <p>Failed to load PYQs</p>
                        </div>
                    `;
                });
        }
        
        // Render PYQs with search/filter
        function renderPYQs(pyqs) {
            const pyqsList = document.getElementById('pyqs-list');
            
            if (pyqs.length === 0) {
                pyqsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon"><i class="fas fa-file-alt"></i></div>
                        <p>No PYQs found</p>
                    </div>
                `;
                return;
            }
            
            const pyqsHtml = pyqs.map(pyq => {
                return `
                    <div class="content-card">
                        <div class="content-header">
                            <div>
                                <div class="content-title">${pyq.title || 'Untitled PYQ'}</div>
                                <div style="color: var(--text-secondary); margin-bottom: 5px;">${pyq.subject || ''} ${pyq.year ? `(${pyq.year})` : ''}</div>
                                <div class="content-meta">
                                    ${pyq.subject ? `<span><i class="fas fa-book"></i> ${pyq.subject}</span>` : ''}
                                    ${pyq.year ? `<span><i class="fas fa-calendar"></i> ${pyq.year}</span>` : ''}
                                    ${pyq.branch ? `<span><i class="fas fa-graduation-cap"></i> ${pyq.branch}</span>` : ''}
                                    ${pyq.semester ? `<span><i class="fas fa-calendar-alt"></i> Sem ${pyq.semester}</span>` : ''}
                                    <span><i class="fas fa-clock"></i> ${formatTimestamp(pyq.createdAt)}</span>
                                </div>
                            </div>
                            <div class="content-actions">
                                <a href="${pyq.link}" target="_blank" class="btn-info" style="padding: 8px 12px; font-size: 0.9rem; text-decoration: none;">
                                    <i class="fas fa-external-link-alt"></i> View
                                </a>
                                <button class="btn-secondary" style="padding: 8px 12px; font-size: 0.9rem;" onclick="editPYQ('${pyq.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-danger" style="padding: 8px 12px; font-size: 0.9rem;" onclick="deletePYQ('${pyq.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            pyqsList.innerHTML = pyqsHtml;
        }
        
        // Filter PYQs based on search and filters
        function filterPYQs() {
            const searchTerm = pyqSearch.value.toLowerCase();
            const branchFilter = pyqBranchFilter.value;
            const semesterFilter = pyqSemesterFilter.value;
            
            db.collection('pyqs')
                .orderBy('createdAt', 'desc')
                .get()
                .then(snapshot => {
                    const pyqs = [];
                    
                    snapshot.forEach(doc => {
                        const pyq = doc.data();
                        pyq.id = doc.id;
                        
                        // Check if PYQ matches search term
                        const matchesSearch = searchTerm === '' || 
                            (pyq.title && pyq.title.toLowerCase().includes(searchTerm)) ||
                            (pyq.subject && pyq.subject.toLowerCase().includes(searchTerm)) ||
                            (pyq.year && pyq.year.toLowerCase().includes(searchTerm));
                        
                        // Check if PYQ matches branch filter
                        const matchesBranch = branchFilter === '' || pyq.branch === branchFilter;
                        
                        // Check if PYQ matches semester filter
                        const matchesSemester = semesterFilter === '' || pyq.semester === semesterFilter;
                        
                        if (matchesSearch && matchesBranch && matchesSemester) {
                            pyqs.push(pyq);
                        }
                    });
                    
                    renderPYQs(pyqs);
                })
                .catch(error => {
                    console.error('Error filtering PYQs:', error);
                });
        }
        
        // Save PYQ
        function savePYQ() {
            const pyqId = document.getElementById('pyq-id').value;
            const pyqData = {
                title: document.getElementById('pyq-title').value,
                subject: document.getElementById('pyq-subject').value,
                year: document.getElementById('pyq-year').value,
                link: document.getElementById('pyq-link').value,
                branch: document.getElementById('pyq-branch').value,
                semester: document.getElementById('pyq-semester').value,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            // Validate required fields
            if (!pyqData.title || !pyqData.subject || !pyqData.year || !pyqData.link) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // Validate Google Drive link
            if (!isValidGoogleDriveLink(pyqData.link)) {
                showToast('Please enter a valid Google Drive link', 'error');
                return;
            }
            
            if (pyqId) {
                // Update existing PYQ
                db.collection('pyqs').doc(pyqId).update(pyqData)
                    .then(() => {
                        showToast('PYQ updated successfully', 'success');
                        pyqModal.classList.remove('active');
                    })
                    .catch(error => {
                        console.error('Error updating PYQ:', error);
                        showToast('Failed to update PYQ: ' + error.message, 'error');
                    });
            } else {
                // Add new PYQ
                db.collection('pyqs').add(pyqData)
                    .then(() => {
                        showToast('PYQ added successfully', 'success');
                        pyqModal.classList.remove('active');
                    })
                    .catch(error => {
                        console.error('Error adding PYQ:', error);
                        showToast('Failed to add PYQ: ' + error.message, 'error');
                    });
            }
        }
        
        // Edit PYQ
        function editPYQ(pyqId) {
            db.collection('pyqs').doc(pyqId).get()
                .then(doc => {
                    if (doc.exists) {
                        const pyq = doc.data();
                        document.getElementById('pyq-modal-title').textContent = 'Edit PYQ';
                        document.getElementById('pyq-id').value = pyqId;
                        document.getElementById('pyq-title').value = pyq.title || '';
                        document.getElementById('pyq-subject').value = pyq.subject || '';
                        document.getElementById('pyq-year').value = pyq.year || '';
                        document.getElementById('pyq-link').value = pyq.link || '';
                        
                        // Set branch and semester
                        document.getElementById('pyq-branch').value = pyq.branch || '';
                        document.getElementById('pyq-semester').value = pyq.semester || '';
                        
                        // Update selection display
                        if (pyq.branch && pyq.semester) {
                            document.getElementById('pyq-selected-branch').textContent = branches[pyq.branch]?.name || pyq.branch;
                            document.getElementById('pyq-selected-semester').textContent = `Semester ${pyq.semester}`;
                            document.getElementById('pyq-selected-course').textContent = pyq.subject || '-';
                            document.getElementById('pyq-selection-display').style.display = 'block';
                            
                            // Hide original dropdowns
                            document.getElementById('pyq-branch').parentElement.style.display = 'none';
                            document.getElementById('pyq-semester').parentElement.style.display = 'none';
                        } else {
                            document.getElementById('pyq-selection-display').style.display = 'none';
                            document.getElementById('pyq-branch').parentElement.style.display = 'block';
                            document.getElementById('pyq-semester').parentElement.style.display = 'block';
                        }
                        
                        pyqModal.classList.add('active');
                    }
                })
                .catch(error => {
                    console.error('Error getting PYQ:', error);
                    showToast('Failed to load PYQ', 'error');
                });
        }
        
        // Delete PYQ
        function deletePYQ(pyqId) {
            if (confirm('Are you sure you want to delete this PYQ?')) {
                db.collection('pyqs').doc(pyqId).delete()
                    .then(() => {
                        showToast('PYQ deleted successfully', 'success');
                    })
                    .catch(error => {
                        console.error('Error deleting PYQ:', error);
                        showToast('Failed to delete PYQ', 'error');
                    });
            }
        }
        
        // Load quizzes with real-time updates
        function loadQuizzes() {
            const quizzesList = document.getElementById('quizzes-list');
            let quizzes = [];
            
            db.collection('quizzes')
                .orderBy('createdAt', 'desc')
                .onSnapshot(snapshot => {
                    quizzes = [];
                    
                    snapshot.forEach(doc => {
                        const quiz = doc.data();
                        quiz.id = doc.id;
                        quizzes.push(quiz);
                    });
                    
                    renderQuizzes(quizzes);
                }, error => {
                    console.error('Error loading quizzes:', error);
                    quizzesList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon"><i class="fas fa-exclamation-circle"></i></div>
                            <p>Failed to load quizzes</p>
                        </div>
                    `;
                });
        }
        
        // Render quizzes with search/filter
        function renderQuizzes(quizzes) {
            const quizzesList = document.getElementById('quizzes-list');
            
            if (quizzes.length === 0) {
                quizzesList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon"><i class="fas fa-question-circle"></i></div>
                        <p>No quizzes found</p>
                    </div>
                `;
                return;
            }
            
            const quizzesHtml = quizzes.map(quiz => {
                return `
                    <div class="content-card">
                        <div class="content-header">
                            <div>
                                <div class="content-title">${quiz.title || 'Untitled Quiz'}</div>
                                <div style="color: var(--text-secondary); margin-bottom: 5px;">${quiz.description || quiz.subject || ''}</div>
                                <div class="content-meta">
                                    ${quiz.subject ? `<span><i class="fas fa-book"></i> ${quiz.subject}</span>` : ''}
                                    ${quiz.time ? `<span><i class="fas fa-clock"></i> ${quiz.time} min</span>` : ''}
                                    ${quiz.difficulty ? `<span><i class="fas fa-signal"></i> ${quiz.difficulty}</span>` : ''}
                                    ${quiz.branch ? `<span><i class="fas fa-graduation-cap"></i> ${quiz.branch}</span>` : ''}
                                    ${quiz.semester ? `<span><i class="fas fa-calendar-alt"></i> Sem ${quiz.semester}</span>` : ''}
                                    <span><i class="fas fa-clock"></i> ${formatTimestamp(quiz.createdAt)}</span>
                                </div>
                            </div>
                            <div class="content-actions">
                                <button class="btn-secondary" style="padding: 8px 12px; font-size: 0.9rem;" onclick="editQuiz('${quiz.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-danger" style="padding: 8px 12px; font-size: 0.9rem;" onclick="deleteQuiz('${quiz.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            quizzesList.innerHTML = quizzesHtml;
        }
        
        // Filter quizzes based on search and filters
        function filterQuizzes() {
            const searchTerm = quizSearch.value.toLowerCase();
            const branchFilter = quizBranchFilter.value;
            const semesterFilter = quizSemesterFilter.value;
            
            db.collection('quizzes')
                .orderBy('createdAt', 'desc')
                .get()
                .then(snapshot => {
                    const quizzes = [];
                    
                    snapshot.forEach(doc => {
                        const quiz = doc.data();
                        quiz.id = doc.id;
                        
                        // Check if quiz matches search term
                        const matchesSearch = searchTerm === '' || 
                            (quiz.title && quiz.title.toLowerCase().includes(searchTerm)) ||
                            (quiz.description && quiz.description.toLowerCase().includes(searchTerm)) ||
                            (quiz.subject && quiz.subject.toLowerCase().includes(searchTerm));
                        
                        // Check if quiz matches branch filter
                        const matchesBranch = branchFilter === '' || quiz.branch === branchFilter;
                        
                        // Check if quiz matches semester filter
                        const matchesSemester = semesterFilter === '' || quiz.semester === semesterFilter;
                        
                        if (matchesSearch && matchesBranch && matchesSemester) {
                            quizzes.push(quiz);
                        }
                    });
                    
                    renderQuizzes(quizzes);
                })
                .catch(error => {
                    console.error('Error filtering quizzes:', error);
                });
        }
        
        // Save quiz
        function saveQuiz() {
            const quizId = document.getElementById('quiz-id').value;
            const quizData = {
                title: document.getElementById('quiz-title').value,
                description: document.getElementById('quiz-description').value,
                subject: document.getElementById('quiz-subject').value,
                time: parseInt(document.getElementById('quiz-time').value),
                difficulty: document.getElementById('quiz-difficulty').value,
                branch: document.getElementById('quiz-branch').value,
                semester: document.getElementById('quiz-semester').value,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            // Validate required fields
            if (!quizData.title || !quizData.subject || !quizData.time) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            if (quizId) {
                // Update existing quiz
                db.collection('quizzes').doc(quizId).update(quizData)
                    .then(() => {
                        showToast('Quiz updated successfully', 'success');
                        quizModal.classList.remove('active');
                    })
                    .catch(error => {
                        console.error('Error updating quiz:', error);
                        showToast('Failed to update quiz: ' + error.message, 'error');
                    });
            } else {
                // Add new quiz
                db.collection('quizzes').add(quizData)
                    .then(() => {
                        showToast('Quiz added successfully', 'success');
                        quizModal.classList.remove('active');
                    })
                    .catch(error => {
                        console.error('Error adding quiz:', error);
                        showToast('Failed to add quiz: ' + error.message, 'error');
                    });
            }
        }
        
        // Edit quiz
        function editQuiz(quizId) {
            db.collection('quizzes').doc(quizId).get()
                .then(doc => {
                    if (doc.exists) {
                        const quiz = doc.data();
                        document.getElementById('quiz-modal-title').textContent = 'Edit Quiz';
                        document.getElementById('quiz-id').value = quizId;
                        document.getElementById('quiz-title').value = quiz.title || '';
                        document.getElementById('quiz-description').value = quiz.description || '';
                        document.getElementById('quiz-subject').value = quiz.subject || '';
                        document.getElementById('quiz-time').value = quiz.time || '';
                        document.getElementById('quiz-difficulty').value = quiz.difficulty || 'medium';
                        
                        // Set branch and semester
                        document.getElementById('quiz-branch').value = quiz.branch || '';
                        document.getElementById('quiz-semester').value = quiz.semester || '';
                        
                        // Update selection display
                        if (quiz.branch && quiz.semester) {
                            document.getElementById('quiz-selected-branch').textContent = branches[quiz.branch]?.name || quiz.branch;
                            document.getElementById('quiz-selected-semester').textContent = `Semester ${quiz.semester}`;
                            document.getElementById('quiz-selected-course').textContent = quiz.subject || '-';
                            document.getElementById('quiz-selection-display').style.display = 'block';
                            
                            // Hide original dropdowns
                            document.getElementById('quiz-branch').parentElement.style.display = 'none';
                            document.getElementById('quiz-semester').parentElement.style.display = 'none';
                        } else {
                            document.getElementById('quiz-selection-display').style.display = 'none';
                            document.getElementById('quiz-branch').parentElement.style.display = 'block';
                            document.getElementById('quiz-semester').parentElement.style.display = 'block';
                        }
                        
                        quizModal.classList.add('active');
                    }
                })
                .catch(error => {
                    console.error('Error getting quiz:', error);
                    showToast('Failed to load quiz', 'error');
                });
        }
        
        // Delete quiz
        function deleteQuiz(quizId) {
            if (confirm('Are you sure you want to delete this quiz?')) {
                db.collection('quizzes').doc(quizId).delete()
                    .then(() => {
                        showToast('Quiz deleted successfully', 'success');
                    })
                    .catch(error => {
                        console.error('Error deleting quiz:', error);
                        showToast('Failed to delete quiz', 'error');
                    });
            }
        }
        
        // Load seminars with real-time updates
        function loadSeminars() {
            const seminarsList = document.getElementById('seminars-list');
            let seminars = [];
            
            db.collection('seminars')
                .orderBy('createdAt', 'desc')
                .onSnapshot(snapshot => {
                    seminars = [];
                    
                    snapshot.forEach(doc => {
                        const seminar = doc.data();
                        seminar.id = doc.id;
                        seminars.push(seminar);
                    });
                    
                    renderSeminars(seminars);
                }, error => {
                    console.error('Error loading seminars:', error);
                    seminarsList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon"><i class="fas fa-exclamation-circle"></i></div>
                            <p>Failed to load seminars</p>
                        </div>
                    `;
                });
        }
        
        // Render seminars with search
        function renderSeminars(seminars) {
            const seminarsList = document.getElementById('seminars-list');
            
            if (seminars.length === 0) {
                seminarsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon"><i class="fas fa-chalkboard-teacher"></i></div>
                        <p>No seminars found</p>
                    </div>
                `;
                return;
            }
            
            const seminarsHtml = seminars.map(seminar => {
                let dateTime = 'N/A';
                if (seminar.datetime) {
                    const date = new Date(seminar.datetime);
                    dateTime = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                }
                
                return `
                    <div class="content-card">
                        <div class="content-header">
                            <div>
                                <div class="content-title">${seminar.title || 'Untitled Seminar'}</div>
                                <div style="color: var(--text-secondary); margin-bottom: 5px;">${seminar.description || ''}</div>
                                <div class="content-meta">
                                    <span><i class="fas fa-user"></i> ${seminar.speaker || 'Unknown'}</span>
                                    <span><i class="fas fa-calendar"></i> ${dateTime}</span>
                                    <span><i class="fas fa-clock"></i> ${formatTimestamp(seminar.createdAt)}</span>
                                </div>
                            </div>
                            <div class="content-actions">
                                <a href="${seminar.link}" target="_blank" class="btn-info" style="padding: 8px 12px; font-size: 0.9rem; text-decoration: none;">
                                    <i class="fas fa-external-link-alt"></i> Watch
                                </a>
                                <button class="btn-secondary" style="padding: 8px 12px; font-size: 0.9rem;" onclick="editSeminar('${seminar.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="btn-danger" style="padding: 8px 12px; font-size: 0.9rem;" onclick="deleteSeminar('${seminar.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            seminarsList.innerHTML = seminarsHtml;
        }
        
        // Filter seminars based on search
        function filterSeminars() {
            const searchTerm = seminarSearch.value.toLowerCase();
            
            db.collection('seminars')
                .orderBy('createdAt', 'desc')
                .get()
                .then(snapshot => {
                    const seminars = [];
                    
                    snapshot.forEach(doc => {
                        const seminar = doc.data();
                        seminar.id = doc.id;
                        
                        // Check if seminar matches search term
                        const matchesSearch = searchTerm === '' || 
                            (seminar.title && seminar.title.toLowerCase().includes(searchTerm)) ||
                            (seminar.description && seminar.description.toLowerCase().includes(searchTerm)) ||
                            (seminar.speaker && seminar.speaker.toLowerCase().includes(searchTerm));
                        
                        if (matchesSearch) {
                            seminars.push(seminar);
                        }
                    });
                    
                    renderSeminars(seminars);
                })
                .catch(error => {
                    console.error('Error filtering seminars:', error);
                });
        }
        
        // Save seminar
        function saveSeminar() {
            const seminarId = document.getElementById('seminar-id').value;
            const seminarData = {
                title: document.getElementById('seminar-title').value,
                description: document.getElementById('seminar-description').value,
                speaker: document.getElementById('seminar-speaker').value,
                datetime: document.getElementById('seminar-datetime').value,
                link: document.getElementById('seminar-link').value,
                thumbnail: document.getElementById('seminar-thumbnail').value,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            // Validate required fields
            if (!seminarData.title || !seminarData.speaker || !seminarData.datetime || !seminarData.link) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            // Validate video link
            if (!seminarData.link.includes('youtube.com') && !seminarData.link.includes('youtu.be')) {
                showToast('Please enter a valid YouTube link', 'error');
                return;
            }
            
            if (seminarId) {
                // Update existing seminar
                db.collection('seminars').doc(seminarId).update(seminarData)
                    .then(() => {
                        showToast('Seminar updated successfully', 'success');
                        seminarModal.classList.remove('active');
                    })
                    .catch(error => {
                        console.error('Error updating seminar:', error);
                        showToast('Failed to update seminar: ' + error.message, 'error');
                    });
            } else {
                // Add new seminar
                db.collection('seminars').add(seminarData)
                    .then(() => {
                        showToast('Seminar added successfully', 'success');
                        seminarModal.classList.remove('active');
                    })
                    .catch(error => {
                        console.error('Error adding seminar:', error);
                        showToast('Failed to add seminar: ' + error.message, 'error');
                    });
            }
        }
        
        // Edit seminar
        function editSeminar(seminarId) {
            db.collection('seminars').doc(seminarId).get()
                .then(doc => {
                    if (doc.exists) {
                        const seminar = doc.data();
                        document.getElementById('seminar-modal-title').textContent = 'Edit Seminar';
                        document.getElementById('seminar-id').value = seminarId;
                        document.getElementById('seminar-title').value = seminar.title || '';
                        document.getElementById('seminar-description').value = seminar.description || '';
                        document.getElementById('seminar-speaker').value = seminar.speaker || '';
                        document.getElementById('seminar-datetime').value = seminar.datetime || '';
                        document.getElementById('seminar-link').value = seminar.link || '';
                        document.getElementById('seminar-thumbnail').value = seminar.thumbnail || '';
                        
                        // Show thumbnail preview if exists
                        const thumbnailPreview = document.getElementById('seminar-thumbnail-preview');
                        if (seminar.thumbnail) {
                            thumbnailPreview.src = seminar.thumbnail;
                            thumbnailPreview.style.display = 'block';
                        } else {
                            thumbnailPreview.style.display = 'none';
                        }
                        
                        seminarModal.classList.add('active');
                    }
                })
                .catch(error => {
                    console.error('Error getting seminar:', error);
                    showToast('Failed to load seminar', 'error');
                });
        }
        
        // Delete seminar
        function deleteSeminar(seminarId) {
            if (confirm('Are you sure you want to delete this seminar?')) {
                db.collection('seminars').doc(seminarId).delete()
                    .then(() => {
                        showToast('Seminar deleted successfully', 'success');
                    })
                    .catch(error => {
                        console.error('Error deleting seminar:', error);
                        showToast('Failed to delete seminar', 'error');
                    });
            }
        }
        
        // Load payments with real-time updates
        function loadPayments() {
            const paymentsList = document.getElementById('payments-list');
            let payments = [];
            
            db.collection('transactions')
                .orderBy('createdAt', 'desc')
                .limit(50)
                .onSnapshot(snapshot => {
                    payments = [];
                    
                    snapshot.forEach(doc => {
                        const transaction = doc.data();
                        transaction.id = doc.id;
                        payments.push(transaction);
                    });
                    
                    renderPayments(payments);
                }, error => {
                    console.error('Error loading payments:', error);
                    paymentsList.innerHTML = `
                        <div class="empty-state">
                            <div class="empty-icon"><i class="fas fa-exclamation-circle"></i></div>
                            <p>Failed to load payment history</p>
                        </div>
                    `;
                });
        }
        
        // Render payments with search/filter
        function renderPayments(payments) {
            const paymentsList = document.getElementById('payments-list');
            
            if (payments.length === 0) {
                paymentsList.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon"><i class="fas fa-credit-card"></i></div>
                        <p>No payment transactions found</p>
                    </div>
                `;
                return;
            }
            
            const paymentsHtml = `
                <div style="overflow-x: auto;">
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>User</th>
                                <th>Type</th>
                                <th>Amount</th>
                                <th>Description</th>
                                <th>Date</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${payments.map(transaction => {
                                // Get user name
                                let userName = 'Unknown';
                                if (transaction.userId) {
                                    db.collection('users').doc(transaction.userId).get()
                                        .then(userDoc => {
                                            if (userDoc.exists) {
                                                const userData = userDoc.data();
                                                const userElement = document.getElementById(`user-${transaction.id}`);
                                                if (userElement) {
                                                    userElement.textContent = userData.name || 'Unknown';
                                                }
                                            }
                                        })
                                        .catch(error => {
                                            console.error('Error getting user:', error);
                                        });
                                }
                                
                                return `
                                    <tr>
                                        <td>${transaction.id.substring(0, 8)}...</td>
                                        <td id="user-${transaction.id}">Loading...</td>
                                        <td style="color: ${transaction.type === 'earn' ? 'var(--success)' : 'var(--danger)'};">
                                            ${transaction.type === 'earn' ? 'Earn' : 'Spend'}
                                        </td>
                                        <td style="color: ${transaction.type === 'earn' ? 'var(--success)' : 'var(--danger)'};">
                                            ${transaction.type === 'earn' ? '+' : '-'}${transaction.amount}
                                        </td>
                                        <td>${transaction.description || 'No description'}</td>
                                        <td>${formatTimestamp(transaction.createdAt)}</td>
                                    </tr>
                                `;
                            }).join('')}
                        </tbody>
                    </table>
                </div>
            `;
            
            paymentsList.innerHTML = paymentsHtml;
        }
        
        // Filter payments based on search and filters
        function filterPayments() {
            const searchTerm = paymentSearch.value.toLowerCase();
            const typeFilter = paymentTypeFilter.value;
            const dateFilter = paymentDateFilter.value;
            
            db.collection('transactions')
                .orderBy('createdAt', 'desc')
                .get()
                .then(snapshot => {
                    const payments = [];
                    
                    snapshot.forEach(doc => {
                        const transaction = doc.data();
                        transaction.id = doc.id;
                        
                        // Check if transaction matches search term
                        const matchesSearch = searchTerm === '' || 
                            (transaction.description && transaction.description.toLowerCase().includes(searchTerm));
                        
                        // Check if transaction matches type filter
                        const matchesType = typeFilter === '' || transaction.type === typeFilter;
                        
                        // Check if transaction matches date filter
                        let matchesDate = true;
                        if (dateFilter !== '') {
                            const transactionDate = new Date(transaction.createdAt.toDate());
                            const filterDate = new Date(dateFilter);
                            matchesDate = transactionDate.toDateString() === filterDate.toDateString();
                        }
                        
                        if (matchesSearch && matchesType && matchesDate) {
                            payments.push(transaction);
                        }
                    });
                    
                    renderPayments(payments);
                })
                .catch(error => {
                    console.error('Error filtering payments:', error);
                });
        }
        
        // Export payments
        function exportPayments() {
            showToast('Export feature coming soon!', 'info');
        }
        
        // Load analytics with real data
        function loadAnalytics() {
            // Load material usage chart
            loadMaterialUsageChart();
            
            // Load user engagement chart
            loadUserEngagementChart();
            
            // Load revenue chart
            loadRevenueChart();
        }
        
        // Load material usage chart with real data
        function loadMaterialUsageChart() {
            const ctx = document.getElementById('material-usage-chart').getContext('2d');
            
            // Get the last 7 days
            const labels = [];
            const data = [];
            const today = new Date();
            
            // Initialize an object to hold counts for each day
            const counts = {};
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                const dateString = date.toISOString().split('T')[0];
                labels.push(date.toLocaleDateString('en-US', { weekday: 'short' }));
                counts[dateString] = 0;
            }
            
            // Query material views in the last 7 days
            const sevenDaysAgo = new Date(today);
            sevenDaysAgo.setDate(sevenDaysAgo.getDate() - 7);
            
            db.collection('material_views')
                .where('timestamp', '>=', sevenDaysAgo)
                .get()
                .then(snapshot => {
                    snapshot.forEach(doc => {
                        const view = doc.data();
                        if (view.timestamp && view.timestamp.toDate) {
                            const date = view.timestamp.toDate();
                            const dateString = date.toISOString().split('T')[0];
                            if (counts.hasOwnProperty(dateString)) {
                                counts[dateString]++;
                            }
                        }
                    });
                    
                    // Convert counts object to array in the order of labels
                    labels.forEach(label => {
                        const date = new Date(label);
                        const dateString = date.toISOString().split('T')[0];
                        data.push(counts[dateString] || 0);
                    });
                    
                    // Create or update the chart
                    if (materialUsageChart) {
                        materialUsageChart.destroy();
                    }
                    
                    materialUsageChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Materials Viewed',
                                data: data,
                                backgroundColor: 'rgba(255, 215, 0, 0.7)',
                                borderColor: 'rgba(255, 215, 0, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Material Usage (Last 7 Days)',
                                    color: '#F0F0F0',
                                    font: {
                                        size: 16
                                    }
                                },
                                legend: {
                                    labels: {
                                        color: '#F0F0F0'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#A0A0A0'
                                    }
                                },
                                x: {
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#A0A0A0'
                                    }
                                }
                            }
                        }
                    });
                })
                .catch(error => {
                    console.error('Error loading material usage data:', error);
                    
                    // If no data, show empty chart
                    if (materialUsageChart) {
                        materialUsageChart.destroy();
                    }
                    
                    materialUsageChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Materials Viewed',
                                data: [0, 0, 0, 0, 0, 0, 0],
                                backgroundColor: 'rgba(255, 215, 0, 0.7)',
                                borderColor: 'rgba(255, 215, 0, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'Material Usage (Last 7 Days)',
                                    color: '#F0F0F0',
                                    font: {
                                        size: 16
                                    }
                                },
                                legend: {
                                    labels: {
                                        color: '#F0F0F0'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#A0A0A0'
                                    }
                                },
                                x: {
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#A0A0A0'
                                    }
                                }
                            }
                        }
                    });
                });
        }
        
        // Load user engagement chart with real data
        function loadUserEngagementChart() {
            const ctx = document.getElementById('user-engagement-chart').getContext('2d');
            
            // Get the last 7 months
            const labels = [];
            const data = [];
            const today = new Date();
            
            // Initialize an object to hold counts for each month
            const counts = {};
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date(today);
                date.setMonth(date.getMonth() - i);
                const monthString = date.toISOString().substring(0, 7); // YYYY-MM
                labels.push(date.toLocaleDateString('en-US', { month: 'short' }));
                counts[monthString] = 0;
            }
            
            // Query user activity in the last 7 months
            const sevenMonthsAgo = new Date(today);
            sevenMonthsAgo.setMonth(sevenMonthsAgo.getMonth() - 7);
            
            db.collection('user_activity')
                .where('timestamp', '>=', sevenMonthsAgo)
                .get()
                .then(snapshot => {
                    const activeUsers = {};
                    
                    snapshot.forEach(doc => {
                        const activity = doc.data();
                        if (activity.timestamp && activity.timestamp.toDate && activity.userId) {
                            const date = activity.timestamp.toDate();
                            const monthString = date.toISOString().substring(0, 7); // YYYY-MM
                            
                            if (counts.hasOwnProperty(monthString)) {
                                // Count unique users per month
                                if (!activeUsers[monthString]) {
                                    activeUsers[monthString] = new Set();
                                }
                                activeUsers[monthString].add(activity.userId);
                            }
                        }
                    });
                    
                    // Convert counts object to array in the order of labels
                    labels.forEach(label => {
                        const date = new Date(label + ' 1, 2023');
                        const monthString = date.toISOString().substring(0, 7); // YYYY-MM
                        data.push(activeUsers[monthString] ? activeUsers[monthString].size : 0);
                    });
                    
                    // Create or update the chart
                    if (userEngagementChart) {
                        userEngagementChart.destroy();
                    }
                    
                    userEngagementChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Active Users',
                                data: data,
                                backgroundColor: 'rgba(0, 162, 255, 0.2)',
                                borderColor: 'rgba(0, 162, 255, 1)',
                                borderWidth: 2,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'User Engagement (Last 7 Months)',
                                    color: '#F0F0F0',
                                    font: {
                                        size: 16
                                    }
                                },
                                legend: {
                                    labels: {
                                        color: '#F0F0F0'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#A0A0A0'
                                    }
                                },
                                x: {
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#A0A0A0'
                                    }
                                }
                            }
                        }
                    });
                })
                .catch(error => {
                    console.error('Error loading user engagement data:', error);
                    
                    // If no data, show empty chart
                    if (userEngagementChart) {
                        userEngagementChart.destroy();
                    }
                    
                    userEngagementChart = new Chart(ctx, {
                        type: 'line',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Active Users',
                                data: [0, 0, 0, 0, 0, 0, 0],
                                backgroundColor: 'rgba(0, 162, 255, 0.2)',
                                borderColor: 'rgba(0, 162, 255, 1)',
                                borderWidth: 2,
                                tension: 0.4
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: 'User Engagement (Last 7 Months)',
                                    color: '#F0F0F0',
                                    font: {
                                        size: 16
                                    }
                                },
                                legend: {
                                    labels: {
                                        color: '#F0F0F0'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#A0A0A0'
                                    }
                                },
                                x: {
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#A0A0A0'
                                    }
                                }
                            }
                        }
                    });
                });
        }
        
        // Load revenue chart with real data
        function loadRevenueChart() {
            const ctx = document.getElementById('revenue-chart').getContext('2d');
            
            // Get the current year
            const currentYear = new Date().getFullYear();
            const labels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            const data = new Array(12).fill(0);
            
            // Query transactions for the current year
            const startOfYear = new Date(currentYear, 0, 1);
            const endOfYear = new Date(currentYear, 11, 31);
            
            db.collection('transactions')
                .where('createdAt', '>=', startOfYear)
                .where('createdAt', '<=', endOfYear)
                .get()
                .then(snapshot => {
                    snapshot.forEach(doc => {
                        const transaction = doc.data();
                        if (transaction.createdAt && transaction.createdAt.toDate) {
                            const date = transaction.createdAt.toDate();
                            const month = date.getMonth();
                            
                            // Only count earnings as revenue
                            if (transaction.type === 'earn') {
                                data[month] += transaction.amount || 0;
                            }
                        }
                    });
                    
                    // Create or update the chart
                    if (revenueChart) {
                        revenueChart.destroy();
                    }
                    
                    revenueChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Revenue',
                                data: data,
                                backgroundColor: 'rgba(46, 204, 113, 0.7)',
                                borderColor: 'rgba(46, 204, 113, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: `Revenue Overview (${currentYear})`,
                                    color: '#F0F0F0',
                                    font: {
                                        size: 16
                                    }
                                },
                                legend: {
                                    labels: {
                                        color: '#F0F0F0'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#A0A0A0',
                                        callback: function(value) {
                                            return '$' + value.toLocaleString();
                                        }
                                    }
                                },
                                x: {
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#A0A0A0'
                                    }
                                }
                            }
                        }
                    });
                })
                .catch(error => {
                    console.error('Error loading revenue data:', error);
                    
                    // If no data, show empty chart
                    if (revenueChart) {
                        revenueChart.destroy();
                    }
                    
                    revenueChart = new Chart(ctx, {
                        type: 'bar',
                        data: {
                            labels: labels,
                            datasets: [{
                                label: 'Revenue',
                                data: new Array(12).fill(0),
                                backgroundColor: 'rgba(46, 204, 113, 0.7)',
                                borderColor: 'rgba(46, 204, 113, 1)',
                                borderWidth: 1
                            }]
                        },
                        options: {
                            responsive: true,
                            maintainAspectRatio: false,
                            plugins: {
                                title: {
                                    display: true,
                                    text: `Revenue Overview (${currentYear})`,
                                    color: '#F0F0F0',
                                    font: {
                                        size: 16
                                    }
                                },
                                legend: {
                                    labels: {
                                        color: '#F0F0F0'
                                    }
                                }
                            },
                            scales: {
                                y: {
                                    beginAtZero: true,
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#A0A0A0',
                                        callback: function(value) {
                                            return '$' + value.toLocaleString();
                                        }
                                    }
                                },
                                x: {
                                    grid: {
                                        color: 'rgba(255, 255, 255, 0.1)'
                                    },
                                    ticks: {
                                        color: '#A0A0A0'
                                    }
                                }
                            }
                        }
                    });
                });
        }
        
        // Load settings
        function loadSettings() {
            db.collection('settings').doc('system').get()
                .then(doc => {
                    if (doc.exists) {
                        const settings = doc.data();
                        document.getElementById('platform-name').value = settings.platformName || 'IB STUDIOZ';
                        document.getElementById('admin-email').value = settings.adminEmail || 'admin@ibstudioz.com';
                        document.getElementById('support-contact').value = settings.supportContact || '+1 (555) 123-4567';
                        document.getElementById('default-credits').value = settings.defaultCredits || 100;
                        
                        // Set toggle states
                        if (settings.registrationEnabled) {
                            document.getElementById('registration-toggle').classList.add('active');
                        } else {
                            document.getElementById('registration-toggle').classList.remove('active');
                        }
                        
                        if (settings.emailNotificationsEnabled) {
                            document.getElementById('email-toggle').classList.add('active');
                        } else {
                            document.getElementById('email-toggle').classList.remove('active');
                        }
                        
                        if (settings.maintenanceMode) {
                            document.getElementById('maintenance-toggle').classList.add('active');
                        } else {
                            document.getElementById('maintenance-toggle').classList.remove('active');
                        }
                        
                        if (settings.analyticsEnabled) {
                            document.getElementById('analytics-toggle').classList.add('active');
                        } else {
                            document.getElementById('analytics-toggle').classList.remove('active');
                        }
                    }
                })
                .catch(error => {
                    console.error('Error loading settings:', error);
                });
        }
        
        // Save settings
        function saveSettings() {
            const settings = {
                platformName: document.getElementById('platform-name').value,
                adminEmail: document.getElementById('admin-email').value,
                supportContact: document.getElementById('support-contact').value,
                defaultCredits: parseInt(document.getElementById('default-credits').value) || 100,
                registrationEnabled: document.getElementById('registration-toggle').classList.contains('active'),
                emailNotificationsEnabled: document.getElementById('email-toggle').classList.contains('active'),
                maintenanceMode: document.getElementById('maintenance-toggle').classList.contains('active'),
                analyticsEnabled: document.getElementById('analytics-toggle').classList.contains('active'),
                updatedAt: firebase.firestore.FieldValue.serverTimestamp()
            };
            
            db.collection('settings').doc('system').set(settings)
                .then(() => {
                    showToast('Settings saved successfully', 'success');
                })
                .catch(error => {
                    console.error('Error saving settings:', error);
                    showToast('Failed to save settings', 'error');
                });
        }
        
        // Initialize branch options
        function initializeBranchOptions() {
            branchOptions.innerHTML = '';
            
            for (const code in branches) {
                const branch = branches[code];
                const branchCard = document.createElement('div');
                branchCard.className = 'selection-card';
                branchCard.dataset.branch = code;
                
                branchCard.innerHTML = `
                    <div class="selection-icon">
                        <i class="${branch.icon}"></i>
                    </div>
                    <div class="selection-name">${branch.name}</div>
                    <div class="selection-code">${code}</div>
                `;
                
                branchCard.addEventListener('click', () => selectBranch(code));
                branchOptions.appendChild(branchCard);
            }
        }
        
        // Select branch
        function selectBranch(code) {
            currentSelection.branch = code;
            
            // Update UI
            document.querySelectorAll('#branch-options .selection-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`#branch-options .selection-card[data-branch="${code}"]`).classList.add('selected');
            
            // Enable next button
            nextStepBtn.disabled = false;
        }
        
        // Initialize semester options
        function initializeSemesterOptions() {
            semesterOptions.innerHTML = '';
            
            if (!currentSelection.branch || !branches[currentSelection.branch]) return;
            
            const semesters = branches[currentSelection.branch].semesters;
            
            for (const semNum in semesters) {
                const semesterCard = document.createElement('div');
                semesterCard.className = 'selection-card';
                semesterCard.dataset.semester = semNum;
                
                semesterCard.innerHTML = `
                    <div class="selection-icon">
                        <i class="fas fa-calendar-alt"></i>
                    </div>
                    <div class="selection-name">Semester ${semNum}</div>
                `;
                
                semesterCard.addEventListener('click', () => selectSemester(semNum));
                semesterOptions.appendChild(semesterCard);
            }
        }
        
        // Select semester
        function selectSemester(semNum) {
            currentSelection.semester = semNum;
            
            // Update UI
            document.querySelectorAll('#semester-options .selection-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`#semester-options .selection-card[data-semester="${semNum}"]`).classList.add('selected');
            
            // Enable next button
            nextStepBtn.disabled = false;
        }
        
        // Initialize course options
        function initializeCourseOptions() {
            courseOptions.innerHTML = '';
            
            if (!currentSelection.branch || !currentSelection.semester || !branches[currentSelection.branch]) return;
            
            const courses = branches[currentSelection.branch].semesters[currentSelection.semester] || [];
            
            if (courses.length === 0) {
                courseOptions.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">No courses available for this semester</p>';
                return;
            }
            
            courses.forEach(course => {
                const courseCard = document.createElement('div');
                courseCard.className = 'selection-card';
                courseCard.dataset.course = course.code;
                
                courseCard.innerHTML = `
                    <div class="selection-name">${course.name}</div>
                    <div class="selection-code">${course.code}</div>
                    <div class="selection-code">${course.credits} Credits</div>
                `;
                
                courseCard.addEventListener('click', () => selectCourse(course));
                courseOptions.appendChild(courseCard);
            });
        }
        
        // Select course
        function selectCourse(course) {
            currentSelection.course = course;
            
            // Update UI
            document.querySelectorAll('#course-options .selection-card').forEach(card => {
                card.classList.remove('selected');
            });
            document.querySelector(`#course-options .selection-card[data-course="${course.code}"]`).classList.add('selected');
            
            // Enable finish button
            finishSelectionBtn.disabled = false;
        }
        
        // Navigate to next step
        function goToNextStep() {
            if (branchStep.classList.contains('active')) {
                if (!currentSelection.branch) {
                    showToast('Please select a branch', 'error');
                    return;
                }
                
                // Move to semester step
                branchStep.classList.remove('active');
                semesterStep.classList.add('active');
                
                // Update step indicators
                stepIndicators[0].classList.remove('active');
                stepIndicators[1].classList.add('active');
                
                // Initialize semester options
                initializeSemesterOptions();
                
                // Show previous button
                prevStepBtn.style.display = 'block';
                
                // Disable next button until semester is selected
                nextStepBtn.disabled = true;
            } else if (semesterStep.classList.contains('active')) {
                if (!currentSelection.semester) {
                    showToast('Please select a semester', 'error');
                    return;
                }
                
                // Move to course step
                semesterStep.classList.remove('active');
                courseStep.classList.add('active');
                
                // Update step indicators
                stepIndicators[1].classList.remove('active');
                stepIndicators[2].classList.add('active');
                
                // Initialize course options
                initializeCourseOptions();
                
                // Hide next button, show finish button
                nextStepBtn.style.display = 'none';
                finishSelectionBtn.style.display = 'block';
                
                // Disable finish button until course is selected
                finishSelectionBtn.disabled = true;
            }
        }
        
        // Navigate to previous step
        function goToPrevStep() {
            if (semesterStep.classList.contains('active')) {
                // Move to branch step
                semesterStep.classList.remove('active');
                branchStep.classList.add('active');
                
                // Update step indicators
                stepIndicators[1].classList.remove('active');
                stepIndicators[0].classList.add('active');
                
                // Hide previous button
                prevStepBtn.style.display = 'none';
            } else if (courseStep.classList.contains('active')) {
                // Move to semester step
                courseStep.classList.remove('active');
                semesterStep.classList.add('active');
                
                // Update step indicators
                stepIndicators[2].classList.remove('active');
                stepIndicators[1].classList.add('active');
                
                // Show next button, hide finish button
                nextStepBtn.style.display = 'block';
                finishSelectionBtn.style.display = 'none';
            }
        }
        
        // Finish selection
        function finishSelection() {
            if (!currentSelection.course) {
                showToast('Please select a course', 'error');
                return;
            }
            
            // Update form fields
            if (currentSelection.form === 'material') {
                document.getElementById('material-branch').value = currentSelection.branch;
                document.getElementById('material-semester').value = currentSelection.semester;
                
                // Update display
                document.getElementById('material-selected-branch').textContent = branches[currentSelection.branch].name;
                document.getElementById('material-selected-semester').textContent = `Semester ${currentSelection.semester}`;
                document.getElementById('material-selected-course').textContent = currentSelection.course.name;
                document.getElementById('material-selection-display').style.display = 'block';
                
                // Hide original dropdowns
                document.getElementById('material-branch').parentElement.style.display = 'none';
                document.getElementById('material-semester').parentElement.style.display = 'none';
            } else if (currentSelection.form === 'pyq') {
                document.getElementById('pyq-branch').value = currentSelection.branch;
                document.getElementById('pyq-semester').value = currentSelection.semester;
                
                // Update display
                document.getElementById('pyq-selected-branch').textContent = branches[currentSelection.branch].name;
                document.getElementById('pyq-selected-semester').textContent = `Semester ${currentSelection.semester}`;
                document.getElementById('pyq-selected-course').textContent = currentSelection.course.name;
                document.getElementById('pyq-selection-display').style.display = 'block';
                
                // Hide original dropdowns
                document.getElementById('pyq-branch').parentElement.style.display = 'none';
                document.getElementById('pyq-semester').parentElement.style.display = 'none';
            } else if (currentSelection.form === 'quiz') {
                document.getElementById('quiz-branch').value = currentSelection.branch;
                document.getElementById('quiz-semester').value = currentSelection.semester;
                
                // Update display
                document.getElementById('quiz-selected-branch').textContent = branches[currentSelection.branch].name;
                document.getElementById('quiz-selected-semester').textContent = `Semester ${currentSelection.semester}`;
                document.getElementById('quiz-selected-course').textContent = currentSelection.course.name;
                document.getElementById('quiz-selection-display').style.display = 'block';
                
                // Hide original dropdowns
                document.getElementById('quiz-branch').parentElement.style.display = 'none';
                document.getElementById('quiz-semester').parentElement.style.display = 'none';
            }
            
            // Close modal
            branchSemesterCourseModal.classList.remove('active');
            
            // Reset selections
            currentSelection = {
                form: null,
                branch: null,
                semester: null,
                course: null
            };
        }
        
        // Open branch-semester-course modal
        function openBranchSemesterCourseModal(formType) {
            currentSelection.form = formType;
            
            // Reset modal state
            branchStep.classList.add('active');
            semesterStep.classList.remove('active');
            courseStep.classList.remove('active');
            
            stepIndicators[0].classList.add('active');
            stepIndicators[1].classList.remove('active');
            stepIndicators[2].classList.remove('active');
            
            prevStepBtn.style.display = 'none';
            nextStepBtn.style.display = 'block';
            finishSelectionBtn.style.display = 'none';
            
            nextStepBtn.disabled = true;
            finishSelectionBtn.disabled = true;
            
            // Initialize branch options
            initializeBranchOptions();
            
            // Show modal
            branchSemesterCourseModal.classList.add('active');
        }
        
        // Keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Escape key closes modals
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal-overlay.active').forEach(modal => {
                    modal.classList.remove('active');
                });
            }
        });
        
        // Authentication check
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                
                // Check if user is admin
                db.collection('users').doc(user.uid).get().then(doc => {
                    if (doc.exists) {
                        const userData = doc.data();
                        if (userData.role !== 'admin') {
                            // Redirect to student dashboard if not admin
                            window.location.replace('/studentdashboard.html');
                            return;
                        }
                        
                        // Initialize page
                        initializePage();
                        
                        // Load dashboard data
                        loadDashboardData();
                    } else {
                        // User data not found, redirect to login
                        window.location.replace('/index.html');
                    }
                }).catch(error => {
                    console.error('Error getting user data:', error);
                    window.location.replace('/index.html');
                });
            } else {
                // Redirect to login page
                window.location.replace('/index.html');
            }
        });
        
        // Console welcome message
        console.log('%cIB STUDIOZ Admin Dashboard', 'color: #FFD700; font-size: 24px; font-weight: bold;');
        console.log('%cWelcome to your powerful admin control panel', 'color: #00A2FF; font-size: 14px;');
        console.log('Real-time Firebase integration active ');
    </script>
</body>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Content | Admin Panel</title>
    
    <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%23FFD700' d='M50,2 A48,48 0 1,0 50,98 A48,48 0 1,0 50,2 Z' /%3E%3Cg fill='%230A0A0A'%3E%3Cpath d='M28,25 h10 v50 h-10 Z' /%3E%3Cpath d='M45,25 H60 A12.5,12.5 0 0,1 60,50 H45 Z M45,50 H63 A12.5,12.5 0 0,1 63,75 H45 Z' /%3E%3C/g%3E%3C/svg%3E">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        :root {
            --primary-glow: #FFD700; --secondary-glow: #00A2FF; --dark-bg: #0A0A0A;
            --text-primary: #F0F0F0; --text-secondary: #A0A0A0; --card-bg: rgba(22, 22, 22, 0.8);
            --border-color: rgba(255, 215, 0, 0.2); --shadow-color: rgba(0, 0, 0, 0.5);
            --success: #2ecc71; --danger: #e74c3c;
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: 'Inter', sans-serif; background-color: var(--dark-bg);
            color: var(--text-primary); line-height: 1.6;
            opacity: 0;
            animation: page-fade-in 0.5s ease-out forwards;
        }
        @keyframes page-fade-in { to { opacity: 1; } }

        .background-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -2; }
        .aurora-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 10% 20%, var(--primary-glow) 0%, transparent 25%), radial-gradient(circle at 80% 30%, var(--secondary-glow) 0%, transparent 30%), radial-gradient(circle at 50% 80%, var(--primary-glow) 0%, transparent 25%); animation: aurora-morph 40s linear infinite alternate; filter: blur(120px); opacity: 0.2; }
        @keyframes aurora-morph { 0% { transform: rotate(0deg) scale(1.2); } 100% { transform: rotate(360deg) scale(1.8); } }
        .noise-layer { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; background-image: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 800"><filter id="noise"><feTurbulence type="fractalNoise" baseFrequency="0.65" numOctaves="3" stitchTiles="stitch"/></filter><rect width="100%" height="100%" filter="url(%23noise)"/></svg>'); opacity: 0.015; }

        .container { max-width: 800px; margin: 30px auto; padding: 20px; }
        
        .page-header { display: flex; justify-content: space-between; align-items: center; padding: 15px 30px; margin: 20px; background: rgba(16,16,16,0.6); backdrop-filter: blur(20px); border-radius: 15px; border: 1px solid var(--border-color); }
        .brand-logo { display: flex; align-items: center; gap: 15px; text-decoration: none; }
        .header-logo-svg { width: 45px; height: auto; }
        .brand-title { position: relative; font-size: 1.5rem; font-weight: 700; background: linear-gradient(90deg, #ff00ff, #00ffea, #ffdd00, #ff00ff); background-size: 400% 100%; -webkit-background-clip: text; background-clip: text; color: transparent; animation: rgb-text-flow 6s linear infinite; }
        @keyframes rgb-text-flow { to { background-position: 400% 0; } }
        
        .btn { padding: 10px 20px; border-radius: 10px; font-size: 0.9rem; font-weight: 500; cursor: pointer; transition: all 0.3s ease; text-decoration: none; display: inline-block; border: none; }
        .btn-secondary { background: transparent; border: 1px solid var(--border-color); color: var(--text-secondary); }
        .btn-secondary:hover { background: var(--primary-glow); color: var(--dark-bg); border-color: var(--primary-glow); box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
        .btn-primary { background: var(--primary-glow); color: var(--dark-bg); font-weight: 600; width: 100%; }
        .btn-primary:hover { box-shadow: 0 0 20px rgba(255, 215, 0, 0.5); }
        .btn-primary:disabled { background: var(--text-secondary); cursor: not-allowed; }
        .btn-primary .spinner { display: none; width: 18px; height: 18px; border: 2px solid var(--dark-bg); border-top-color: transparent; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto; }
        .btn-primary.loading .spinner { display: block; }
        .btn-primary.loading .btn-text { display: none; }
        @keyframes spin { to { transform: rotate(360deg); } }

        .page-title { text-align: center; font-size: 2.2rem; margin-bottom: 30px; font-weight: 700; color: var(--text-primary); }
        .upload-form { background: var(--card-bg); backdrop-filter: blur(10px); border-radius: 15px; padding: 40px; border: 1px solid var(--border-color); }
        .form-group { margin-bottom: 25px; }
        .form-group label { display: block; margin-bottom: 10px; font-weight: 500; color: var(--text-secondary); }
        .form-group label .fas, .form-group label .fab { margin-right: 10px; color: var(--primary-glow); }
        input, select, textarea { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid var(--border-color); background-color: rgba(0,0,0,0.3); color: var(--text-primary); font-family: 'Inter', sans-serif; font-size: 1rem; transition: border-color 0.3s ease, box-shadow 0.3s ease; }
        input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary-glow); box-shadow: 0 0 10px rgba(255, 215, 0, 0.3); }
        .checkbox-group { display: flex; align-items: center; gap: 12px; }
        .checkbox-group input { width: auto; }
        .message { text-align: center; padding: 15px; border-radius: 8px; margin-top: 20px; display: none; font-weight: 500; }
        .message.success { background-color: rgba(46, 204, 113, 0.15); border: 1px solid var(--success); color: var(--success); }
        .message.error { background-color: rgba(231, 76, 60, 0.15); border: 1px solid var(--danger); color: var(--danger); }
        
        /* --- Styles for new course selector button --- */
        .course-selector-bar {
            background-color: rgba(0,0,0,0.3);
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #selected-course-display { color: var(--text-secondary); }
        #selected-course-display strong { color: var(--text-primary); }
        #open-filter-modal-btn { width: auto; font-size: 0.9rem; padding: 8px 15px; }
        
        /* --- MODAL STYLES --- */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.8); backdrop-filter: blur(8px); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
        .modal-overlay.active { opacity: 1; pointer-events: auto; }
        .modal-content { background: var(--dark-bg); padding: 30px; border-radius: 15px; border: 1px solid var(--border-color); width: 90%; max-width: 900px; max-height: 90vh; display: flex; flex-direction: column; position: relative; transform: scale(0.95); transition: transform 0.3s ease; }
        .modal-overlay.active .modal-content { transform: scale(1); }
        .modal-close { position: absolute; top: 15px; right: 20px; background: none; border: none; color: var(--text-primary); font-size: 2rem; cursor: pointer; z-index: 10; }
        .modal-header { text-align: center; margin-bottom: 20px; }
        
        /* --- RESPONSIVE FILTER MODAL STYLES --- */
        .filter-columns-container { overflow: hidden; width: 100%; }
        .filter-columns { display: flex; width: 300%; transition: transform 0.4s ease-in-out; }
        .filter-column { width: 100%; padding: 0 10px; display: flex; flex-direction: column; }
        .filter-column-header { display: flex; align-items: center; margin-bottom: 15px; }
        .filter-column-header h3 { font-size: 1.2rem; color: var(--primary-glow); flex-grow: 1; }
        .filter-back-btn { background: none; border: 1px solid var(--border-color); color: var(--text-secondary); padding: 5px 10px; border-radius: 8px; cursor: pointer; margin-right: 10px; }
        .filter-column-list { height: 50vh; overflow-y: auto; padding-right: 10px; }
        .filter-column-list::-webkit-scrollbar { width: 6px; }
        .filter-column-list::-webkit-scrollbar-track { background: transparent; }
        .filter-column-list::-webkit-scrollbar-thumb { background: var(--border-color); border-radius: 3px; }
        .filter-item { padding: 12px 15px; margin-bottom: 8px; border-radius: 8px; cursor: pointer; transition: background-color 0.2s ease; font-size: 0.95rem; }
        .filter-item:hover { background-color: rgba(255, 255, 255, 0.05); }
        .filter-item.selected { background-color: var(--primary-glow); color: var(--dark-bg); font-weight: 600; }
        .filter-column.disabled { opacity: 0.3; pointer-events: none; }
        
        .filter-columns.show-semesters { transform: translateX(-33.333%); }
        .filter-columns.show-courses { transform: translateX(-66.666%); }

        @media (min-width: 768px) {
            .page-header { flex-direction: row; }
            .upload-form { padding: 40px; }
            .filter-columns-container { overflow: visible; }
            .filter-columns { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; width: 100%; transform: none !important; }
            .filter-column { width: auto; border-right: 1px solid var(--border-color); padding: 0 20px; }
            .filter-column:last-child { border-right: none; }
            .filter-back-btn { display: none; }
        }
    </style>
</head>
<body>
    <div class="background-container"><div class="aurora-layer"></div><div class="noise-layer"></div></div>
    
    <header class="page-header">
        <a href="/admindashboard.html" class="brand-logo">
            <svg class="header-logo-svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"><path fill="var(--primary-glow)" d="M50,2 A48,48 0 1,0 50,98 A48,48 0 1,0 50,2 Z" /><g fill="var(--dark-bg)"><path d="M28,25 h10 v50 h-10 Z" /><path d="M45,25 H60 A12.5,12.5 0 0,1 60,50 H45 Z M45,50 H63 A12.5,12.5 0 0,1 63,75 H45 Z" /></g></svg>
            <h1 class="brand-title">IB STUDIOZ</h1>
        </a>
        <button id="logout-btn" class="btn btn-secondary"><i class="fas fa-sign-out-alt"></i> Logout</button>
    </header>

    <main class="container">
        <h1 class="page-title">Upload New Content</h1>
        <form id="upload-form" class="upload-form" novalidate>
            <div class="form-group">
                <label for="contentType"><i class="fas fa-list"></i> Type of Content</label>
                <select id="contentType" required>
                    <option value="" disabled selected>-- Select a type --</option>
                    <option value="materials">Study Material</option>
                    <option value="pyqs">PYQ / Question Bank</option>
                    <option value="seminars">Seminar (YouTube)</option>
                    <option value="quizzes">Quiz (Google Form)</option>
                </select>
            </div>
            <div class="form-group">
                <label for="title"><i class="fas fa-heading"></i> Title</label>
                <input type="text" id="title" placeholder="e.g., Unit 1 Notes" required>
            </div>
            
            <!-- CONTAINER FOR ALL 'MATERIALS' SPECIFIC FIELDS -->
            <div id="materials-fields" style="display:none;">
                <div class="form-group">
                    <label for="course-selector"><i class="fas fa-book-open"></i> Course for this Material</label>
                    <div class="course-selector-bar">
                        <span id="selected-course-display">No course selected</span>
                        <button type="button" id="open-filter-modal-btn" class="btn">Select</button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="thumbnailURL"><i class="fas fa-image"></i> Thumbnail Image URL</label>
                    <input type="url" id="thumbnailURL" placeholder="Paste public URL of the preview image">
                </div>
                <div class="form-group">
                    <label for="description"><i class="fas fa-paragraph"></i> Description</label>
                    <textarea id="description" rows="3" placeholder="A short description of the content..."></textarea>
                </div>
                <div class="form-group checkbox-group">
                    <input type="checkbox" id="isPaid">
                    <label for="isPaid">This is a Premium / Paid resource</label>
                </div>
            </div>

            <div class="form-group" id="details-group">
                <label for="details" id="details-label"><i class="fas fa-info-circle"></i> Details</label>
                <input type="text" id="details" placeholder="e.g., CS301 or Dr. Jane Doe" required>
            </div>
            <div class="form-group">
                <label for="url" id="url-label"><i class="fas fa-link"></i> URL</label>
                <input type="url" id="url" placeholder="Paste the full URL here" required>
            </div>
            <div class="form-group" id="year-group" style="display:none;">
                <label for="year"><i class="fas fa-calendar-alt"></i> Year (for PYQs)</label>
                <input type="number" id="year" placeholder="e.g., 2024">
            </div>

            <button type="submit" id="submit-btn" class="btn btn-primary">
                <span class="btn-text">Upload Content</span>
                <div class="spinner"></div>
            </button>
            <div id="form-message" class="message"></div>
        </form>
         <a href="/admindashboard.html" class="btn btn-secondary" style="width: 100%; text-align: center; margin-top: 20px;"><i class="fas fa-arrow-left"></i> Back to Dashboard</a>
    </main>
    
    <!-- FILTER SELECTION MODAL -->
    <div id="filter-modal" class="modal-overlay">
        <div class="modal-content">
            <button id="filter-modal-close-btn" class="modal-close">&times;</button>
            <div class="modal-header">
                <h2>Select the Course</h2>
                <p class="modal-description">Choose the department, semester, and course for this material.</p>
            </div>
            <div class="filter-columns-container">
                <div class="filter-columns">
                    <div id="department-col" class="filter-column">
                        <div class="filter-column-header">
                           <h3><i class="fas fa-university"></i> Department</h3>
                        </div>
                        <div class="filter-column-list"></div>
                    </div>
                    <div id="semester-col" class="filter-column disabled">
                        <div class="filter-column-header">
                           <button type="button" class="filter-back-btn" data-target="department"><i class="fas fa-arrow-left"></i></button>
                           <h3><i class="fas fa-graduation-cap"></i> Semester</h3>
                        </div>
                        <div class="filter-column-list"></div>
                    </div>
                    <div id="course-col" class="filter-column disabled">
                         <div class="filter-column-header">
                           <button type="button" class="filter-back-btn" data-target="semester"><i class="fas fa-arrow-left"></i></button>
                           <h3><i class="fas fa-book"></i> Course</h3>
                        </div>
                        <div class="filter-column-list"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script>
        const academicData = {
             branches: {"CSE":{"name":"Computer Science","color":"var(--cse-color)","icon":"fas fa-laptop-code","semesters":{"1":[{"code":"U23ENG101A","name":"Communication Skills in English","credits":3},{"code":"U23MAT102A","name":"Linear Algebra and Calculus With MATLAB","credits":4},{"code":"U23PHY103B","name":"Engineering Physics","credits":3},{"code":"U23PPR105","name":"Problem Solving using Python Programming","credits":3},{"code":"U23BEE106A","name":"Basic Electrical and Electronics Engineering","credits":3},{"code":"U23TAM101","name":"Heritage of Tamils","credits":1},{"code":"U23PHL110","name":"Engineering Physics Lab","credits":1},{"code":"U23BEEL113","name":"Basic Electrical and Electronics Engineering Lab","credits":1},{"code":"U23PPL112","name":"Python Programming Lab","credits":1}],"2":[{"code":"U23ENG201A","name":"Technical English","credits":2},{"code":"U23MAT202B","name":"Discrete Mathematics","credits":4},{"code":"U23CHE204B","name":"Chemistry For Computer Science","credits":3},{"code":"U23CPR205B","name":"Programming In C","credits":3},{"code":"U23EGR207","name":"Engineering Graphics","credits":3},{"code":"U23EC203","name":"Digital Principles And System Design","credits":3},{"code":"U23CHL211","name":"Chemistry Lab","credits":1},{"code":"U23CPL212","name":"C programming Lab","credits":1},{"code":"U23TAM201","name":"Tamils And Technology","credits":1}],"3":[{"code":"U23MAT301D","name":"Probability and Statistics","credits":4},{"code":"U23CS301","name":"Data Structures","credits":3},{"code":"U23CS302","name":"Computer Architecture","credits":3},{"code":"U23CS303","name":"Object Oriented Programming","credits":3},{"code":"U23CS304","name":"Operating Systems","credits":3},{"code":"U23CS305","name":"Computer Information and Ethics","credits":3},{"code":"U23CS306","name":"Data Structures Lab","credits":1},{"code":"U23CS307","name":"Object Oriented Programming Lab","credits":1},{"code":"U23GE301","name":"Soft Skills and Aptitude-I","credits":1},{"code":"Noc24-mg72","name":"NPTEL:design Thinking-A Primer","credits":1}],"4":[{"code":"U23MAT401B","name":"Numerical Methods","credits":4},{"code":"U23CS401","name":"Design And Analysis of Algorithms","credits":3},{"code":"U23CS402","name":"Software Engineering","credits":3},{"code":"U23CS403","name":"DataBase Management Systems","credits":3},{"code":"U23CS404","name":"Embedded System Design ","credits":3},{"code":"U23CS405","name":"Software Development Lab","credits":1},{"code":"U23CS403","name":"Database Management Systems Lab","credits":1}],"5":[{"code":"U23CS504","name":"Machine Learning","credits":3},{"code":"U23CS501","name":"Computer Networks","credits":3},{"code":"U23CS502","name":"Artificial Intelligence","credits":3},{"code":"U23CS503","name":"Theory of Computation","credits":3},{"code":"noc25-cs135","name":"Elective NPTEL","credits":3},{"code":" U23CS947 / U23CS903","name":"Professional Elective ","credits":3},{"code":"U23CS505","name":"Computer Networks Laboratory","credits":2},{"code":"U23CS506","name":"Artificial Intelligence and Machine Learning Laboratory","credits":1},{"code":"U23GE501","name":"Soft Skills and Aptitude -III","credits":1}],"6":[],"7":[],"8":[]}},
            "IT":{"name":"Info. Technology","color":"var(--it-color)","icon":"fas fa-network-wired","semesters":{"1":[{"code":"U23IT101","name":"Programming Fundamentals","credits":4},{"code":"U23IT102","name":"Discrete Mathematics","credits":4},{"code":"U23IT103","name":"Digital Systems","credits":3},{"code":"U23IT104","name":"Computer Organization","credits":3},{"code":"U23IT105","name":"Communication Skills","credits":2},{"code":"U23IT106","name":"Programming Lab","credits":1},{"code":"U23IT107","name":"Digital Systems Lab","credits":1}],"2":[{"code":"U23IT201","name":"Data Structures","credits":4},{"code":"U23IT202","name":"Database Systems","credits":4},{"code":"U23IT203","name":"Operating Systems","credits":3},{"code":"U23IT204","name":"Computer Networks","credits":3},{"code":"U23IT205","name":"Web Technologies","credits":3},{"code":"U23IT206","name":"Data Structures Lab","credits":1},{"code":"U23IT207","name":"Web Technologies Lab","credits":1}],"3":[],"4":[],"5":[],"6":[],"7":[],"8":[]}},
            "ECE":{"name":"Electronics & Comm","color":"var(--ece-color)","icon":"fas fa-satellite-dish","semesters":{"1":[{"code":"U23EC101","name":"Basic Electronics","credits":4},{"code":"U23EC102","name":"Circuit Theory","credits":4},{"code":"U23EC103","name":"Engineering Mathematics","credits":4},{"code":"U23EC104","name":"Programming in C","credits":3},{"code":"U23EC105","name":"Communication Skills","credits":2},{"code":"U23EC106","name":"Electronics Lab","credits":1},{"code":"U23EC107","name":"Programming Lab","credits":1}],"2":[{"code":"U23EC201","name":"Analog Electronics","credits":4},{"code":"U23EC202","name":"Digital Electronics","credits":4},{"code":"U23EC203","name":"Signals and Systems","credits":4},{"code":"U23EC204","name":"Electromagnetic Theory","credits":3},{"code":"U23EC205","name":"Data Structures","credits":3},{"code":"U23EC206","name":"Analog Electronics Lab","credits":1},{"code":"U23EC207","name":"Digital Electronics Lab","credits":1}],"3":[],"4":[],"5":[],"6":[],"7":[],"8":[]}},
            "EEE":{"name":"Electrical & Electronics","color":"var(--eee-color)","icon":"fas fa-bolt","semesters":{"1":[{"code":"U23EE101","name":"Basic Electrical Engineering","credits":4},{"code":"U23EE102","name":"Engineering Mathematics","credits":4},{"code":"U23EE103","name":"Electronics Engineering","credits":3},{"code":"U23EE104","name":"Programming in C","credits":3},{"code":"U23EE105","name":"Communication Skills","credits":2},{"code":"U23EE106","name":"Electrical Lab","credits":1},{"code":"U23EE107","name":"Programming Lab","credits":1}],"2":[{"code":"U23EE201","name":"Circuit Theory","credits":4},{"code":"U23EE202","name":"Electromagnetic Theory","credits":4},{"code":"U23EE203","name":"Digital Electronics","credits":4},{"code":"U23EE204","name":"Electrical Machines","credits":3},{"code":"U23EE205","name":"Data Structures","credits":3},{"code":"U23EE206","name":"Circuit Theory Lab","credits":1},{"code":"U23EE207","name":"Digital Electronics Lab","credits":1}],"3":[],"4":[],"5":[],"6":[],"7":[],"8":[]}},
            "MECH":{"name":"Mechanical","color":"var(--mech-color)","icon":"fas fa-cogs","semesters":{"1":[{"code":"U23ME101","name":"Engineering Mechanics","credits":4},{"code":"U23ME102","name":"Engineering Graphics","credits":4},{"code":"U23ME103","name":"Engineering Mathematics","credits":4},{"code":"U23ME104","name":"Basic Electrical Engineering","credits":3},{"code":"U23ME105","name":"Communication Skills","credits":2},{"code":"U23ME106","name":"Workshop Practice","credits":1},{"code":"U23ME107","name":"Engineering Graphics Lab","credits":1}],"2":[{"code":"U23ME201","name":"Thermodynamics","credits":4},{"code":"U23ME202","name":"Mechanics of Materials","credits":4},{"code":"U23ME203","name":"Manufacturing Technology","credits":4},{"code":"U23ME204","name":"Fluid Mechanics","credits":3},{"code":"U23ME205","name":"Computer Programming","credits":3},{"code":"U23ME206","name":"Thermodynamics Lab","credits":1},{"code":"U23ME207","name":"Manufacturing Technology Lab","credits":1}],"3":[],"4":[],"5":[],"6":[],"7":[],"8":[]}},
            "AIML":{"name":"AI & Machine Learning","color":"var(--aiml-color)","icon":"fas fa-brain","semesters":{"1":[{"code":"U23EG107","name":"Engineering Graphics","credits":3},{"code":"U23ENG101A","name":"Communication Skills in English","credits":3},{"code":"U23MAT102A","name":"Linear Algebra and Calculus with MATLAB","credits":4},{"code":"U23PPR105","name":"Problem Solving using Python Programming","credits":3},{"code":"U23PHY103E","name":"Engineering Physics","credits":3},{"code":"U23PHL110","name":"Engineering Physics Laboratory","credits":1},{"code":"U23PPL112","name":"Python Programming Laboratory","credits":1},{"code":"U23TAM101","name":"Heritage of Tamils","credits":1}],"2":[{"code":"U23ENG201A","name":"Technical English","credits":2},{"code":"U23MAT202D","name":"Discrete Mathematics","credits":4},{"code":"U23BEEE206B","name":"Basics of Electrical and Electronics Engineering","credits":3},{"code":"U23CPR205","name":"Programming in C","credits":3},{"code":"U23CHE204C","name":"Applied Chemistry","credits":2},{"code":"U23EC203","name":"Digital Principles and System Design","credits":3},{"code":"U23CPL212","name":"C Programming Laboratory","credits":1},{"code":"U23CHL211","name":"Chemistry Laboratory","credits":1},{"code":"U23BEEL213B","name":"BEEE Laboratory","credits":1},{"code":"U23TAM201","name":"Tamils and Technology","credits":1}],"3":[{"code":"U23MAT301E","name":"Applied Probability and Statistics-I","credits":4},{"code":"U23CS301","name":"Data Structures","credits":3},{"code":"U23CS302","name":"Computer Architecture","credits":3},{"code":"U23CS303","name":"Object Oriented Programming Using Java","credits":3},{"code":"U23AML301","name":"Data Visualization","credits":3},{"code":"noc25-mg106","name":"NPTEL: Design Thinking - A Primer","credits":1},{"code":"U23CS306","name":"Data Structures Laboratory","credits":1},{"code":"U23CS307","name":"Object Oriented Programming Using Java Laboratory","credits":1},{"code":"U23AML302","name":"Data Visualization Laboratory","credits":1},{"code":"U23GE301","name":"Soft Skills and Aptitude-I","credits":1}],"4":[{"code":"U23MAT401A","name":"Applied Probability and Statistics-II","credits":4},{"code":"U23CS403","name":"Database Management Systems","credits":3},{"code":"U23CS401","name":"Design and Analysis of Algorithms","credits":3},{"code":"U23AML401","name":"Artificial Intelligence","credits":3},{"code":"U23CSD402","name":"Operating Systems","credits":3},{"code":"U23AML402","name":"Artificial Intelligence Lab","credits":1},{"code":"U23CS405","name":"Database Management Systems Lab","credits":1},{"code":"U23GE401","name":"Soft Skills and Aptitude-II","credits":1}],"5":[{"code":"U23CS504","name":"Machine Learning","credits":3},{"code":"U23CS501","name":"Computer Networks","credits":3},{"code":"U23CSD502","name":"Software Engineering","credits":3},{"code":"U23CS503","name":"Theory of Computation","credits":3},{"code":"noc25-cs135","name":"Elective NPTEL","credits":3},{"code":"U19CS903","name":"Professional Elective - Agile Methodologies","credits":3},{"code":"U23AML501","name":"Machine Learning Laboratory","credits":2},{"code":"U23CSD504","name":"Software Development Laboratory","credits":1},{"code":"U23GE501","name":"Soft Skills and Aptitude -III","credits":1}],"6":[{"code":"U23CS601","name":"Computer Vision","credits":3},{"code":"U23CS602","name":"Reinforcement Learning","credits":3},{"code":"U23CS603","name":"Robotics","credits":3},{"code":"U23CS604","name":"Cyber Security","credits":3},{"code":"U23CS605","name":"Blockchain Technology","credits":3},{"code":"U23CS606","name":"Elective III","credits":3},{"code":"U23CS607","name":"Project Work II","credits":3}],"7":[{"code":"U23CS701","name":"Advanced Machine Learning","credits":3},{"code":"U23CS702","name":"AI Ethics and Governance","credits":3},{"code":"U23CS703","name":"Elective IV","credits":3},{"code":"U23CS704","name":"Project Work III","credits":3}],"8":[{"code":"U23CS801","name":"Industry Internship","credits":6},{"code":"U23CS802","name":"Project Work IV","credits":6}]}},
            "CIVIL":{"name":"Civil Engineering","color":"var(--civil-color)","icon":"fas fa-building","semesters":{"1":[{"code":"U23CE101","name":"Engineering Mechanics","credits":4},{"code":"U23CE102","name":"Engineering Graphics","credits":4},{"code":"U23CE103","name":"Engineering Mathematics","credits":4},{"code":"U23CE104","name":"Basic Civil Engineering","credits":3},{"code":"U23CE105","name":"Communication Skills","credits":2},{"code":"U23CE106","name":"Surveying","credits":1},{"code":"U23CE107","name":"Engineering Graphics Lab","credits":1}],"2":[{"code":"U23CE201","name":"Building Materials","credits":4},{"code":"U23CE202","name":"Structural Analysis","credits":4},{"code":"U23CE203","name":"Fluid Mechanics","credits":4},{"code":"U23CE204","name":"Surveying","credits":3},{"code":"U23CE205","name":"Computer Programming","credits":3},{"code":"U23CE206","name":"Building Materials Lab","credits":1},{"code":"U23CE207","name":"Surveying Lab","credits":1}]}},
            "BME":{"name":"Bio Medical","color":"var(--bme-color)","icon":"fas fa-heartbeat","semesters":{"1":[{"code":"U23BM101","name":"Human Anatomy","credits":4},{"code":"U23BM102","name":"Engineering Mathematics","credits":4},{"code":"U23BM103","name":"Basic Electronics","credits":3},{"code":"U23BM104","name":"Programming in C","credits":3},{"code":"U23BM105","name":"Communication Skills","credits":2},{"code":"U23BM106","name":"Human Anatomy Lab","credits":1},{"code":"U23BM107","name":"Programming Lab","credits":1}],"2":[{"code":"U23BM201","name":"Human Physiology","credits":4},{"code":"U23BM202","name":"Biochemistry","credits":4},{"code":"U23BM203","name":"Medical Electronics","credits":4},{"code":"U23BM204","name":"Biomechanics","credits":3},{"code":"U23BM205","name":"Data Structures","credits":3},{"code":"U23BM206","name":"Human Physiology Lab","credits":1},{"code":"U23BM207","name":"Medical Electronics Lab","credits":1}]}},
            "FT":{"name":"Fashion Technology","color":"var(--ft-color)","icon":"fas fa-tshirt","semesters":{"1":[{"code":"U23FT101","name":"Fiber Science","credits":4},{"code":"U23FT102","name":"Textile Chemistry","credits":4},{"code":"U23FT103","name":"Fashion Illustration","credits":3},{"code":"U23FT104","name":"Pattern Making","credits":3},{"code":"U23FT105","name":"Communication Skills","credits":2},{"code":"U23FT106","name":"Textile Chemistry Lab","credits":1},{"code":"U23FT107","name":"Pattern Making Lab","credits":1}],"2":[{"code":"U23FT201","name":"Textile Processing","credits":4},{"code":"U23FT202","name":"Apparel Manufacturing","credits":4},{"code":"U23FT203","name":"Fashion Design","credits":4},{"code":"U23FT204","name":"Garment Construction","credits":3},{"code":"U23FT205","name":"Computer Applications","credits":3},{"code":"U23FT206","name":"Apparel Manufacturing Lab","credits":1},{"code":"U23FT207","name":"Garment Construction Lab","credits":1}]}},
            "MCT":{"name":"Mechatronics","color":"var(--mct-color)","icon":"fas fa-robot","semesters":{"1":[{"code":"U23MT101","name":"Engineering Mechanics","credits":4},{"code":"U23MT102","name":"Engineering Graphics","credits":4},{"code":"U23MT103","name":"Engineering Mathematics","credits":4},{"code":"U23MT104","name":"Basic Electronics","credits":3},{"code":"U23MT105","name":"Communication Skills","credits":2},{"code":"U23MT106","name":"Workshop Practice","credits":1},{"code":"U23MT107","name":"Engineering Graphics Lab","credits":1}],"2":[{"code":"U23MT201","name":"Thermodynamics","credits":4},{"code":"U23MT202","name":"Mechanics of Materials","credits":4},{"code":"U23MT203","name":"Digital Electronics","credits":4},{"code":"U23MT204","name":"Fluid Mechanics","credits":3},{"code":"U23MT205","name":"Computer Programming","credits":3},{"code":"U23MT206","name":"Thermodynamics Lab","credits":1},{"code":"U23MT207","name":"Digital Electronics Lab","credits":1}]}},
            "CSD":{"name":"CS & Design","color":"var(--csd-color)","icon":"fas fa-paint-brush","semesters":{"1":[{"code":"U23CD101","name":"Design Fundamentals","credits":4},{"code":"U23CD102","name":"Programming Basics","credits":4},{"code":"U23CD103","name":"Visual Communication","credits":3},{"code":"U23CD104","name":"Mathematics for Design","credits":3},{"code":"U23CD105","name":"Communication Skills","credits":2},{"code":"U23CD106","name":"Design Studio","credits":1},{"code":"U23CD107","name":"Programming Lab","credits":1}],"2":[{"code":"U23CD201","name":"User Interface Design","credits":4},{"code":"U23CD202","name":"Data Structures","credits":4},{"code":"U23CD203","name":"Web Design","credits":4},{"code":"U23CD204","name":"Digital Illustration","credits":3},{"code":"U23CD205","name":"Human-Computer Interaction","credits":3},{"code":"U23CD206","name":"UI Design Lab","credits":1},{"code":"U23CD207","name":"Web Design Lab","credits":1}]}},
            "ADS":{"name":"AI & Data Science","color":"var(--ads-color)","icon":"fas fa-database","semesters":{"1":[{"code":"U23DS101","name":"Programming Fundamentals","credits":4},{"code":"U23DS102","name":"Linear Algebra","credits":4},{"code":"U23DS103","name":"Statistics Basics","credits":3},{"code":"U23DS104","name":"Computational Thinking","credits":3},{"code":"U23DS105","name":"Communication Skills","credits":2},{"code":"U23DS106","name":"Programming Lab","credits":1},{"code":"U23DS107","name":"Statistics Lab","credits":1}],"2":[{"code":"U23DS201","name":"Data Structures","credits":4},{"code":"U23DS202","name":"Probability and Statistics","credits":4},{"code":"U23DS203","name":"Database Systems","credits":4},{"code":"U23DS204","name":"Data Visualization","credits":3},{"code":"U23DS205","name":"Python Programming","credits":3},{"code":"U23DS206","name":"Data Structures Lab","credits":1},{"code":"U23DS207","name":"Database Lab","credits":1}]}},
            "EFE":{"name":"Electrical & Computer","color":"var(--efe-color)","icon":"fas fa-microchip","semesters":{"1":[{"code":"U23EF101","name":"Circuit Theory","credits":4},{"code":"U23EF102","name":"Programming Fundamentals","credits":4},{"code":"U23EF103","name":"Digital Electronics","credits":3},{"code":"U23EF104","name":"Engineering Mathematics","credits":3},{"code":"U23EF105","name":"Communication Skills","credits":2},{"code":"U23EF106","name":"Circuit Theory Lab","credits":1},{"code":"U23EF107","name":"Programming Lab","credits":1}],"2":[{"code":"U23EF201","name":"Signals and Systems","credits":4},{"code":"U23EF202","name":"Data Structures","credits":4},{"code":"U23EF203","name":"Analog Electronics","credits":4},{"code":"U23EF204","name":"Electromagnetic Theory","credits":3},{"code":"U23EF205","name":"Computer Organization","credits":3},{"code":"U23EF206","name":"Analog Electronics Lab","credits":1},{"code":"U23EF207","name":"Data Structures Lab","credits":1}]}},
            "EXE":{"name":"Electronics & Computer","color":"var(--exe-color)","icon":"fas fa-desktop","semesters":{"1":[{"code":"U23EX101","name":"Basic Electronics","credits":4},{"code":"U23EX102","name":"Programming Fundamentals","credits":4},{"code":"U23EX103","name":"Digital Logic Design","credits":3},{"code":"U23EX104","name":"Engineering Mathematics","credits":3},{"code":"U23EX105","name":"Communication Skills","credits":2},{"code":"U23EX106","name":"Electronics Lab","credits":1},{"code":"U23EX107","name":"Programming Lab","credits":1}],"2":[{"code":"U23EX201","name":"Data Structures","credits":4},{"code":"U23EX202","name":"Analog Electronics","credits":4},{"code":"U23EX203","name":"Computer Organization","credits":4},{"code":"U23EX204","name":"Signals and Systems","credits":3},{"code":"U23EX205","name":"Database Systems","credits":3},{"code":"U23EX206","name":"Analog Electronics Lab","credits":1},{"code":"U23EX207","name":"Data Structures Lab","credits":1}]}}}
        };
        
        document.addEventListener('DOMContentLoaded', () => {
            // Firebase setup
            const firebaseConfig = { apiKey: "AIzaSyDCmvA9sFCSc5r4ZuFUJuGdO1LDoW7rKao", authDomain: "student-portal-free.firebaseapp.com", projectId: "student-portal-free", storageBucket: "student-portal-free.appspot.com", messagingSenderId: "272865877510", appId: "1:272865877510:web:0875a2502ae55bbf9ead87" };
            firebase.initializeApp(firebaseConfig);
            const auth = firebase.auth();
            const db = firebase.firestore();

            // Admin authentication check
            auth.onAuthStateChanged(user => {
                if (!user) { window.location.replace('/index.html'); return; }
                db.collection('users').doc(user.uid).get().then(doc => {
                    if (!doc.exists || doc.data().role !== 'admin') {
                        window.location.replace('/studentdashboard.html');
                    } else {
                        initializeAdminForm();
                    }
                });
            });

            // --- ALL FORM AND MODAL ELEMENTS ---
            const contentTypeSelect = document.getElementById('contentType');
            const yearGroup = document.getElementById('year-group');
            const detailsGroup = document.getElementById('details-group');
            const detailsLabel = document.getElementById('details-label');
            const urlLabel = document.getElementById('url-label');
            const materialsFields = document.getElementById('materials-fields');
            
            // Modal elements
            const filterModal = document.getElementById('filter-modal');
            const openFilterBtn = document.getElementById('open-filter-modal-btn');
            const closeFilterBtn = document.getElementById('filter-modal-close-btn');
            const filterColumns = document.querySelector('.filter-columns');
            const deptCol = document.getElementById('department-col');
            const semCol = document.getElementById('semester-col');
            const courseCol = document.getElementById('course-col');
            const selectionDisplay = document.getElementById('selected-course-display');

            // --- STATE MANAGEMENT ---
            let selectedDept = { code: null, name: null };
            let selectedSem = { code: null, name: null };
            let selectedCourse = { code: null, name: null };
            
            function initializeAdminForm() {
                populateDepartments();
                setupEventListeners();
            }
            
            function setupEventListeners() {
                contentTypeSelect.addEventListener('change', handleContentTypeChange);
                openFilterBtn.addEventListener('click', () => {
                    filterColumns.classList.remove('show-semesters', 'show-courses');
                    filterModal.classList.add('active');
                });
                closeFilterBtn.addEventListener('click', () => filterModal.classList.remove('active'));
                filterModal.addEventListener('click', e => e.target === filterModal && filterModal.classList.remove('active'));

                deptCol.addEventListener('click', handleDeptSelection);
                semCol.addEventListener('click', handleSemSelection);
                courseCol.addEventListener('click', handleCourseSelection);

                document.querySelectorAll('.filter-back-btn').forEach(btn => {
                    btn.addEventListener('click', () => {
                        if (btn.dataset.target === 'department') filterColumns.classList.remove('show-semesters', 'show-courses');
                        else if (btn.dataset.target === 'semester') filterColumns.classList.remove('show-courses');
                    });
                });

                document.getElementById('upload-form').addEventListener('submit', handleFormSubmit);
                document.getElementById('logout-btn').addEventListener('click', () => auth.signOut());
            }
            
            function handleContentTypeChange() {
                const type = contentTypeSelect.value;
                const isMaterials = type === 'materials';

                materialsFields.style.display = isMaterials ? 'block' : 'none';
                detailsGroup.style.display = isMaterials ? 'none' : 'block';
                yearGroup.style.display = type === 'pyqs' ? 'block' : 'none';
                
                if (type === 'seminars') {
                    detailsLabel.innerHTML = '<i class="fas fa-user-tie"></i> Speaker Name';
                    urlLabel.innerHTML = '<i class="fab fa-youtube"></i> YouTube Embed URL';
                } else if (type === 'quizzes') {
                    detailsLabel.innerHTML = '<i class="fas fa-tag"></i> Quiz Topic';
                    urlLabel.innerHTML = '<i class="fab fa-google-drive"></i> Google Form Embed URL';
                } else if (type === 'pyqs') {
                    detailsLabel.innerHTML = '<i class="fas fa-info-circle"></i> Course Code';
                    urlLabel.innerHTML = '<i class="fas fa-link"></i> Download URL';
                } else {
                    urlLabel.innerHTML = '<i class="fas fa-link"></i> Download URL';
                }
            }

            // --- MODAL POPULATION & SELECTION LOGIC ---
            function populateDepartments() {
                const deptList = deptCol.querySelector('.filter-column-list');
                deptList.innerHTML = '';
                Object.keys(academicData.branches).forEach(branchCode => {
                    const branch = academicData.branches[branchCode];
                    const item = document.createElement('div');
                    item.className = 'filter-item'; item.textContent = branch.name;
                    item.dataset.code = branchCode; item.dataset.name = branch.name;
                    deptList.appendChild(item);
                });
            }

            function populateSemesters() {
                const semList = semCol.querySelector('.filter-column-list');
                semList.innerHTML = '';
                const branchData = academicData.branches[selectedDept.code];
                Object.keys(branchData.semesters).forEach(sem => {
                    const item = document.createElement('div');
                    item.className = 'filter-item'; item.textContent = `Semester ${sem}`;
                    item.dataset.code = sem;
                    semList.appendChild(item);
                });
                semCol.classList.remove('disabled');
            }

            function populateCourses() {
                const courseList = courseCol.querySelector('.filter-column-list');
                courseList.innerHTML = '';
                const subjects = academicData.branches[selectedDept.code].semesters[selectedSem.code];
                if (subjects && subjects.length > 0) {
                    subjects.forEach(subject => {
                        const item = document.createElement('div');
                        item.className = 'filter-item'; item.textContent = `${subject.code} - ${subject.name}`;
                        item.dataset.code = subject.code; item.dataset.name = subject.name;
                        courseList.appendChild(item);
                    });
                } else {
                    courseList.innerHTML = '<p style="padding: 12px 15px;">No courses found.</p>';
                }
                courseCol.classList.remove('disabled');
            }

            function handleDeptSelection(e) {
                if (!e.target.classList.contains('filter-item')) return;
                selectedDept = { code: e.target.dataset.code, name: e.target.dataset.name };
                updateSelectedUI(deptCol, e.target);
                semCol.querySelector('.filter-column-list').innerHTML = '';
                courseCol.querySelector('.filter-column-list').innerHTML = '';
                semCol.classList.add('disabled'); courseCol.classList.add('disabled');
                populateSemesters();
                filterColumns.classList.add('show-semesters');
            }

            function handleSemSelection(e) {
                if (!e.target.classList.contains('filter-item')) return;
                selectedSem = { code: e.target.dataset.code, name: e.target.textContent };
                updateSelectedUI(semCol, e.target);
                courseCol.querySelector('.filter-column-list').innerHTML = '';
                courseCol.classList.add('disabled');
                populateCourses();
                filterColumns.classList.add('show-courses');
            }

            function handleCourseSelection(e) {
                if (!e.target.classList.contains('filter-item')) return;
                selectedCourse = { code: e.target.dataset.code, name: e.target.dataset.name };
                updateSelectedUI(courseCol, e.target);
                filterModal.classList.remove('active');
                selectionDisplay.innerHTML = `<strong>${selectedCourse.code}</strong> - ${selectedCourse.name}`;
            }

            function updateSelectedUI(column, selectedElement) {
                [...column.querySelectorAll('.filter-item')].forEach(item => item.classList.remove('selected'));
                selectedElement.classList.add('selected');
            }

            // --- FORM SUBMISSION ---
            function handleFormSubmit(e) {
                e.preventDefault();
                const submitBtn = document.getElementById('submit-btn');
                const messageEl = document.getElementById('form-message');
                submitBtn.disabled = true; submitBtn.classList.add('loading');
                messageEl.style.display = 'none';

                const collectionName = contentTypeSelect.value;
                if (!collectionName) {
                    alert('Please select a content type.');
                    submitBtn.disabled = false; submitBtn.classList.remove('loading');
                    return;
                }
                
                const data = {
                    title: document.getElementById('title').value.trim(),
                    uploadedAt: firebase.firestore.FieldValue.serverTimestamp()
                };
                
                switch(collectionName) {
                    case 'materials':
                        data.department = selectedDept.code;
                        data.semester = selectedSem.code;
                        data.courseCode = selectedCourse.code;
                        data.downloadURL = document.getElementById('url').value.trim();
                        data.isPaid = document.getElementById('isPaid').checked;
                        data.thumbnailURL = document.getElementById('thumbnailURL').value.trim();
                        data.description = document.getElementById('description').value.trim();
                        if (!data.department || !data.semester || !data.courseCode) {
                           alert('Please select a course for the material using the "Select" button.');
                           submitBtn.disabled = false; submitBtn.classList.remove('loading');
                           return;
                        }
                        break;
                    case 'pyqs':
                        data.courseCode = document.getElementById('details').value.trim();
                        data.downloadURL = document.getElementById('url').value.trim();
                        data.year = Number(document.getElementById('year').value) || null;
                        break;
                    case 'seminars':
                        data.speaker = document.getElementById('details').value.trim();
                        data.youtubeURL = document.getElementById('url').value.trim();
                        break;
                    case 'quizzes':
                        data.topic = document.getElementById('details').value.trim();
                        data.googleFormURL = document.getElementById('url').value.trim();
                        break;
                }
                
                db.collection(collectionName).add(data).then(() => {
                    messageEl.textContent = 'Content uploaded successfully!';
                    messageEl.className = 'message success'; messageEl.style.display = 'block';
                    document.getElementById('upload-form').reset();
                    handleContentTypeChange();
                    resetMaterialSelection();
                    setTimeout(() => { messageEl.style.display = 'none'; }, 4000);
                }).catch(err => {
                    messageEl.textContent = 'Error: ' + err.message;
                    messageEl.className = 'message error'; messageEl.style.display = 'block';
                }).finally(() => {
                    submitBtn.disabled = false; submitBtn.classList.remove('loading');
                });
            }

            function resetMaterialSelection() {
                selectedDept = { code: null, name: null };
                selectedSem = { code: null, name: null };
                selectedCourse = { code: null, name: null };
                selectionDisplay.textContent = 'No course selected';
                // You might also want to reset the visual 'selected' state in the modal here
                [...document.querySelectorAll('.filter-item.selected')].forEach(item => item.classList.remove('selected'));
            }
        });
    </script>
</body>
</html> 
